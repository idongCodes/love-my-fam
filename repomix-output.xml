This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.windsurf/
  workflows/
    my-room.md
prisma/
  schema.prisma
  seed.js
  seed.ts
public/
  images/
    mom_charlie_bg.jpg
  file.svg
  globe.svg
  next.svg
  vercel.svg
  window.svg
scripts/
  auto-update-whatsnew.js
src/
  app/
    [slug]/
      page.tsx
    api/
      logout/
        route.ts
      test-blob/
        route.ts
      user/
        [id]/
          route.ts
    chat/
      actions.ts
    common-room/
      actions.ts
      page.tsx
    family/
      page.tsx
    login/
      actions.ts
      page.tsx
    my-room/
      actions.ts
      page.tsx
    register/
      actions.ts
      page.tsx
    testimonials/
      actions.ts
    actions.ts
    favicon.ico
    globals.css
    layout.tsx
    page.tsx
  components/
    AnnouncementCarousel.tsx
    AnnouncementModal.tsx
    AutoLogout.tsx
    BottomNav.tsx
    ChatModal.tsx
    CommentItem.tsx
    DailyVerse.tsx
    EmojiButton.tsx
    FamilyPositionIcon.tsx
    FeedbackSection.tsx
    FeedbackWidget.tsx
    LikeButton.tsx
    MyRoomClient.tsx
    Navbar.tsx
    NavMenu.tsx
    PostCard.tsx
    PostInput.tsx
    StatusBadge.tsx
    TestimonialSection.tsx
    TestimonialSlider.tsx
    WhatsNewSection.tsx
  hooks/
    useLongPress.ts
  lib/
    updateLogger.ts
    verses.ts
    whatsNew.ts
  middleware.ts
.gitignore
bundle.py
check-data.js
eslint.config.mjs
next.config.ts
package.json
postcss.config.mjs
project_bundle.txt
README.md
restore-data.js
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="src/app/login/page.tsx">
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { login } from './actions'

export default function LoginPage() {
  const [error, setError] = useState('')
  const router = useRouter()

  async function handleSubmit(formData: FormData) {
    const result = await login(formData)
    
    if (result.success) {
      router.push('/common-room') // Success! Go to the room.
    } else {
      setError(result.message || "An unexpected error occurred.")
    }
  }

  return (
    <main className="min-h-screen flex items-center justify-center bg-brand-sky/10 px-4">
      <div className="bg-white p-8 rounded-2xl shadow-lg max-w-md w-full border border-slate-100">
        
        <h1 className="text-3xl font-bold text-center text-brand-sky mb-2">Family Login</h1>
        <p className="text-center text-slate-400 mb-8">Enter your email and the family secret.</p>

        <form action={handleSubmit} className="space-y-4">
          
          {/* Email Field */}
          <div>
            <label className="block text-sm font-medium text-slate-700 mb-1">Your Email</label>
            <input 
              name="email" 
              type="email" 
              required
              placeholder="you@example.com"
              className="w-full p-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-brand-sky focus:outline-none"
            />
          </div>

          {/* Secret Field */}
          <div>
            <label className="block text-sm font-medium text-slate-700 mb-1">Family Secret</label>
            <input 
              name="password" 
              type="password" 
              required
              placeholder="What is the secret?"
              className="w-full p-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-brand-sky focus:outline-none"
            />
          </div>

          {/* Error Message Display */}
          {error && (
            <p className="text-red-500 text-sm text-center bg-red-50 p-2 rounded">{error}</p>
          )}

          {/* Submit Button */}
          <button 
            type="submit" 
            className="w-full bg-brand-pink text-slate-800 font-bold py-3 rounded-lg hover:brightness-105 transition-all shadow-sm"
          >
            Open the Door
          </button>
        </form>

        {/* Footer Links */}
        <div className="mt-8 text-center space-y-3">
          <Link href="/register" className="block text-sm text-brand-sky font-bold hover:underline">
            New to the family? Register here
          </Link>
          <Link href="/" className="block text-sm text-slate-400 hover:text-brand-sky transition-colors">
            ‚Üê Back Home
          </Link>
        </div>
      </div>
    </main>
  )
}
</file>

<file path="src/app/register/page.tsx">
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { registerUser } from './actions'

export default function RegisterPage() {
  const [error, setError] = useState('')
  const [answer, setAnswer] = useState('') // Track what they type
  const router = useRouter()

  // Check if they got it right (Case insensitive)
  const isSecurityCorrect = answer.trim().toLowerCase() === 'mercy'

  async function handleSubmit(formData: FormData) {
    const result = await registerUser(formData)
    
    if (result.success) {
      router.push('/common-room')
    } else {
      setError(result.message || "Something went wrong")
    }
  }

  return (
    <main className="min-h-screen flex items-center justify-center bg-brand-cream/30 px-4 py-10">
      <div className="bg-white p-8 rounded-2xl shadow-lg max-w-lg w-full border border-slate-100">
        
        <h1 className="text-3xl font-bold text-center text-brand-sky mb-2">Join the Family</h1>
        <p className="text-center text-slate-400 mb-8">Create your profile to enter the Common Room.</p>

        <form action={handleSubmit} className="space-y-4">
          
          {/* PERSONAL DETAILS */}
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-xs font-bold text-slate-500 mb-1">FIRST NAME</label>
              <input name="firstName" required className="w-full p-3 rounded-lg bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none" />
            </div>
            <div>
              <label className="block text-xs font-bold text-slate-500 mb-1">LAST NAME</label>
              <input name="lastName" required className="w-full p-3 rounded-lg bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none" />
            </div>
          </div>

          <div>
            <label className="block text-xs font-bold text-slate-500 mb-1">PREFERRED ALIAS (Optional)</label>
            <input name="alias" placeholder="What should we call you?" className="w-full p-3 rounded-lg bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none" />
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-xs font-bold text-slate-500 mb-1">PHONE</label>
              <input name="phone" type="tel" required className="w-full p-3 rounded-lg bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none" />
            </div>
            <div>
              <label className="block text-xs font-bold text-slate-500 mb-1">EMAIL</label>
              <input name="email" type="email" required className="w-full p-3 rounded-lg bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none" />
            </div>
          </div>

          {/* SECURITY QUESTION */}
          <div className={`p-4 rounded-xl border transition-colors duration-500 ${isSecurityCorrect ? 'bg-green-50 border-green-200' : 'bg-brand-yellow/20 border-brand-yellow'}`}>
            <label className="block text-sm font-bold text-slate-700 mb-2">
              üîí Security Question
            </label>
            <p className="text-sm text-slate-600 mb-3 italic">
              "What is Charlie's Grandma's name on her Father's side?"
            </p>
            <input 
              name="securityAnswer" 
              required 
              placeholder="Answer..."
              value={answer}
              onChange={(e) => setAnswer(e.target.value)}
              className="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-brand-pink outline-none" 
            />
          </div>

          {/* HIDDEN "POSITION" FIELD - APPEARS ON SUCCESS */}
          {isSecurityCorrect && (
            <div className="animate-fade-in-down">
              <div className="bg-brand-sky/10 p-4 rounded-xl border border-brand-sky mt-4">
                <label className="block text-sm font-bold text-brand-sky mb-2">
                  ‚úÖ Correct! One last thing...
                </label>
                <p className="text-xs text-slate-500 mb-2">How are you related to the family? (e.g. Cousin, Aunt, Friend)</p>
                <input 
                  name="position" 
                  required 
                  placeholder="I am a..."
                  className="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-brand-sky outline-none" 
                />
              </div>
              
              <button 
                type="submit" 
                className="w-full bg-brand-sky text-white font-bold py-4 rounded-xl shadow-md hover:bg-sky-500 transition-all mt-4"
              >
                Complete Registration
              </button>
            </div>
          )}

          {error && (
            <p className="text-red-500 text-sm text-center bg-red-50 p-2 rounded mt-2">{error}</p>
          )}

        </form>

        <div className="mt-6 text-center">
          <Link href="/login" className="text-sm text-brand-pink font-bold hover:underline">
            Already have an account? Login here
          </Link>
        </div>
      </div>
    </main>
  )
}
</file>

<file path="src/components/NavMenu.tsx">
'use client'

import { useState } from 'react'
import Link from 'next/link'
import { logout } from '@/app/actions'

export default function NavMenu({ isLoggedIn }: { isLoggedIn: boolean }) {
  const [isOpen, setIsOpen] = useState(false)

  // Close menu when a link is clicked
  const close = () => setIsOpen(false)

  return (
    <>
      {/* --- DESKTOP VIEW (Hidden on Mobile) --- */}
      <div className="hidden md:flex items-center gap-6 text-sm font-medium text-white">
        <Link href="/" className="hover:text-brand-yellow transition-colors">Home</Link>
        
        {isLoggedIn ? (
          <>
            <Link href="/common-room" className="hover:text-brand-yellow transition-colors">Common Room</Link>
            <Link href="/family" className="hover:text-brand-yellow transition-colors">Directory</Link>
            <Link href="/my-room" className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full transition-all border border-white/20">
              My Room
            </Link>
            <form action={logout}>
              <button type="submit" className="text-white/80 hover:text-white hover:underline transition-all ml-2">
                Logout
              </button>
            </form>
          </>
        ) : (
          <Link href="/login" className="hover:text-brand-pink transition-colors">Login</Link>
        )}
      </div>

      {/* --- MOBILE HAMBURGER BUTTON (Visible on Mobile) --- */}
      <button 
        className="md:hidden text-white text-3xl focus:outline-none"
        onClick={() => setIsOpen(!isOpen)}
        aria-label="Toggle menu"
      >
        {isOpen ? '‚úï' : '‚ò∞'}
      </button>

      {/* --- MOBILE DROPDOWN MENU --- */}
      {isOpen && (
        <div className="absolute top-16 left-0 right-0 bg-brand-sky/95 backdrop-blur-xl border-b border-white/20 shadow-xl md:hidden flex flex-col p-6 gap-6 text-center text-white text-lg font-bold z-50 animate-in slide-in-from-top-2">
          
          <Link href="/" onClick={close} className="hover:text-brand-yellow py-2 border-b border-white/10">
            Home
          </Link>

          {isLoggedIn ? (
            <>
              <Link href="/common-room" onClick={close} className="hover:text-brand-yellow py-2 border-b border-white/10">
                Common Room
              </Link>
              <Link href="/family" onClick={close} className="hover:text-brand-yellow py-2 border-b border-white/10">
                Directory
              </Link>
              <Link href="/my-room" onClick={close} className="hover:text-brand-yellow py-2 border-b border-white/10">
                My Room
              </Link>
              <form action={logout} className="py-2">
                <button type="submit" className="text-white/80 hover:text-white">
                  Logout
                </button>
              </form>
            </>
          ) : (
            <Link href="/login" onClick={close} className="text-brand-pink py-2">
              Login
            </Link>
          )}
        </div>
      )}
    </>
  )
}
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

/src/generated/prisma
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="README.md">
# üíñ LoveMyFam (LMF)

### "A safe space for family. No strangers. No public. Just family."

-----

## üí° The Mission

In the age of endless notifications and cluttered group chats, staying genuinely connected with family often feels like a chore. **LoveMyFam** is designed to eliminate the friction and fatigue of modern communication methods‚Äîno more long, unplanned phone calls or searching through hundreds of text messages for one update.

LMF provides a private, asynchronous space built to facilitate **genuine and lasting communication** among family members.

## üè° The Common Room (CR)

The **Common Room** is the heart of the app. It acts as a central hub where all family members (FMs) can post concerns, share life updates, and collaborate on planning.

### Why Post to the Common Room?

| Pain Point Solved | LMF Solution |
| :--- | :--- |
| **Call Fatigue** | Skip the hassle of long phone calls and multiple video calls. |
| **Cluttered Group Chats**| Post one update, and *everyone* sees it, ensuring crucial information isn't missed. |
| **Exclusivity** | Our motto is our architecture: This is a **private, non-public** space. |

## ‚ú® Current Features (MVP)

As an ongoing project driven by continuous learning, the current feature set focuses on core communication:

  * **Secure Sign-In:** Authenticates family members to ensure platform exclusivity.
  * **Real-Time Feed:** Instantly pushes new updates to all active family members without requiring a page refresh.
  * **Asynchronous Posting:** Family members can post updates at their convenience.
  * **Database:** (Planned upgrade to PostgreSQL/Prisma).

## üöÄ The Development Journey

This project serves as a commitment to my ongoing growth as a full-stack developer. Building **LoveMyFam** allows me to integrate and master key concepts as I learn them.

| Technology Focus | Status & Goal |
| :--- | :--- |
| **Frontend** | **Next.js (App Router)**: Using React Server Components and Tailwind CSS. |
| **Backend** | **Next.js API Routes**: Handling business logic and database interactions. |
| **Deployment** | **Vercel**: Serverless deployment for instant scalability. |

-----

## üîó Connect with Me

Follow my journey as I build out new features for LMF and tackle new challenges!

[![My BlueSky Profile](https://img.shields.io/badge/BlueSky-0077B5?style=for-the-badge&logo=bluesky&logoColor=white)](https://bsky.app/profile/idongcodes.bsky.social)
[![My LinkedIn Profile](https://img.shields.io/badge/LinkedIn-0A66C2?style=for-the-badge&logo=linkedin&logoColor=white)](https://www.linkedin.com/in/idongcodes/)
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path=".windsurf/workflows/my-room.md">

</file>

<file path="prisma/seed.js">
const { PrismaClient } = require('@prisma/client')

const prisma = new PrismaClient()

async function main() {
  // 1. Create Admin User (Existing)
  await prisma.user.upsert({
    where: { email: 'idongesit_essien@ymail.com' },
    update: {},
    create: {
      email: 'idongesit_essien@ymail.com',
      firstName: 'Idongesit',
      lastName: 'Essien',
      alias: 'Idong',
      position: 'Creator',
      phone: '+17743126471',
      posts: {
        create: {
          content: 'Welcome to the Common Room! This is the first official post.',
        },
      },
    },
  })

  // 2. Create Default Settings (NEW)
  await prisma.systemSettings.upsert({
    where: { id: 'global' },
    update: {},
    create: {
      id: 'global',
      familySecret: 'familyfirst'
    }
  })

  console.log('Seed successful!')
}

main()
  .then(async () => {
    await prisma.$disconnect()
  })
  .catch(async (e) => {
    console.error(e)
    await prisma.$disconnect()
    process.exit(1)
  })
</file>

<file path="src/app/api/logout/route.ts">
import { NextRequest, NextResponse } from 'next/server'
import { logout } from '@/app/actions'

export async function POST(request: NextRequest) {
  try {
    // Handle beacon requests and regular POST requests
    const formData = await request.formData()
    const action = formData.get('action')
    
    if (action === 'logout') {
      await logout()
      return NextResponse.json({ success: true })
    }
    
    return NextResponse.json({ error: 'Invalid action' }, { status: 400 })
  } catch (error) {
    console.error('API logout error:', error)
    return NextResponse.json({ error: 'Logout failed' }, { status: 500 })
  }
}
</file>

<file path="src/app/api/user/[id]/route.ts">
import { NextRequest, NextResponse } from 'next/server'
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const { id } = await params
    
    // Fetch user from database
    const user = await prisma.user.findUnique({
      where: { id },
      select: {
        id: true,
        firstName: true,
        lastName: true,
        alias: true,
        profileImage: true
      }
    })

    if (!user) {
      return NextResponse.json(
        { error: 'User not found' },
        { status: 404 }
      )
    }

    return NextResponse.json(user)
  } catch (error) {
    console.error('Error fetching user:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}
</file>

<file path="src/app/chat/actions.ts">
'use server'

import { PrismaClient } from '@prisma/client'
import { revalidatePath } from 'next/cache'

const prisma = new PrismaClient()

export async function getChatMessages() {
  try {
    const messages = await prisma.chatMessage.findMany({
      include: {
        author: {
          select: {
            id: true,
            firstName: true,
            lastName: true,
            alias: true,
            profileImage: true,
          }
        }
      },
      orderBy: {
        createdAt: 'asc'
      }
    })
    
    return { success: true, messages }
  } catch (error) {
    console.error('Error fetching chat messages:', error)
    return { success: false, message: 'Failed to fetch messages' }
  }
}

export async function sendChatMessage(content: string, authorId: string) {
  try {
    if (!content.trim()) {
      return { success: false, message: 'Message cannot be empty' }
    }

    const message = await prisma.chatMessage.create({
      data: {
        content: content.trim(),
        authorId
      },
      include: {
        author: {
          select: {
            id: true,
            firstName: true,
            lastName: true,
            alias: true,
            profileImage: true,
          }
        }
      }
    })

    revalidatePath('/chat')
    return { success: true, message }
  } catch (error) {
    console.error('Error sending chat message:', error)
    return { success: false, message: 'Failed to send message' }
  }
}
</file>

<file path="src/app/register/actions.ts">
'use server'

import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'

const prisma = new PrismaClient()

export async function registerUser(formData: FormData) {
  const firstName = formData.get('firstName') as string
  const lastName = formData.get('lastName') as string
  const alias = formData.get('alias') as string || firstName
  const email = formData.get('email') as string
  const phone = formData.get('phone') as string
  const securityAnswer = formData.get('securityAnswer') as string
  
  // 1. GRAB THE POSITION FROM THE FORM
  const position = formData.get('position') as string 

  // 2. THE SECURITY CHECK
  if (securityAnswer.trim().toLowerCase() !== 'mercy') {
    return { success: false, message: "Incorrect security answer." }
  }

  // 3. CHECK IF USER EXISTS
  const existingUser = await prisma.user.findUnique({
    where: { email: email }
  })

  if (existingUser) {
    return { success: false, message: "This email is already registered. Please Login." }
  }

  // 4. CREATE THE USER (INCLUDE POSITION!)
  const newUser = await prisma.user.create({
    data: {
      firstName,
      lastName,
      alias,
      email,
      phone,
      position, // <--- THIS WAS MISSING
    }
  })

  // 5. SET SESSION COOKIE
  const cookieStore = await cookies()
  cookieStore.set('session_id', newUser.id, {
    httpOnly: true,
    secure: process.env.NODE_ENV === 'production',
    maxAge: 60 * 60 * 24 * 7, // 1 week
    path: '/',
  })

  // Also set a client-readable cookie for chat functionality
  cookieStore.set('user_session', newUser.id, {
    httpOnly: false, // Allow client-side access
    secure: process.env.NODE_ENV === 'production',
    maxAge: 60 * 60 * 24 * 7, // 1 week
    path: '/',
  })

  // 6. STORE JOIN MESSAGE IN COOKIE FOR CHAT MODAL
  const displayName = alias || firstName
  cookieStore.set('new_user_join_message', `${displayName} has joined the app! üéâ`, {
    httpOnly: false, // Allow client-side access
    secure: process.env.NODE_ENV === 'production',
    maxAge: 60 * 60 * 24 * 7, // 1 week
    path: '/',
  })

  return { success: true }
}
</file>

<file path="src/app/actions.ts">
'use server'

import { cookies } from 'next/headers'
import { redirect } from 'next/navigation'

// ... (keep your existing logout function) ...
export async function logout() {
  const cookieStore = await cookies()
  cookieStore.delete('session_id')
  redirect('/')
}

// NEW: Handle General Feedback
export async function submitGeneralFeedback(content: string) {
  const cookieStore = await cookies()
  const userId = cookieStore.get('session_id')?.value

  if (!userId) {
    return { error: 'unauthorized' }
  }

  // TODO: Save this to a database table (e.g., 'Feedback') later.
  console.log("Feedback received:", content, "From:", userId)

  return { success: true }
}
</file>

<file path="src/app/globals.css">
@import "tailwindcss";

@theme {
  /* This automatically creates bg-brand-sky, text-brand-pink, etc. */
  --color-brand-sky: #87CEEB;    /* Sky blue */
  --color-brand-pink: #FFC5D3;   /* Blush Pink */
  --color-brand-yellow: #FFFFC5; /* Pale Yellow */
  --color-brand-cream: #FDFBD4;  /* Cream */
}

/* Force light theme regardless of device preferences */
:root {
  --background: #ffffff;
  --foreground: #171717;
  color-scheme: light;
}

/* Override dark mode preferences */
@media (prefers-color-scheme: dark) {
  :root {
    --background: #ffffff;
    --foreground: #171717;
    color-scheme: light;
  }
}

/* Force light theme on body */
body {
  background: var(--background);
  color: var(--foreground);
  color-scheme: light;
}

/* Override any dark mode styles */
html, body {
  color-scheme: light !important;
}

/* Ensure inputs and form elements stay in light mode */
input, textarea, select, button {
  color-scheme: light;
}

/* Force light scrollbars */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}
</file>

<file path="src/components/DailyVerse.tsx">
// src/components/DailyVerse.tsx
import { getDailyVerse } from '@/lib/verses';

export default function DailyVerse() {
  const verse = getDailyVerse();

  return (
    <div className="mt-12 max-w-2xl px-6 animate-in fade-in slide-in-from-bottom-4 duration-1000 delay-300">
      <div className="relative">
        {/* Decorative Quote Mark */}
        <span className="absolute -top-6 -left-4 text-6xl text-brand-cream opacity-40 font-serif">
          &ldquo;
        </span>
        
        <blockquote className="text-xl md:text-2xl font-serif italic text-white leading-relaxed text-center relative z-10 drop-shadow-sm">
          {verse.text}
        </blockquote>
        
        {/* Decorative Quote Mark */}
        <span className="absolute -bottom-10 -right-4 text-6xl text-brand-cream opacity-40 font-serif rotate-180">
          &ldquo;
        </span>
      </div>

      <p className="text-center text-brand-cream font-bold mt-4 text-sm tracking-widest uppercase opacity-90">
        ‚Äî {verse.reference} ‚Äî
      </p>
    </div>
  );
}
</file>

<file path="src/components/EmojiButton.tsx">
'use client'

import { useState, useEffect, useRef } from 'react'
import EmojiPicker, { Theme } from 'emoji-picker-react'

interface EmojiButtonProps {
  onEmojiSelect: (emoji: string) => void
  color?: string
}

export default function EmojiButton({ onEmojiSelect, color = "text-slate-400" }: EmojiButtonProps) {
  const [isOpen, setIsOpen] = useState(false)
  const wrapperRef = useRef<HTMLDivElement>(null)

  // Close if clicked outside
  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) {
        setIsOpen(false)
      }
    }
    document.addEventListener("mousedown", handleClickOutside)
    return () => document.removeEventListener("mousedown", handleClickOutside)
  }, [])

  return (
    <div className="relative" ref={wrapperRef}>
      <button
        type="button"
        onClick={() => setIsOpen(!isOpen)}
        className={`${color} hover:text-brand-yellow transition-colors p-1.5 rounded-full hover:bg-slate-100 flex items-center justify-center`}
        title="Add Emoji"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
          <path strokeLinecap="round" strokeLinejoin="round" d="M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z" />
        </svg>
      </button>

      {isOpen && (
        <div className="absolute z-50 bottom-full right-0 mb-2 shadow-xl rounded-xl border border-slate-100 animate-in zoom-in-95 duration-200">
           <EmojiPicker
             onEmojiClick={(data) => {
               onEmojiSelect(data.emoji)
               setIsOpen(false)
             }}
             theme={Theme.LIGHT}
             lazyLoadEmojis={true}
             width={300}
             height={400}
           />
        </div>
      )}
    </div>
  )
}
</file>

<file path="src/components/Navbar.tsx">
import Link from 'next/link'
import { cookies } from 'next/headers'
import BottomNav from './BottomNav'

export default async function Navbar() {
  const cookieStore = await cookies()
  const isLoggedIn = cookieStore.has('session_id')

  return (
    <>
      {/* Simple top logo */}
      <nav className="fixed top-0 left-0 right-0 z-40 bg-brand-sky/50 backdrop-blur-sm border-b border-white/10">
        <div className="max-w-5xl mx-auto px-6 h-12 flex items-center justify-center">
          <Link href="/" className="text-white font-bold text-lg tracking-tight hover:text-brand-cream transition-colors drop-shadow-sm">
            LoveMyFam
          </Link>
        </div>
      </nav>

      {/* Bottom navigation */}
      <BottomNav isLoggedIn={isLoggedIn} />
    </>
  )
}
</file>

<file path="src/lib/verses.ts">
// src/lib/verses.ts

export interface Verse {
  text: string;
  reference: string;
}

export const verses: Verse[] = [
  { text: "Love is patient, love is kind. It does not envy, it does not boast, it is not proud.", reference: "1 Corinthians 13:4" },
  { text: "Be kind to one another, tenderhearted, forgiving one another, as God in Christ forgave you.", reference: "Ephesians 4:32" },
  { text: "Above all, keep loving one another earnestly, since love covers a multitude of sins.", reference: "1 Peter 4:8" },
  { text: "Behold, how good and pleasant it is when brothers dwell in unity!", reference: "Psalm 133:1" },
  { text: "Let all that you do be done in love.", reference: "1 Corinthians 16:14" },
  { text: "A friend loves at all times, and a brother is born for adversity.", reference: "Proverbs 17:17" },
  { text: "Bear one another's burdens, and so fulfill the law of Christ.", reference: "Galatians 6:2" },
  { text: "And over all these virtues put on love, which binds them all together in perfect unity.", reference: "Colossians 3:14" },
  { text: "Honor your father and your mother, that your days may be long in the land that the Lord your God is giving you.", reference: "Exodus 20:12" },
  { text: "Children's children are a crown to the aged, and parents are the pride of their children.", reference: "Proverbs 17:6" },
  { text: "We love because he first loved us.", reference: "1 John 4:19" },
  { text: "Trust in the Lord with all your heart, and do not lean on your own understanding.", reference: "Proverbs 3:5" },
  { text: "I have no greater joy than to hear that my children are walking in the truth.", reference: "3 John 1:4" },
  { text: "For I know the plans I have for you, declares the Lord, plans for welfare and not for evil, to give you a future and a hope.", reference: "Jeremiah 29:11" },
  { text: "The Lord is my shepherd; I shall not want.", reference: "Psalm 23:1" },
  { text: "But the fruit of the Spirit is love, joy, peace, patience, kindness, goodness, faithfulness.", reference: "Galatians 5:22" },
  { text: "Cast all your anxiety on him because he cares for you.", reference: "1 Peter 5:7" },
  { text: "This is the day that the Lord has made; let us rejoice and be glad in it.", reference: "Psalm 118:24" },
  { text: "As for me and my house, we will serve the Lord.", reference: "Joshua 24:15" },
  { text: "Train up a child in the way he should go; even when he is old he will not depart from it.", reference: "Proverbs 22:6" },
];

export function getDailyVerse(): Verse {
  // 1. Get current time
  const now = new Date();
  
  // 2. Convert to Eastern Time string to handle DST automatically
  const estString = now.toLocaleString("en-US", { timeZone: "America/New_York" });
  const estDate = new Date(estString);

  // 3. Adjust for 7 AM cutoff
  // If it's before 7 AM, we subtract 1 day so we are still showing "yesterday's" verse.
  // This effectively makes the "new day" start at 7 AM.
  if (estDate.getHours() < 7) {
    estDate.setDate(estDate.getDate() - 1);
  }

  // 4. Create a unique seed string for this "day" (YYYY-MM-DD)
  const seedString = `${estDate.getFullYear()}-${estDate.getMonth()}-${estDate.getDate()}`;
  
  // 5. Simple hash function to turn string into integer
  let hash = 0;
  for (let i = 0; i < seedString.length; i++) {
    hash = ((hash << 5) - hash) + seedString.charCodeAt(i);
    hash |= 0; // Convert to 32bit integer
  }
  
  // 6. Pick a verse deterministically
  const index = Math.abs(hash) % verses.length;
  return verses[index];
}
</file>

<file path="src/middleware.ts">
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

// Define the few routes that are safe for strangers
const publicRoutes = [
  '/', 
  '/login', 
  '/register', 
  '/about' // Future-proofed as requested
]

export function middleware(request: NextRequest) {
  const session = request.cookies.get('session_id')
  const path = request.nextUrl.pathname

  // 1. Check if the current path is in our "Public List"
  const isPublic = publicRoutes.includes(path)

  // 2. If the route is NOT public and the user is NOT logged in...
  if (!isPublic && !session) {
    // ...kick them back to the login page
    return NextResponse.redirect(new URL('/login', request.url))
  }

  return NextResponse.next()
}

// 3. Update the Matcher to run on EVERYTHING
// (We exclude Next.js internal files, images, and API routes to keep things fast)
export const config = {
  matcher: [
    '/((?!api|_next/static|_next/image|favicon.ico|images).*)',
  ],
}
</file>

<file path="check-data.js">
const { PrismaClient } = require('@prisma/client')

const prisma = new PrismaClient()

async function checkData() {
  try {
    console.log('=== CHECKING DATABASE DATA ===')
    
    // Check Posts
    const posts = await prisma.post.findMany()
    console.log(`\nüìù POSTS: ${posts.length} found`)
    posts.forEach(post => {
      console.log(`  - "${post.content.substring(0, 50)}..." by ${post.authorId}`)
    })
    
    // Check Testimonials
    const testimonials = await prisma.testimonial.findMany()
    console.log(`\nüí¨ TESTIMONIALS: ${testimonials.length} found`)
    testimonials.forEach(testimonial => {
      console.log(`  - "${testimonial.content.substring(0, 50)}..." by ${testimonial.authorId}`)
    })
    
    // Check Users
    const users = await prisma.user.findMany()
    console.log(`\nüë• USERS: ${users.length} found`)
    users.forEach(user => {
      console.log(`  - ${user.firstName} ${user.lastName} (${user.email})`)
    })
    
  } catch (error) {
    console.error('‚ùå Error checking data:', error)
  } finally {
    await prisma.$disconnect()
  }
}

checkData()
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  reactCompiler: true,
  experimental: {
    serverActions: {
      bodySizeLimit: '20mb', // <--- Updated to 20mb
    },
  },
};

export default nextConfig;
</file>

<file path="restore-data.js">
const { PrismaClient } = require('@prisma/client')

const prisma = new PrismaClient()

async function restoreData() {
  try {
    console.log('=== ATTEMPTING TO RESTORE MISSING DATA ===')
    
    // Check current state
    const posts = await prisma.post.findMany({
      include: {
        author: true,
        comments: {
          include: {
            author: true
          }
        }
      }
    })
    
    const testimonials = await prisma.testimonial.findMany({
      include: {
        author: true
      }
    })
    
    const users = await prisma.user.findMany()
    
    console.log(`\nüìä CURRENT STATE:`)
    console.log(`  Users: ${users.length}`)
    console.log(`  Posts: ${posts.length}`)
    console.log(`  Testimonials: ${testimonials.length}`)
    
    // Look for announcements (posts with isAnnouncement = true)
    const announcements = posts.filter(post => post.isAnnouncement)
    console.log(`  Announcements: ${announcements.length}`)
    
    // Show post details
    console.log(`\nüìù POSTS DETAILS:`)
    posts.forEach(post => {
      console.log(`  - "${post.content.substring(0, 60)}..."`)
      console.log(`    Author: ${post.author?.firstName} ${post.author?.lastName}`)
      console.log(`    Comments: ${post.comments?.length || 0}`)
      console.log(`    Announcement: ${post.isAnnouncement}`)
      console.log(`    Urgent: ${post.isUrgent}`)
      console.log('')
    })
    
    // Show testimonials
    console.log(`üí¨ TESTIMONIALS DETAILS:`)
    testimonials.forEach(testimonial => {
      console.log(`  - "${testimonial.content.substring(0, 60)}..."`)
      console.log(`    Author: ${testimonial.author?.firstName} ${testimonial.author?.lastName}`)
      console.log('')
    })
    
  } catch (error) {
    console.error('‚ùå Error:', error)
  } finally {
    await prisma.$disconnect()
  }
}

restoreData()
</file>

<file path="prisma/seed.ts">
const { PrismaClient } = require('@prisma/client')

const prisma = new PrismaClient()

async function main() {
  // 1. Create Admin User (Existing)
  await prisma.user.upsert({
    where: { email: 'idongesit_essien@ymail.com' },
    update: {},
    create: {
      email: 'idongesit_essien@ymail.com',
      firstName: 'Idongesit',
      lastName: 'Essien',
      alias: 'Idong',
      position: 'Creator',
      phone: '+17743126471',
      posts: {
        create: {
          content: 'Welcome to the Common Room! This is the first official post.',
        },
      },
    },
  })

  // 2. Create Default Settings (NEW)
  await prisma.systemSettings.upsert({
    where: { id: 'global' },
    update: {},
    create: {
      id: 'global',
      familySecret: 'familyfirst'
    }
  })

  console.log('Seed successful!')
}

main()
  .then(async () => {
    await prisma.$disconnect()
  })
  .catch(async (e) => {
    console.error(e)
    await prisma.$disconnect()
    process.exit(1)
  })
</file>

<file path="scripts/auto-update-whatsnew.js">
#!/usr/bin/env node

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// User-friendly commit message parser
function parseCommitMessage(message) {
  const lowerMessage = message.toLowerCase();
  
  // Skip admin/technical commits
  const adminKeywords = ['merge', 'pull from', 'hotfix', 'refactor', 'test', 'ci', 'chore', 'docs', 'build', 'deps'];
  if (adminKeywords.some(keyword => lowerMessage.includes(keyword))) {
    return null;
  }
  
  // Categorize based on keywords
  if (lowerMessage.includes('fix') || lowerMessage.includes('bug') || lowerMessage.includes('error')) {
    return {
      category: 'fix',
      icon: 'üîß',
      status: 'just-released'
    };
  }
  
  if (lowerMessage.includes('add') || lowerMessage.includes('new') || lowerMessage.includes('implement')) {
    return {
      category: 'feature',
      icon: 'üöÄ',
      status: 'just-released'
    };
  }
  
  if (lowerMessage.includes('update') || lowerMessage.includes('improve') || lowerMessage.includes('enhance')) {
    return {
      category: 'update',
      icon: '‚ö°',
      status: 'recently-updated'
    };
  }
  
  // Default to feature for user-visible changes
  return {
    category: 'feature',
    icon: '‚ú®',
    status: 'just-released'
  };
}

// Convert commit message to user-friendly title
function makeUserFriendlyTitle(message) {
  // Remove technical jargon
  let title = message
    .replace(/fix:?\s*/gi, '')
    .replace(/feat:?\s*/gi, '')
    .replace(/add:?\s*/gi, '')
    .replace(/update:?\s*/gi, '')
    .replace(/implement:?\s*/gi, '')
    .replace(/\b(git|github|commit|push|pull|merge|branch)\b/gi, '')
    .trim();
  
  // Capitalize first letter
  title = title.charAt(0).toUpperCase() + title.slice(1);
  
  // Limit length
  if (title.length > 50) {
    title = title.substring(0, 47) + '...';
  }
  
  return title || 'New Update';
}

// Convert commit message to user-friendly description
function makeUserFriendlyDescription(message) {
  // Remove technical prefixes
  let description = message
    .replace(/^(fix|feat|add|update|implement|chore|docs|build|ci|refactor):\s*/i, '')
    .replace(/\b(git|github|commit|push|pull|merge|branch|repo|repository)\b/gi, '')
    .trim();
  
  // Make it more user-focused
  if (description.toLowerCase().includes('login')) {
    return 'Improvements to the login experience for better security and convenience.';
  }
  
  if (description.toLowerCase().includes('nav') || description.toLowerCase().includes('menu')) {
    return 'Enhanced navigation to make moving around the app easier and more intuitive.';
  }
  
  if (description.toLowerCase().includes('chat') || description.toLowerCase().includes('message')) {
    return 'Better messaging features to keep your family conversations flowing smoothly.';
  }
  
  if (description.toLowerCase().includes('profile') || description.toLowerCase().includes('room')) {
    return 'Updates to your personal space to make it more enjoyable and functional.';
  }
  
  // Default description
  return description || 'New features and improvements to enhance your family experience.';
}

// Get version from git or package.json
function getVersion() {
  try {
    const packageJson = JSON.parse(fs.readFileSync('package.json', 'utf8'));
    return packageJson.version || 'latest';
  } catch {
    return 'latest';
  }
}

// Main function
function main() {
  const commitMessage = process.argv[2];
  
  if (!commitMessage) {
    console.error('Usage: node auto-update-whatsnew.js "<commit-message>"');
    process.exit(1);
  }
  
  const parsed = parseCommitMessage(commitMessage);
  
  if (!parsed) {
    console.log('Skipping admin/technical commit:', commitMessage);
    process.exit(0);
  }
  
  const title = makeUserFriendlyTitle(commitMessage);
  const description = makeUserFriendlyDescription(commitMessage);
  const version = getVersion();
  
  // Create new update entry
  const newUpdate = {
    id: title.toLowerCase().replace(/\s+/g, '-'),
    title,
    description,
    icon: parsed.icon,
    category: parsed.category,
    status: parsed.status,
    date: new Date().toISOString(),
    version
  };
  
  // Read current whatsNew.ts file
  const whatsNewPath = path.join(__dirname, '../src/lib/whatsNew.ts');
  let content = fs.readFileSync(whatsNewPath, 'utf8');
  
  // Find the whatsNewData array and insert new update at the beginning
  const arrayStart = content.indexOf('export const whatsNewData: UpdateItem[] = [');
  const firstObjectStart = content.indexOf('{', arrayStart);
  const firstObjectEnd = content.indexOf('},', firstObjectStart);
  
  if (arrayStart === -1 || firstObjectEnd === -1) {
    console.error('Could not find whatsNewData array structure');
    process.exit(1);
  }
  
  // Insert new update as first item in array
  const beforeFirstObject = content.substring(0, firstObjectStart);
  const afterFirstObject = content.substring(firstObjectEnd);
  
  const newEntry = `  {
    id: '${newUpdate.id}',
    title: '${newUpdate.title}',
    description: '${newUpdate.description}',
    icon: '${newUpdate.icon}',
    category: '${newUpdate.category}',
    status: '${newUpdate.status}',
    date: new Date('${newUpdate.date}'),
    version: '${newUpdate.version}'
  },`;
  
  const updatedContent = beforeFirstObject + newEntry + afterFirstObject;
  
  // Write back to file
  fs.writeFileSync(whatsNewPath, updatedContent);
  
  console.log(`‚ú® Added user-friendly update: "${title}"`);
  console.log(`   Category: ${parsed.category}, Version: ${version}`);
}

main();
</file>

<file path="src/app/api/test-blob/route.ts">
import { put } from '@vercel/blob'
import { NextResponse } from 'next/server'

export async function POST() {
  try {
    console.log('Testing blob storage...')
    
    // Create a test file
    const testContent = 'This is a test file for blob storage'
    const testBlob = new Blob([testContent], { type: 'text/plain' })
    
    // Test upload to blob storage
    const blob = await put('test-upload.txt', testBlob)
    
    console.log('Upload successful:', blob.url)
    
    return NextResponse.json({ 
      success: true, 
      message: 'Blob storage working',
      url: blob.url 
    })
  } catch (error) {
    console.error('Blob storage error:', error)
    return NextResponse.json({ 
      success: false, 
      message: 'Blob storage failed',
      error: error instanceof Error ? error.message : 'Unknown error'
    }, { status: 500 })
  }
}

export async function GET() {
  try {
    // Test if we can read blob config
    const testContent = 'Test file content'
    const testBlob = new Blob([testContent], { type: 'text/plain' })
    
    const blob = await put('get-test.txt', testBlob)
    
    return NextResponse.json({ 
      success: true, 
      message: 'GET test successful',
      url: blob.url 
    })
  } catch (error) {
    return NextResponse.json({ 
      success: false, 
      message: 'GET test failed',
      error: error instanceof Error ? error.message : 'Unknown error'
    }, { status: 500 })
  }
}
</file>

<file path="src/app/login/actions.ts">
'use server'

import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'

const prisma = new PrismaClient()

export async function login(formData: FormData) {
  const email = formData.get('email') as string
  const password = formData.get('password') as string

  // 1. FETCH SECRET FROM DB
  const settings = await prisma.systemSettings.findUnique({
    where: { id: 'global' }
  })
  
  // Fallback to 'familyfirst' if DB record is missing (safety net)
  const currentSecret = settings?.familySecret || 'familyfirst'

  // 2. CHECK PASSWORD
  if (password !== currentSecret) {
    return { success: false, message: 'Wrong family secret!' }
  }

  // 3. CHECK USER
  const user = await prisma.user.findUnique({
    where: { email: email }
  })

  if (!user) {
    return { success: false, message: 'Email not found. Please register first!' }
  }

  const cookieStore = await cookies()
  cookieStore.set('session_id', user.id, {
    httpOnly: true,
    secure: process.env.NODE_ENV === 'production',
    maxAge: 60 * 60 * 24 * 7, // 1 week
    path: '/',
  })

  // Also set a client-readable cookie for chat functionality
  cookieStore.set('user_session', user.id, {
    httpOnly: false, // Allow client-side access
    secure: process.env.NODE_ENV === 'production',
    maxAge: 60 * 60 * 24 * 7, // 1 week
    path: '/',
  })

  return { success: true }
}
</file>

<file path="src/app/my-room/page.tsx">
import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'
import MyRoomClient from '@/components/MyRoomClient'

const prisma = new PrismaClient()

async function getUser() {
  const cookieStore = await cookies()
  const userId = cookieStore.get('session_id')?.value
  if (!userId) return null

  return await prisma.user.findUnique({
    where: { id: userId }
  })
}

async function getSystemSettings() {
  const settings = await prisma.systemSettings.findUnique({
    where: { id: 'global' }
  })
  return settings?.familySecret || 'familyfirst'
}

export default async function MyRoom() {
  const user = await getUser()
  const familySecret = await getSystemSettings() // <--- Fetch Secret

  if (!user) {
    return (
      <main className="min-h-screen flex items-center justify-center font-sans">
        <p>Please log in to view your room.</p>
      </main>
    )
  }

  return (
    <main className="min-h-screen bg-slate-50 font-sans p-8">
      {/* Pass secret to client */}
      <MyRoomClient user={user} familySecret={familySecret} />
    </main>
  )
}
</file>

<file path="src/components/AnnouncementCarousel.tsx">
'use client'

import { useState, useEffect } from 'react'
import AnnouncementModal from './AnnouncementModal'
import { deletePost } from '@/app/common-room/actions'
import { useRouter } from 'next/navigation'

export default function AnnouncementCarousel({ 
  announcements, 
  currentUserEmail 
}: { 
  announcements: any[], 
  currentUserEmail?: string 
}) {
  const router = useRouter()
  const [index, setIndex] = useState(0)
  const [isPaused, setIsPaused] = useState(false)
  
  // State for modals
  const [showAddModal, setShowAddModal] = useState(false)
  const [editingItem, setEditingItem] = useState<any | null>(null)

  const isAdmin = currentUserEmail === 'idongesit_essien@ymail.com'

  // Auto-scroll logic
  useEffect(() => {
    // Don't scroll if paused OR if we are currently editing something
    if (announcements.length <= 1 || isPaused || editingItem) return

    const timer = setInterval(() => {
      setIndex(prev => (prev + 1) % announcements.length)
    }, 5000)

    return () => clearInterval(timer)
  }, [announcements.length, isPaused, editingItem])

  // Handle Delete
  const handleDelete = async (id: string) => {
    if (confirm("Are you sure you want to delete this announcement?")) {
      await deletePost(id)
      setIndex(0) // Reset index so we don't get stuck on a deleted item
      router.refresh()
    }
  }

  const currentAnnouncement = announcements[index]

  if (announcements.length === 0 && !isAdmin) return null

  return (
    <div className="mb-8">
      
      {/* CAROUSEL CONTAINER */}
      {announcements.length > 0 && currentAnnouncement && (
        <div 
          className="relative overflow-hidden bg-brand-sky rounded-2xl shadow-sm border border-brand-sky/20 text-white p-6 cursor-pointer group"
          onClick={() => setIsPaused(true)} 
          onMouseEnter={() => setIsPaused(true)}
          onMouseLeave={() => setIsPaused(false)}
        >
          {/* CONTENT */}
          <div className="relative h-20 flex items-center">
             {announcements.map((ann, i) => (
               <div 
                 key={ann.id}
                 className={`absolute inset-0 transition-all duration-500 ease-in-out flex flex-col justify-center
                   ${i === index ? 'opacity-100 translate-x-0' : 'opacity-0 translate-x-10 pointer-events-none'}
                 `}
               >
                 <h3 className="font-bold text-lg mb-1 flex items-center gap-2">
                   {ann.isUrgent && <span>üö®</span>}
                   {ann.title}
                 </h3>
                 <p className="text-white/90 text-sm line-clamp-2 leading-relaxed">
                   {ann.content}
                 </p>
               </div>
             ))}
          </div>

          {/* ADMIN CONTROLS (Overlay) */}
          {isAdmin && (
            <div className="absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-10">
              <button 
                onClick={(e) => {
                  e.stopPropagation()
                  setEditingItem(currentAnnouncement)
                }}
                className="bg-white/20 hover:bg-white/40 text-white p-1.5 rounded-full backdrop-blur-md transition-colors"
                title="Edit"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-4 h-4">
                  <path strokeLinecap="round" strokeLinejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                </svg>
              </button>
              <button 
                onClick={(e) => {
                  e.stopPropagation()
                  handleDelete(currentAnnouncement.id)
                }}
                className="bg-white/20 hover:bg-red-500/80 text-white p-1.5 rounded-full backdrop-blur-md transition-colors"
                title="Delete"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-4 h-4">
                  <path strokeLinecap="round" strokeLinejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                </svg>
              </button>
            </div>
          )}

          {/* Dots */}
          <div className="absolute bottom-3 right-4 flex gap-1.5">
            {announcements.map((_, i) => (
              <div 
                key={i} 
                className={`w-1.5 h-1.5 rounded-full transition-all ${i === index ? 'bg-white' : 'bg-white/30'}`} 
              />
            ))}
          </div>
        </div>
      )}

      {/* ADMIN ADD BUTTON */}
      {isAdmin && (
        <div className="text-right mt-2">
          <button 
            onClick={() => setShowAddModal(true)}
            className="text-xs font-bold text-brand-sky hover:text-sky-600 flex items-center justify-end gap-1 ml-auto"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4">
              <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
            </svg>
            Add Announcement
          </button>
        </div>
      )}

      {/* CREATE MODAL */}
      {showAddModal && (
        <AnnouncementModal onClose={() => setShowAddModal(false)} />
      )}

      {/* EDIT MODAL */}
      {editingItem && (
        <AnnouncementModal 
          initialData={{
            id: editingItem.id,
            title: editingItem.title,
            content: editingItem.content,
            isUrgent: editingItem.isUrgent
          }}
          onClose={() => setEditingItem(null)} 
        />
      )}
    </div>
  )
}
</file>

<file path="src/components/AnnouncementModal.tsx">
'use client'

import { useState } from 'react'
import { createAnnouncement, editPost } from '@/app/common-room/actions'

interface AnnouncementModalProps {
  onClose: () => void
  initialData?: {
    id: string
    title: string
    content: string
    isUrgent: boolean
  }
}

export default function AnnouncementModal({ onClose, initialData }: AnnouncementModalProps) {
  const [isSubmitting, setIsSubmitting] = useState(false)
  
  // Initialize state with props if editing, otherwise defaults
  const [isUrgent, setIsUrgent] = useState(initialData?.isUrgent || false)
  const [title, setTitle] = useState(initialData?.title || '')
  const [message, setMessage] = useState(initialData?.content || '')

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault()
    setIsSubmitting(true)

    let result
    
    if (initialData) {
      // EDIT MODE: Reuse existing editPost action
      result = await editPost(initialData.id, message, title, isUrgent)
    } else {
      // CREATE MODE: Use createAnnouncement action
      const formData = new FormData()
      formData.append('title', title)
      formData.append('message', message)
      formData.append('isUrgent', isUrgent.toString())
      
      result = await createAnnouncement(formData)
    }

    setIsSubmitting(false)

    if (result.success) {
      onClose()
    } else {
      alert(result.message)
    }
  }

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onClick={onClose} />
      
      <div className="relative bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-in zoom-in-95">
        <h2 className="text-xl font-bold text-slate-800 mb-4">
          {initialData ? 'Edit Announcement' : 'New Announcement'}
        </h2>
        
        <form onSubmit={handleSubmit} className="flex flex-col gap-4">
          
          {/* Title */}
          <div>
            <label className="block text-xs font-bold text-slate-500 mb-1">TITLE</label>
            <input 
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              required 
              placeholder="e.g. Family Reunion" 
              className="w-full p-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none"
            />
          </div>

          {/* Message */}
          <div>
            <label className="block text-xs font-bold text-slate-500 mb-1">MESSAGE</label>
            <textarea 
              value={message}
              onChange={(e) => setMessage(e.target.value)}
              required 
              rows={4}
              placeholder="What's happening?" 
              className="w-full p-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none resize-none"
            />
          </div>

          {/* Urgent Toggle */}
          <div 
            onClick={() => setIsUrgent(!isUrgent)}
            className={`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${isUrgent ? 'bg-red-50 border-red-200' : 'bg-slate-50 border-slate-100'}`}
          >
            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${isUrgent ? 'border-red-500' : 'border-slate-300'}`}>
              {isUrgent && <div className="w-2.5 h-2.5 rounded-full bg-red-500" />}
            </div>
            <span className={`font-bold ${isUrgent ? 'text-red-500' : 'text-slate-500'}`}>Mark as Urgent</span>
          </div>

          <div className="flex gap-2 justify-end mt-2">
            <button type="button" onClick={onClose} className="px-4 py-2 text-slate-400 hover:text-slate-600 font-bold">Cancel</button>
            <button 
              type="submit" 
              disabled={isSubmitting}
              className="bg-brand-sky text-white px-6 py-2 rounded-lg font-bold hover:bg-sky-500 shadow-sm disabled:opacity-50"
            >
              {isSubmitting ? 'Saving...' : (initialData ? 'Update' : 'Post')}
            </button>
          </div>

        </form>
      </div>
    </div>
  )
}
</file>

<file path="src/components/FamilyPositionIcon.tsx">
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'

interface FamilyPositionIconProps {
  position: string
  size?: 'small' | 'medium' | 'large'
  className?: string
}

export default function FamilyPositionIcon({ position, size = 'medium', className = '' }: FamilyPositionIconProps) {
  const [showTooltip, setShowTooltip] = useState(false)
  const router = useRouter()

  const handleClick = () => {
    // Navigate to a page that shows family positions or filter by position
    router.push(`/family?position=${encodeURIComponent(position)}`)
  }

  const textSizes = {
    small: 'text-[10px]',
    medium: 'text-[11px]', 
    large: 'text-[12px]'
  }

  const tooltipPosition = size === 'small' ? 'bottom-full left-1/2 -translate-x-1/2 mb-2' : 'bottom-full left-1/2 -translate-x-1/2 mb-3'

  return (
    <div className={`relative inline-flex items-center justify-center ${className}`}>
      <div
        className={`${textSizes[size]} text-brand-sky font-bold cursor-pointer transition-all duration-200 hover:text-brand-pink hover:underline`}
        onMouseEnter={() => setShowTooltip(true)}
        onMouseLeave={() => setShowTooltip(false)}
        onClick={handleClick}
      >
        Family Position
      </div>
      
      {/* Tooltip */}
      {showTooltip && (
        <div className={`absolute ${tooltipPosition} z-50 pointer-events-none`}>
          <div className="bg-slate-800 text-white text-xs font-medium px-3 py-2 rounded-lg shadow-lg whitespace-nowrap">
            <div className="relative">
              {position}
              {/* Tooltip arrow */}
              <div className="absolute top-full left-1/2 -translate-x-1/2 -mt-1">
                <div className="border-4 border-transparent border-t-slate-800"></div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  )
}
</file>

<file path="src/components/FeedbackWidget.tsx">
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { submitGeneralFeedback } from '@/app/actions'

export default function FeedbackWidget() {
  const [isOpen, setIsOpen] = useState(false)
  const [content, setContent] = useState('')
  const [isSubmitting, setIsSubmitting] = useState(false)
  const router = useRouter()

  const handleSubmit = async () => {
    if (!content.trim()) return

    setIsSubmitting(true)
    
    // Server Action checks if we are logged in
    const result = await submitGeneralFeedback(content)
    
    setIsSubmitting(false)

    if (result.success) {
      setIsOpen(false)
      setContent('')
      alert("Feedback received! We appreciate you.")
    } else if (result.error === 'unauthorized') {
      // Logic for Guest Users
      setIsOpen(false)
      if (confirm("Please log in to submit feedback.")) {
        router.push('/login')
      }
    } else {
      alert("Something went wrong. Please try again.")
    }
  }

  return (
    <>
      {/* TRIGGER LINK */}
      <div className="w-full text-center pb-4">
        <button 
          onClick={() => setIsOpen(true)}
          className="text-slate-400 hover:text-brand-sky text-sm font-medium transition-colors underline decoration-slate-700 underline-offset-4 hover:decoration-brand-sky"
        >
          Click here for issues, feature requests, suggestions or general feedback.
        </button>
      </div>

      {/* MODAL */}
      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          
          {/* Backdrop */}
          <div 
            className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"
            onClick={() => setIsOpen(false)}
          />

          {/* Content */}
          <div className="relative bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-in zoom-in-95 duration-200 border border-slate-100">
            
            {/* Header */}
            <div className="flex justify-between items-start mb-4">
              <h3 className="text-xl font-bold text-slate-800">
                Share your feedback
              </h3>
              <button 
                onClick={() => setIsOpen(false)}
                className="text-slate-400 hover:text-slate-600 p-1 rounded-full hover:bg-slate-50 transition-colors"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5">
                  <path strokeLinecap="round" strokeLinejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            {/* Form */}
            <div className="flex flex-col gap-4">
              <p className="text-slate-500 text-sm">
                Found a bug? Have an idea? Let us know how we can make LoveMyFam better for you.
              </p>
              
              <textarea 
                value={content}
                onChange={(e) => setContent(e.target.value)}
                placeholder="Type your message here..."
                rows={5}
                className="w-full p-4 rounded-xl border border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-brand-sky outline-none transition-all resize-none text-slate-700"
                disabled={isSubmitting}
              />
              
              <div className="flex justify-end gap-3 pt-2">
                <button 
                  onClick={() => setIsOpen(false)}
                  className="px-4 py-2 text-slate-500 font-bold text-sm hover:bg-slate-100 rounded-lg transition-colors"
                  disabled={isSubmitting}
                >
                  Cancel
                </button>
                <button 
                  type="button"
                  onClick={handleSubmit}
                  disabled={isSubmitting || !content.trim()}
                  className="bg-brand-sky text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-500 transition-colors shadow-sm text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {isSubmitting ? 'Sending...' : 'Submit'}
                </button>
              </div>
            </div>

          </div>
        </div>
      )}
    </>
  )
}
</file>

<file path="src/components/PostInput.tsx">
'use client'

import { useState, useRef } from 'react'
import { createPost } from '@/app/common-room/actions'
import EmojiButton from './EmojiButton'

export default function PostInput() {
  const [content, setContent] = useState('')
  const [image, setImage] = useState<File | null>(null)
  const [previewUrl, setPreviewUrl] = useState<string | null>(null)
  const [isPosting, setIsPosting] = useState(false)
  
  const fileInputRef = useRef<HTMLInputElement>(null)

  function handleImageChange(e: React.ChangeEvent<HTMLInputElement>) {
    const file = e.target.files?.[0]
    if (file) {
      setImage(file)
      setPreviewUrl(URL.createObjectURL(file))
    }
  }

  async function handlePost() {
    if (!content.trim() && !image) return
    setIsPosting(true)

    const formData = new FormData()
    formData.append('content', content)
    if (image) {
      formData.append('file', image)
    }

    const result = await createPost(formData)
    setIsPosting(false)

    if (result.success) {
      setContent('')
      setImage(null)
      setPreviewUrl(null)
    } else {
      alert(result.message)
    }
  }

  return (
    <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-8">
      
      {/* 1. INPUT AREA WRAPPER */}
      <div className="relative">
        <textarea
          value={content}
          onChange={(e) => setContent(e.target.value)}
          placeholder="Share a memory, update, or thought..."
          // Added pr-12 to prevent text from typing behind the emoji button
          className="w-full text-lg placeholder:text-slate-400 border-none resize-none focus:ring-0 text-slate-700 h-24 pr-12"
        />
        
        {/* EMOJI BUTTON: Absolute Positioned Inside */}
        <div className="absolute bottom-2 right-2">
          <EmojiButton onEmojiSelect={(emoji) => setContent(prev => prev + emoji)} />
        </div>
      </div>
      
      {/* Image Preview */}
      {previewUrl && (
        <div className="relative mt-2 mb-4 w-fit">
          <img src={previewUrl} alt="Preview" className="h-32 w-auto rounded-lg object-cover border border-slate-200" />
          <button 
            onClick={() => { setImage(null); setPreviewUrl(null); }}
            className="absolute -top-2 -right-2 bg-slate-800 text-white rounded-full p-1 hover:bg-red-500 transition-colors"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4">
              <path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z" />
            </svg>
          </button>
        </div>
      )}

      {/* Toolbar */}
      <div className="flex justify-between items-center pt-2 border-t border-slate-100 mt-2">
        <div>
          <button 
             onClick={() => fileInputRef.current?.click()}
             className="text-slate-400 hover:text-brand-sky p-1.5 rounded-full hover:bg-slate-50 transition-colors group flex items-center gap-2"
          >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6 group-hover:scale-110 transition-transform">
              <path strokeLinecap="round" strokeLinejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
            </svg>
            <span className="text-xs font-medium hidden sm:inline">Add Photo</span>
          </button>
        </div>

        <button 
          onClick={handlePost} 
          disabled={isPosting || (!content.trim() && !image)}
          className="bg-brand-sky text-white px-6 py-2 rounded-full font-bold hover:bg-sky-500 disabled:opacity-50 transition-all shadow-sm"
        >
          {isPosting ? 'Posting...' : 'Post'}
        </button>
      </div>

      <input 
        type="file" 
        ref={fileInputRef} 
        className="hidden" 
        accept="image/*"
        onChange={handleImageChange}
      />
    </div>
  )
}
</file>

<file path="src/hooks/useLongPress.ts">
import { useCallback, useRef, useState } from 'react';

export default function useLongPress(
  onLongPress: () => void,
  onClick: () => void,
  { shouldPreventDefault = true, delay = 500 } = {}
) {
  const [longPressTriggered, setLongPressTriggered] = useState(false);
  const timeout = useRef<NodeJS.Timeout>(undefined);
  const target = useRef<EventTarget>(undefined);

  const start = useCallback(
    (event: React.MouseEvent | React.TouchEvent) => {
      if (shouldPreventDefault && event.target) {
        target.current = event.target;
      }
      timeout.current = setTimeout(() => {
        onLongPress();
        setLongPressTriggered(true);
      }, delay);
    },
    [onLongPress, delay, shouldPreventDefault]
  );

  const clear = useCallback(
    (_event: React.MouseEvent | React.TouchEvent, shouldTriggerClick = true) => {
      timeout.current && clearTimeout(timeout.current);
      
      // If the timer didn't finish (it wasn't a long press), trigger the normal click
      if (shouldTriggerClick && !longPressTriggered) {
        onClick();
      }
      
      setLongPressTriggered(false);
      target.current = undefined;
    },
    [onClick, longPressTriggered] // <--- FIXED: Removed 'shouldTriggerClick' from here
  );

  return {
    onMouseDown: (e: any) => start(e),
    onTouchStart: (e: any) => start(e),
    onMouseUp: (e: any) => clear(e),
    onMouseLeave: (e: any) => clear(e, false),
    onTouchEnd: (e: any) => clear(e)
  };
}
</file>

<file path="src/lib/updateLogger.ts">
import { addUpdate, UpdateItem } from './whatsNew'

/**
 * Utility function to log new updates during development
 * Call this whenever you implement a new feature, fix, or update
 */
export function logNewUpdate(
  title: string,
  description: string,
  icon: string = '‚ú®',
  category: 'feature' | 'fix' | 'update' = 'feature',
  status: 'just-released' | 'recently-updated' | 'coming-soon' = 'just-released',
  version?: string
) {
  const update = addUpdate({
    title,
    description,
    icon,
    category,
    status,
    date: new Date(),
    version
  })
  
  console.log(`‚ú® New update logged: ${title}`, update)
  return update
}

/**
 * Pre-configured update templates for common scenarios
 */
export const updateTemplates = {
  newFeature: (title: string, description: string, version?: string) => 
    logNewUpdate(title, description, 'üöÄ', 'feature', 'just-released', version),
    
  bugFix: (title: string, description: string, version?: string) => 
    logNewUpdate(title, description, 'üîß', 'fix', 'just-released', version),
    
  improvement: (title: string, description: string, version?: string) => 
    logNewUpdate(title, description, '‚ö°', 'update', 'recently-updated', version),
    
  comingSoon: (title: string, description: string) => 
    logNewUpdate(title, description, 'üîÆ', 'feature', 'coming-soon')
}

/**
 * Example usage:
 * 
 * // When implementing a new feature:
 * updateTemplates.newFeature(
 *   'Dark Mode Support',
 *   'Users can now switch between light and dark themes for better viewing comfort.',
 *   'v4.6'
 * )
 * 
 * // When fixing a bug:
 * updateTemplates.bugFix(
 *   'Fixed Login Issue',
 *   'Resolved authentication timeout problems on mobile devices.',
 *   'v4.6'
 * )
 * 
 * // When improving existing functionality:
 * updateTemplates.improvement(
 *   'Faster Image Loading',
 *   'Optimized image compression for 50% faster loading times.',
 *   'v4.6'
 * )
 */

// Log a new update to demonstrate the system
updateTemplates.newFeature(
  'Enhanced Update Logger',
  'Added comprehensive logging system that automatically tracks and displays new features, fixes, and improvements in the What\'s New section.',
  'v4.7'
)
</file>

<file path="src/components/AutoLogout.tsx">
'use client'

import { useEffect, useRef } from 'react'
import { logout } from '@/app/actions' // Ensure this path is correct for your project!

const TIMEOUT_MS = 15 * 60 * 1000 // 15 Minutes

export default function AutoLogout() {
  // Use a ref to store the timestamp without triggering re-renders
  const lastActivity = useRef(Date.now())

  useEffect(() => {
    // 1. The Checker: Runs every minute to check strictly against the clock
    const intervalId = setInterval(() => {
      checkInactivity()
    }, 10000) // Check every 10 seconds

    const checkInactivity = () => {
      const now = Date.now()
      const timeSinceLastActivity = now - lastActivity.current

      if (timeSinceLastActivity > TIMEOUT_MS) {
        performLogout()
      }
    }

    const performLogout = async () => {
      console.log("‚è≥ Session expired (Timestamp check). Logging out...")
      try {
        await logout()
      } catch (e) {
        console.error("Logout failed", e)
      } finally {
        window.location.href = '/' // Force reload to home/login
      }
    }

    const updateActivity = () => {
      // Before resetting, check if we SHOULD have logged out already
      // This catches the "Computer Waking Up" edge case
      const now = Date.now()
      if (now - lastActivity.current > TIMEOUT_MS) {
        performLogout()
      } else {
        lastActivity.current = now
      }
    }

    // 2. Event Listeners
    const events = ['mousedown', 'mousemove', 'keydown', 'scroll', 'touchstart', 'click']
    events.forEach(event => window.addEventListener(event, updateActivity))

    // 3. Tab/Window Close Handler
    const handleTabClose = async (event: BeforeUnloadEvent | PageTransitionEvent) => {
      // Only logout if user is actually logged in and there's meaningful activity
      const now = Date.now()
      const timeSinceLastActivity = now - lastActivity.current
      
      // Don't logout if user was inactive for more than the timeout (they're already "logged out")
      if (timeSinceLastActivity < TIMEOUT_MS) {
        try {
          // For beforeunload, we can't make async calls reliably, but we can try
          if ('event' in event && event.type === 'beforeunload') {
            // Use navigator.sendBeacon for reliable logout during page unload
            const data = new FormData()
            data.append('action', 'logout')
            navigator.sendBeacon('/api/logout', data)
          } else {
            // For pagehide, we can try async logout
            await logout()
          }
        } catch (e) {
          console.error("Tab close logout failed", e)
        }
      }
    }

    // Add tab close listeners
    window.addEventListener('beforeunload', handleTabClose)
    window.addEventListener('pagehide', handleTabClose)

    // Cleanup
    return () => {
      clearInterval(intervalId)
      events.forEach(event => window.removeEventListener(event, updateActivity))
      window.removeEventListener('beforeunload', handleTabClose)
      window.removeEventListener('pagehide', handleTabClose)
    }
  }, [])

  return null
}
</file>

<file path="src/components/FeedbackSection.tsx">
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { submitTestimonial } from '@/app/testimonials/actions'

export default function FeedbackSection() {
  const router = useRouter()
  const [content, setContent] = useState('')
  const [isSubmitting, setIsSubmitting] = useState(false)

  const handleSubmit = async () => {
    if (!content.trim()) return

    setIsSubmitting(true)
    const result = await submitTestimonial(content)
    setIsSubmitting(false)

    if (result.success) {
      setContent('')
      alert("Thank you! Your message has been posted.")
      router.refresh()
    } else {
      if (result.message === "Must be logged in") {
        if (confirm("Please log in to share your love!")) {
          router.push('/login')
        }
      } else {
        alert(result.message || "Something went wrong.")
      }
    }
  }

  return (
    <section className="bg-slate-50 border-t border-slate-200 py-12 px-4 mt-auto">
      <div className="max-w-2xl mx-auto">
        
        {/* HEADING */}
        <h3 className="text-xl font-bold text-slate-800 mb-2 text-center">
          What do you love about this app?
        </h3>
        
        {/* SUBTEXT (Added Here) */}
        <p className="text-slate-500 text-sm text-center mb-8">
          The encouragement you share here will be visible in the Testimonials section on the homepage ‚ô•Ô∏è
        </p>
        
        {/* FORM */}
        <div className="flex flex-col gap-4">
          <textarea 
            value={content}
            onChange={(e) => setContent(e.target.value)}
            placeholder="Share your thoughts..."
            rows={3}
            className="w-full p-4 rounded-xl border border-slate-200 bg-white focus:ring-2 focus:ring-brand-sky outline-none transition-all resize-y shadow-sm text-slate-700 disabled:opacity-50"
            disabled={isSubmitting}
          />
          
          <div className="flex justify-end">
            <button 
              type="button"
              onClick={handleSubmit}
              disabled={isSubmitting || !content.trim()}
              className="bg-brand-sky text-white font-bold py-2.5 px-6 rounded-lg hover:bg-sky-500 transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isSubmitting ? 'Posting...' : 'Submit'}
            </button>
          </div>
        </div>
      </div>
    </section>
  )
}
</file>

<file path="bundle.py">
import os

# --- CONFIGURATION ---
OUTPUT_FILE = 'project_bundle.txt'

# File extensions to include in the bundle
INCLUDED_EXTENSIONS = {
    '.ts', '.tsx', 
    '.js', '.jsx', '.mjs',
    '.css', 
    '.prisma',
    '.json',
    '.md' 
}

# Directories to strictly ignore
IGNORE_DIRS = {
    'node_modules', 
    '.next', 
    '.git', 
    '.vscode',
    'coverage',
    'dist',
    'build',
    'public' # Often contains images, safe to ignore for code bundles
}

# Specific files to ignore (to reduce noise)
IGNORE_FILES = {
    'package-lock.json', 
    'yarn.lock', 
    'pnpm-lock.yaml',
    'bundle.py', 
    'project_bundle.txt',
    'next-env.d.ts',
    '.DS_Store',
    '.eslintrc.json',
    'postcss.config.js'
}

def is_relevant_file(filename):
    """Check if file has a valid extension and isn't in the ignore list."""
    if filename in IGNORE_FILES:
        return False
    return any(filename.endswith(ext) for ext in INCLUDED_EXTENSIONS)

def bundle_project():
    print(f"Bundling project into {OUTPUT_FILE}...")
    
    file_count = 0
    
    with open(OUTPUT_FILE, 'w', encoding='utf-8') as outfile:
        # Walk through the current directory
        for root, dirs, files in os.walk('.'):
            # Modify dirs in-place to prevent walking into ignored directories
            dirs[:] = [d for d in dirs if d not in IGNORE_DIRS]

            for file in files:
                if is_relevant_file(file):
                    file_path = os.path.join(root, file)
                    
                    # Create a clean relative path for the header (e.g., "src/app/page.tsx")
                    relative_path = os.path.relpath(file_path, '.')

                    print(f"Processing: {relative_path}")

                    try:
                        with open(file_path, 'r', encoding='utf-8') as infile:
                            content = infile.read()
                            
                            # Write Header
                            outfile.write("=" * 50 + "\n")
                            outfile.write(f"FILE: {relative_path}\n")
                            outfile.write("=" * 50 + "\n")
                            
                            # Write Content
                            outfile.write(content)
                            outfile.write("\n\n")
                            file_count += 1
                            
                    except Exception as e:
                        print(f"‚ö†Ô∏è Could not read {relative_path}: {e}")

    print(f"\n‚úÖ Success! {file_count} files bundled into '{OUTPUT_FILE}'")

if __name__ == "__main__":
    bundle_project()
</file>

<file path="project_bundle.txt">
==================================================
FILE: tsconfig.json
==================================================
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}


==================================================
FILE: README.md
==================================================
# üíñ LoveMyFam (LMF)

### "A safe space for family. No strangers. No public. Just family."

-----

## üí° The Mission

In the age of endless notifications and cluttered group chats, staying genuinely connected with family often feels like a chore. **LoveMyFam** is designed to eliminate the friction and fatigue of modern communication methods‚Äîno more long, unplanned phone calls or searching through hundreds of text messages for one update.

LMF provides a private, asynchronous space built to facilitate **genuine and lasting communication** among family members.

## üè° The Common Room (CR)

The **Common Room** is the heart of the app. It acts as a central hub where all family members (FMs) can post concerns, share life updates, and collaborate on planning.

### Why Post to the Common Room?

| Pain Point Solved | LMF Solution |
| :--- | :--- |
| **Call Fatigue** | Skip the hassle of long phone calls and multiple video calls. |
| **Cluttered Group Chats**| Post one update, and *everyone* sees it, ensuring crucial information isn't missed. |
| **Exclusivity** | Our motto is our architecture: This is a **private, non-public** space. |

## ‚ú® Current Features (MVP)

As an ongoing project driven by continuous learning, the current feature set focuses on core communication:

  * **Secure Sign-In:** Authenticates family members to ensure platform exclusivity.
  * **Real-Time Feed:** Instantly pushes new updates to all active family members without requiring a page refresh.
  * **Asynchronous Posting:** Family members can post updates at their convenience.
  * **Database:** (Planned upgrade to PostgreSQL/Prisma).

## üöÄ The Development Journey

This project serves as a commitment to my ongoing growth as a full-stack developer. Building **LoveMyFam** allows me to integrate and master key concepts as I learn them.

| Technology Focus | Status & Goal |
| :--- | :--- |
| **Frontend** | **Next.js (App Router)**: Using React Server Components and Tailwind CSS. |
| **Backend** | **Next.js API Routes**: Handling business logic and database interactions. |
| **Deployment** | **Vercel**: Serverless deployment for instant scalability. |

-----

## üîó Connect with Me

Follow my journey as I build out new features for LMF and tackle new challenges!

[![My BlueSky Profile](https://img.shields.io/badge/BlueSky-0077B5?style=for-the-badge&logo=bluesky&logoColor=white)](https://bsky.app/profile/idongcodes.bsky.social)
[![My LinkedIn Profile](https://img.shields.io/badge/LinkedIn-0A66C2?style=for-the-badge&logo=linkedin&logoColor=white)](https://www.linkedin.com/in/idongcodes/)


==================================================
FILE: postcss.config.mjs
==================================================
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;


==================================================
FILE: package.json
==================================================
{
  "name": "love-my-fam",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "prisma generate && next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@vercel/blob": "^2.0.0",
    "emoji-picker-react": "^4.16.1",
    "next": "16.1.0",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@prisma/client": "^5.22.0",
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "babel-plugin-react-compiler": "1.0.0",
    "eslint": "^9",
    "eslint-config-next": "16.1.0",
    "prisma": "^5.22.0",
    "tailwindcss": "^4",
    "ts-node": "^10.9.2",
    "typescript": "^5"
  },
  "prisma": {
    "seed": "ts-node --compiler-options {\"module\":\"CommonJS\"} prisma/seed.ts"
  }
}


==================================================
FILE: next.config.ts
==================================================
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  reactCompiler: true,
  experimental: {
    serverActions: {
      bodySizeLimit: '20mb', // <--- Updated to 20mb
    },
  },
};

export default nextConfig;

==================================================
FILE: eslint.config.mjs
==================================================
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;


==================================================
FILE: src/middleware.ts
==================================================
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

// Define the few routes that are safe for strangers
const publicRoutes = [
  '/', 
  '/login', 
  '/register', 
  '/about' // Future-proofed as requested
]

export function middleware(request: NextRequest) {
  const session = request.cookies.get('session_id')
  const path = request.nextUrl.pathname

  // 1. Check if the current path is in our "Public List"
  const isPublic = publicRoutes.includes(path)

  // 2. If the route is NOT public and the user is NOT logged in...
  if (!isPublic && !session) {
    // ...kick them back to the login page
    return NextResponse.redirect(new URL('/login', request.url))
  }

  return NextResponse.next()
}

// 3. Update the Matcher to run on EVERYTHING
// (We exclude Next.js internal files, images, and API routes to keep things fast)
export const config = {
  matcher: [
    '/((?!api|_next/static|_next/image|favicon.ico|images).*)',
  ],
}

==================================================
FILE: src/components/AnnouncementModal.tsx
==================================================
'use client'

import { useState } from 'react'
import { createAnnouncement, editPost } from '@/app/common-room/actions'

interface AnnouncementModalProps {
  onClose: () => void
  initialData?: {
    id: string
    title: string
    content: string
    isUrgent: boolean
  }
}

export default function AnnouncementModal({ onClose, initialData }: AnnouncementModalProps) {
  const [isSubmitting, setIsSubmitting] = useState(false)
  
  // Initialize state with props if editing, otherwise defaults
  const [isUrgent, setIsUrgent] = useState(initialData?.isUrgent || false)
  const [title, setTitle] = useState(initialData?.title || '')
  const [message, setMessage] = useState(initialData?.content || '')

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault()
    setIsSubmitting(true)

    let result
    
    if (initialData) {
      // EDIT MODE: Reuse existing editPost action
      result = await editPost(initialData.id, message, title, isUrgent)
    } else {
      // CREATE MODE: Use createAnnouncement action
      const formData = new FormData()
      formData.append('title', title)
      formData.append('message', message)
      formData.append('isUrgent', isUrgent.toString())
      
      result = await createAnnouncement(formData)
    }

    setIsSubmitting(false)

    if (result.success) {
      onClose()
    } else {
      alert(result.message)
    }
  }

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onClick={onClose} />
      
      <div className="relative bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-in zoom-in-95">
        <h2 className="text-xl font-bold text-slate-800 mb-4">
          {initialData ? 'Edit Announcement' : 'New Announcement'}
        </h2>
        
        <form onSubmit={handleSubmit} className="flex flex-col gap-4">
          
          {/* Title */}
          <div>
            <label className="block text-xs font-bold text-slate-500 mb-1">TITLE</label>
            <input 
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              required 
              placeholder="e.g. Family Reunion" 
              className="w-full p-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none"
            />
          </div>

          {/* Message */}
          <div>
            <label className="block text-xs font-bold text-slate-500 mb-1">MESSAGE</label>
            <textarea 
              value={message}
              onChange={(e) => setMessage(e.target.value)}
              required 
              rows={4}
              placeholder="What's happening?" 
              className="w-full p-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none resize-none"
            />
          </div>

          {/* Urgent Toggle */}
          <div 
            onClick={() => setIsUrgent(!isUrgent)}
            className={`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${isUrgent ? 'bg-red-50 border-red-200' : 'bg-slate-50 border-slate-100'}`}
          >
            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${isUrgent ? 'border-red-500' : 'border-slate-300'}`}>
              {isUrgent && <div className="w-2.5 h-2.5 rounded-full bg-red-500" />}
            </div>
            <span className={`font-bold ${isUrgent ? 'text-red-500' : 'text-slate-500'}`}>Mark as Urgent</span>
          </div>

          <div className="flex gap-2 justify-end mt-2">
            <button type="button" onClick={onClose} className="px-4 py-2 text-slate-400 hover:text-slate-600 font-bold">Cancel</button>
            <button 
              type="submit" 
              disabled={isSubmitting}
              className="bg-brand-sky text-white px-6 py-2 rounded-lg font-bold hover:bg-sky-500 shadow-sm disabled:opacity-50"
            >
              {isSubmitting ? 'Saving...' : (initialData ? 'Update' : 'Post')}
            </button>
          </div>

        </form>
      </div>
    </div>
  )
}

==================================================
FILE: src/components/LikeButton.tsx
==================================================
'use client'

import { useState } from 'react'
import useLongPress from '@/hooks/useLongPress'
import StatusBadge from './StatusBadge' // <--- Import

interface UserLike {
  userId: string;
  user: {
    id: string;
    firstName: string;
    alias?: string | null;
    profileImage?: string | null;
    status?: string | null; // <--- Added Status
  }
}

interface LikeButtonProps {
  initialLikes: UserLike[];
  currentUserId: string;
  onToggle: () => Promise<void>;
}

export default function LikeButton({ initialLikes = [], currentUserId, onToggle }: LikeButtonProps) {
  const [likes, setLikes] = useState<UserLike[]>(initialLikes)
  const isLikedByMe = likes.some(l => l.userId === currentUserId)
  const [showList, setShowList] = useState(false)

  const handleToggle = async () => {
    if (isLikedByMe) {
      setLikes(prev => prev.filter(l => l.userId !== currentUserId))
    } else {
      setLikes(prev => [...prev, { userId: currentUserId, user: { id: currentUserId, firstName: 'Me', alias: 'Me', profileImage: null } }])
    }
    await onToggle()
  }

  const handleLongPress = () => { if (likes.length > 0) setShowList(true) }
  const longPressProps = useLongPress(handleLongPress, handleToggle, { delay: 500 })

  return (
    <div className="relative inline-block">
      
      {/* BUTTON (Same as before) */}
      <button 
        {...longPressProps}
        className={`flex items-center gap-1.5 transition-all font-bold text-sm select-none ${isLikedByMe ? 'text-pink-500' : 'text-slate-400 active:scale-95 [@media(hover:hover)]:hover:text-slate-600'}`}
      >
        {isLikedByMe ? (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-5 h-5 animate-in zoom-in duration-200 text-pink-500"><path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z" /></svg>
        ) : (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" /></svg>
        )}
        <span>{likes.length || 'Like'}</span>
      </button>

      {/* POPUP LIST */}
      {showList && (
        <>
          <div className="fixed inset-0 z-40" onClick={(e) => { e.stopPropagation(); setShowList(false) }} />
          <div className="absolute bottom-full left-0 mb-2 w-48 bg-white rounded-lg shadow-xl border border-slate-100 z-50 p-1 animate-in zoom-in-95 duration-150 origin-bottom-left">
            <div className="text-[10px] font-bold text-slate-400 uppercase tracking-wider px-3 py-2 border-b border-slate-50">Liked By</div>
            <div className="max-h-40 overflow-y-auto py-1">
              {likes.map((like) => {
                 const statusEmoji = like.user.status ? Array.from(like.user.status)[0] : null
                 return (
                  <div key={like.userId} className="flex items-center gap-2 px-3 py-1.5 hover:bg-slate-50 rounded-md">
                     <div className="relative">
                       <div className="w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold overflow-hidden bg-brand-pink/20 text-brand-pink shrink-0">
                          {like.user.profileImage ? (
                            <img src={like.user.profileImage} alt="User" className="w-full h-full object-cover" />
                          ) : (
                            (like.user.alias || like.user.firstName)[0]
                          )}
                       </div>

                       {/* ‚úÖ REPLACED MANUAL BADGE WITH COMPONENT (size="small") */}
                     <StatusBadge status={like.user.status} size="small" />
                     </div>
                     <span className="text-xs text-slate-700 truncate font-medium">{like.user.alias || like.user.firstName}</span>
                  </div>
                 )
              })}
            </div>
            <div className="absolute top-full left-4 -mt-[1px] border-8 border-transparent border-t-white" />
          </div>
        </>
      )}
    </div>
  )
}

==================================================
FILE: src/components/AutoLogout.tsx
==================================================
'use client'

import { useEffect, useRef } from 'react'
import { logout } from '@/app/actions' // Ensure this path is correct for your project!

const TIMEOUT_MS = 15 * 60 * 1000 // 15 Minutes

export default function AutoLogout() {
  // Use a ref to store the timestamp without triggering re-renders
  const lastActivity = useRef(Date.now())

  useEffect(() => {
    // 1. The Checker: Runs every minute to check strictly against the clock
    const intervalId = setInterval(() => {
      checkInactivity()
    }, 10000) // Check every 10 seconds

    const checkInactivity = () => {
      const now = Date.now()
      const timeSinceLastActivity = now - lastActivity.current

      if (timeSinceLastActivity > TIMEOUT_MS) {
        performLogout()
      }
    }

    const performLogout = async () => {
      console.log("‚è≥ Session expired (Timestamp check). Logging out...")
      try {
        await logout()
      } catch (e) {
        console.error("Logout failed", e)
      } finally {
        window.location.href = '/' // Force reload to home/login
      }
    }

    const updateActivity = () => {
      // Before resetting, check if we SHOULD have logged out already
      // This catches the "Computer Waking Up" edge case
      const now = Date.now()
      if (now - lastActivity.current > TIMEOUT_MS) {
        performLogout()
      } else {
        lastActivity.current = now
      }
    }

    // 2. Event Listeners
    const events = ['mousedown', 'mousemove', 'keydown', 'scroll', 'touchstart', 'click']
    events.forEach(event => window.addEventListener(event, updateActivity))

    // Cleanup
    return () => {
      clearInterval(intervalId)
      events.forEach(event => window.removeEventListener(event, updateActivity))
    }
  }, [])

  return null
}

==================================================
FILE: src/components/TestimonialSection.tsx
==================================================
import { getTestimonials } from '@/app/testimonials/actions'
import TestimonialSlider from './TestimonialSlider'

export default async function TestimonialSection() {
  // Fetch up to 9 items so the carousel has content to scroll through
  // (You can adjust the limit in your actions.ts if needed, e.g. take: 9)
  const testimonials = await getTestimonials()

  if (testimonials.length === 0) return null

  return (
    <section className="bg-brand-sky py-20 px-4 relative overflow-hidden">
      
      {/* Background Decoration */}
      <div className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none opacity-20">
        <div className="absolute -top-24 -left-24 w-96 h-96 bg-white rounded-full blur-3xl"></div>
        <div className="absolute top-1/2 right-0 w-64 h-64 bg-brand-pink rounded-full blur-3xl"></div>
      </div>

      <div className="max-w-6xl mx-auto relative z-10">
        <h2 className="text-4xl font-extrabold text-white text-center mb-12 tracking-tight drop-shadow-sm">
          Testimonials
        </h2>

        {/* Client Side Slider */}
        <TestimonialSlider testimonials={testimonials} />
        
      </div>
    </section>
  )
}

==================================================
FILE: src/components/MyRoomClient.tsx
==================================================
'use client'

import { useState, useRef, useEffect } from 'react'
import { updateProfilePhoto, updateProfileDetails } from '@/app/my-room/actions'
import { useRouter } from 'next/navigation'
import EmojiButton from './EmojiButton'
import StatusBadge from './StatusBadge'

export default function MyRoomClient({ user }: { user: any }) {
  const router = useRouter()
  const [activeTab, setActiveTab] = useState('dashboard')
  
  // --- PHOTO STATE ---
  const [profileImage, setProfileImage] = useState<File | null>(null)
  const [previewUrl, setPreviewUrl] = useState<string | null>(user?.profileImage || null)
  const [isSavingPhoto, setIsSavingPhoto] = useState(false)
  const selfieInputRef = useRef<HTMLInputElement>(null)
  const galleryInputRef = useRef<HTMLInputElement>(null)

  // --- PROFILE DETAILS STATE ---
  const [isEditingDetails, setIsEditingDetails] = useState(false)
  const [isSavingDetails, setIsSavingDetails] = useState(false)
  
  // Form Fields
  const [firstName, setFirstName] = useState<string>(user.firstName || '')
  const [lastName, setLastName] = useState<string>(user.lastName || '')
  const [position, setPosition] = useState<string>(user.position || '')
  const [bio, setBio] = useState<string>(user.bio || '')
  const [location, setLocation] = useState<string>(user.location || '')
  const [alias, setAlias] = useState<string>(user.alias || '')
  const [status, setStatus] = useState<string>(user.status || '') 

  // Sync state if user prop updates
  useEffect(() => {
    setFirstName(user.firstName || '')
    setLastName(user.lastName || '')
    setPosition(user.position || '')
    setBio(user.bio || '')
    setLocation(user.location || '')
    setAlias(user.alias || '')
    setStatus(user.status || '')
  }, [user])

  const ADMIN_EMAIL = 'idongesit_essien@ymail.com'
  const isAdmin = user?.email?.toLowerCase() === ADMIN_EMAIL.toLowerCase()

  // --- HANDLERS ---
  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (file) {
      setProfileImage(file)
      setPreviewUrl(URL.createObjectURL(file))
    }
  }

  const handleSavePhoto = async () => {
    if (!profileImage) return
    setIsSavingPhoto(true)
    const formData = new FormData()
    formData.append('file', profileImage)
    const result = await updateProfilePhoto(formData)
    setIsSavingPhoto(false)
    if (result.success) {
      alert("Profile photo updated.")
      setProfileImage(null)
      router.refresh()
    } else {
      alert(result.message)
    }
  }

  const handleCancelPhoto = () => {
    setProfileImage(null)
    setPreviewUrl(user?.profileImage || null)
  }

  const handleSaveDetails = async () => {
    setIsSavingDetails(true)
    const formData = new FormData()
    formData.append('firstName', firstName)
    formData.append('lastName', lastName)
    formData.append('position', position)
    formData.append('bio', bio)
    formData.append('location', location)
    formData.append('alias', alias)
    formData.append('status', status) 

    const result = await updateProfileDetails(formData)
    setIsSavingDetails(false)

    if (result.success) {
      setIsEditingDetails(false)
      router.refresh()
    } else {
      alert(result.message)
    }
  }

  const handleEmojiSelect = (emoji: string) => {
    setStatus((prev: string) => prev + emoji)
  }

  return (
    <div className="max-w-4xl mx-auto mt-8">
      {/* Page Header */}
      <h1 className="text-3xl font-bold text-brand-sky mb-8 text-center md:text-left">
        My Room
      </h1>

      {/* --- 1. PROFILE PHOTO CARD --- */}
      <section className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 mb-6 flex flex-col md:flex-row items-center gap-10 animate-in slide-in-from-top-4">
        
        {/* AVATAR + BUTTONS */}
        <div className="relative group shrink-0">
          <div className="w-40 h-40 rounded-full overflow-hidden border-4 border-brand-sky/20 shadow-md bg-slate-50 flex items-center justify-center relative">
            {previewUrl ? (
              <img src={previewUrl} alt="Profile" className="w-full h-full object-cover" />
            ) : (
              <span className="text-5xl text-brand-sky font-bold">
                {(alias || firstName)?.[0]?.toUpperCase()}
              </span>
            )}
          </div>
          
          {/* ‚úÖ REPLACED MANUAL BADGE WITH COMPONENT (size="large") */}
          <StatusBadge status={status} size="large" />

          <div className="absolute -bottom-2 -right-2 flex gap-2 z-20">
            <button onClick={() => galleryInputRef.current?.click()} className="bg-white text-slate-600 p-2.5 rounded-full shadow-lg hover:scale-110 transition-transform border border-slate-200" title="Upload from Gallery">
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" /></svg>
            </button>
            <button onClick={() => selfieInputRef.current?.click()} className="bg-brand-pink text-slate-900 p-2.5 rounded-full shadow-lg hover:scale-110 transition-transform border-2 border-white" title="Take a Selfie">
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" /><path strokeLinecap="round" strokeLinejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" /></svg>
            </button>
          </div>
        </div>

        {/* DETAILS DISPLAY */}
        <div className="flex-1 text-center md:text-left flex flex-col gap-1">
          {isAdmin && (
            <div className="mb-2">
              <span className="bg-slate-800 text-brand-yellow text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded border border-slate-600 shadow-sm inline-flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-3 h-3"><path fillRule="evenodd" d="M10 1a4.5 4.5 0 0 0-4.5 4.5V9H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2h-.5V5.5A4.5 4.5 0 0 0 10 1Zm3 8V5.5a3 3 0 1 0-6 0V9h6Z" clipRule="evenodd" /></svg>
                Admin / Developer
              </span>
            </div>
          )}
          
          <h2 className="text-3xl font-bold text-slate-800 tracking-tight">
            {firstName} {lastName}
          </h2>
          
          {alias && <p className="text-slate-400 font-medium text-lg">@{alias}</p>}
          
          <div className="mt-2">
            <span className="inline-block bg-brand-sky/10 text-brand-sky px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide border border-brand-sky/20">
              {position}
            </span>
          </div>

          {location && (
            <div className="mt-3 flex items-center justify-center md:justify-start gap-1.5 text-slate-500 text-sm font-medium animate-in fade-in">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4 text-brand-pink shrink-0">
                <path fillRule="evenodd" d="m9.69 18.933.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 0 0 .281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 1 0 3 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 0 0 2.273 1.765 11.842 11.842 0 0 0 .976.544l.062.029.018.008.006.003ZM10 11.25a2.25 2.25 0 1 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z" clipRule="evenodd" />
              </svg>
              {location}
            </div>
          )}

          {/* STATUS DISPLAY */}
          {status && (
            <div className="mt-2 flex items-center justify-center md:justify-start gap-1.5 text-slate-600 text-sm animate-in fade-in bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100 inline-flex w-fit mx-auto md:mx-0">
               <span className="text-base">üí≠</span>
               <span className="font-medium">{status}</span>
            </div>
          )}

          {profileImage && (
            <div className="mt-6 flex gap-3 justify-center md:justify-start animate-in fade-in slide-in-from-top-2">
              <button onClick={handleSavePhoto} disabled={isSavingPhoto} className="bg-brand-sky text-white px-6 py-2 rounded-full font-bold text-sm hover:bg-sky-500 transition-colors shadow-sm disabled:opacity-50">
                {isSavingPhoto ? 'Saving...' : 'Save New Photo'}
              </button>
              <button onClick={handleCancelPhoto} disabled={isSavingPhoto} className="text-slate-400 hover:text-red-500 text-sm font-medium px-4 py-2">Cancel</button>
            </div>
          )}
        </div>
        
        {/* Hidden inputs for photo upload */}
        <input type="file" ref={selfieInputRef} accept="image/*" capture="user" className="hidden" onChange={handleImageChange} />
        <input type="file" ref={galleryInputRef} accept="image/*" className="hidden" onChange={handleImageChange} />
      </section>

      {/* --- 2. EDIT DETAILS SECTION --- */}
      <section className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 mb-10 animate-in slide-in-from-top-6">
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
            <span>üëã</span> About Me
          </h2>
          {!isEditingDetails && (
            <button 
              onClick={() => setIsEditingDetails(true)}
              className="text-brand-sky text-sm font-bold hover:underline"
            >
              Edit Details
            </button>
          )}
        </div>

        {isEditingDetails ? (
          <div className="flex flex-col gap-5">
            
            {/* Names */}
            <div className="flex gap-4">
               <div className="flex-1">
                 <label className="block text-xs font-bold text-slate-500 mb-1">FIRST NAME</label>
                 <input value={firstName} onChange={(e) => setFirstName(e.target.value)} className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"/>
               </div>
               <div className="flex-1">
                 <label className="block text-xs font-bold text-slate-500 mb-1">LAST NAME</label>
                 <input value={lastName} onChange={(e) => setLastName(e.target.value)} className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"/>
               </div>
            </div>

            {/* Position & Alias */}
            <div className="flex flex-col md:flex-row gap-4">
              <div className="flex-1">
                <label className="block text-xs font-bold text-slate-500 mb-1">FAMILY POSITION</label>
                <input value={position} onChange={(e) => setPosition(e.target.value)} placeholder="e.g. Aunt, Cousin" className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"/>
              </div>
              <div className="flex-1">
                <label className="block text-xs font-bold text-slate-500 mb-1">ALIAS (NICKNAME)</label>
                <input value={alias} onChange={(e) => setAlias(e.target.value)} className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"/>
              </div>
            </div>

            {/* Location & Status */}
            <div className="flex flex-col md:flex-row gap-4">
               <div className="flex-1">
                  <label className="block text-xs font-bold text-slate-500 mb-1">CURRENT CITY</label>
                  <input value={location} onChange={(e) => setLocation(e.target.value)} className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"/>
               </div>
               
               {/* STATUS INPUT WITH EMOJI PICKER */}
               <div className="flex-1">
                  <label className="block text-xs font-bold text-slate-500 mb-1">CURRENT STATUS</label>
                  <div className="relative flex items-center">
                    <div className="absolute left-2 z-10">
                      <EmojiButton onEmojiSelect={handleEmojiSelect} />
                    </div>
                    <input 
                      value={status}
                      onChange={(e) => setStatus(e.target.value)}
                      placeholder="Feeling happy..."
                      className="w-full p-3 pl-12 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"
                    />
                  </div>
               </div>
            </div>

            {/* Bio */}
            <div>
              <label className="block text-xs font-bold text-slate-500 mb-1">BIO</label>
              <textarea value={bio} onChange={(e) => setBio(e.target.value)} rows={4} className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50 resize-none"/>
            </div>

            <div className="flex justify-end gap-2 mt-2">
              <button 
                onClick={() => {
                  setIsEditingDetails(false)
                  setFirstName(user.firstName || '')
                  setLastName(user.lastName || '')
                  setPosition(user.position || '')
                  setBio(user.bio || '')
                  setLocation(user.location || '')
                  setAlias(user.alias || '')
                  setStatus(user.status || '')
                }}
                className="px-4 py-2 text-slate-400 font-bold text-sm hover:text-slate-600"
              >
                Cancel
              </button>
              <button 
                onClick={handleSaveDetails}
                disabled={isSavingDetails}
                className="bg-brand-sky text-white px-6 py-2 rounded-full font-bold text-sm hover:bg-sky-500 transition-colors shadow-sm disabled:opacity-50"
              >
                {isSavingDetails ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        ) : (
          <div className="flex flex-col gap-4 text-slate-600">
            <div className="bg-slate-50 p-6 rounded-xl border border-slate-100 text-lg leading-relaxed text-slate-700">
              {bio ? bio : <span className="italic text-slate-400">Tell the family a bit about yourself...</span>}
            </div>
          </div>
        )}
      </section>

      {/* --- TAB NAVIGATION --- */}
      <div className="flex border-b border-slate-200 mb-8">
        <button onClick={() => setActiveTab('dashboard')} className={`pb-4 px-6 font-bold text-sm transition-all ${activeTab === 'dashboard' ? 'border-b-4 border-brand-sky text-brand-sky' : 'text-slate-400 hover:text-slate-600'}`}>Dashboard</button>
        <button onClick={() => setActiveTab('mirror')} className={`pb-4 px-6 font-bold text-sm transition-all ${activeTab === 'mirror' ? 'border-b-4 border-brand-pink text-brand-pink' : 'text-slate-400 hover:text-slate-600'}`}>My Mirror</button>
      </div>

      {activeTab === 'dashboard' && (
        <div className="bg-white p-12 rounded-2xl shadow-sm border border-slate-100 text-center animate-fade-in">
          <p className="text-5xl mb-4">üõèÔ∏è</p>
          <h2 className="text-2xl font-bold text-slate-800 mb-2">Your Personal Space</h2>
          <p className="text-slate-500">Personal dashboard, settings, and your post history will live here.</p>
        </div>
      )}

      {activeTab === 'mirror' && (
        <div className="bg-white p-12 rounded-2xl shadow-sm border border-slate-100 text-center animate-fade-in">
          <p className="text-5xl mb-4">ü™û</p>
          <h2 className="text-2xl font-bold text-slate-800 mb-2">My Mirror</h2>
          <p className="text-slate-500 mb-6">Reflect on your journey. Your profile details and personal stats will appear here.</p>
          <div className="inline-block bg-brand-pink/20 text-brand-pink px-4 py-2 rounded-full text-xs font-bold uppercase">Coming Soon</div>
        </div>
      )}
    </div>
  )
}

==================================================
FILE: src/components/StatusBadge.tsx
==================================================
'use client'

import { useState } from 'react'

export default function StatusBadge({ 
  status, 
  size = 'normal' 
}: { 
  status?: string | null, 
  size?: 'small' | 'normal' | 'large' 
}) {
  const [isExpanded, setIsExpanded] = useState(false)

  if (!status) return null

  // Get first character (emoji)
  const firstChar = Array.from(status)[0]

  // CONFIGURATION
  // We use 'left' positioning here so that expansion naturally flows to the right.
  const sizeClasses = {
    small:  { 
      // Parent is usually w-8 (32px)
      position: '-top-1 left-6', 
      collapsed: 'w-3 h-3 text-[6px]', 
      expanded: 'h-4 text-[8px] px-2' 
    },
    normal: { 
      // Parent is usually w-10 (40px)
      position: '-top-1 left-7', 
      collapsed: 'w-5 h-5 text-[10px]',     
      expanded: 'h-6 text-[10px] px-2.5' 
    },
    large:  { 
      // Parent is usually w-40 (160px)
      position: 'top-1 left-28',          
      collapsed: 'w-10 h-10 text-xl',          
      expanded: 'h-10 text-sm px-5' 
    }
  }

  const current = sizeClasses[size]

  return (
    <div 
      className={`absolute flex items-center justify-center cursor-pointer transition-all duration-300 ease-out z-30 overflow-hidden origin-left
        ${current.position}
        
        /* SHAPE & SIZE TRANSITION */
        ${isExpanded 
          ? `${current.expanded} w-auto rounded-xl shadow-xl border-brand-sky/20` 
          : `${current.collapsed} rounded-full shadow-md border-white/30`
        }

        /* LIQUID GLASS STYLE */
        bg-white/60 backdrop-blur-md border text-slate-900 ring-1 ring-white/40
      `}
      onMouseEnter={() => setIsExpanded(true)}
      onMouseLeave={() => setIsExpanded(false)}
      onClick={(e) => { 
        e.stopPropagation(); 
        setIsExpanded(!isExpanded); 
      }}
    >
      <span className={`leading-none whitespace-nowrap select-none ${isExpanded ? 'font-bold ml-0.5' : ''}`}>
        {isExpanded ? status : firstChar}
      </span>
    </div>
  )
}

==================================================
FILE: src/components/PostCard.tsx
==================================================
'use client'

import { useState } from 'react'
import { deletePost, editPost, toggleLike, addComment, dismissAnnouncement } from '@/app/common-room/actions'
import CommentItem from './CommentItem'
import LikeButton from './LikeButton'
import EmojiButton from './EmojiButton'
import { useRouter } from 'next/navigation'
import StatusBadge from './StatusBadge'

export default function PostCard({ post, currentUserId }: { post: any, currentUserId: string }) {
  const router = useRouter()
  
  // ... (Keep existing state: isEditing, editContent, etc.)
  const [isEditing, setIsEditing] = useState(false)
  const [editContent, setEditContent] = useState(post.content)
  const [editTitle, setEditTitle] = useState(post.title || '')
  const [editIsUrgent, setEditIsUrgent] = useState(post.isUrgent || false)
  const [showComments, setShowComments] = useState(false)
  const [commentText, setCommentText] = useState('')

  // ... (Keep permissions logic)
  const ADMIN_EMAIL = 'idongesit_essien@ymail.com'
  const isAdmin = post.author.email?.toLowerCase() === ADMIN_EMAIL.toLowerCase()
  const isAuthor = currentUserId === post.authorId
  const createdAt = new Date(post.createdAt).getTime()
  const timeDiff = Date.now() - createdAt
  const canEdit = isAuthor && (post.isAnnouncement || (!post.isEdited && timeDiff < 10 * 60 * 1000))

  // ... (Keep handlers: handleDelete, handleSave, etc.)
  async function handleDelete() { if (confirm('Delete?')) await deletePost(post.id) }
  async function handleSave() {
    const result = await editPost(post.id, editContent, post.isAnnouncement ? editTitle : undefined, post.isAnnouncement ? editIsUrgent : undefined)
    if (result.success) { setIsEditing(false); router.refresh(); } else { alert(result.message); }
  }
  async function handleToggleLike() { await toggleLike(post.id) }
  async function handleMainCommentSubmit(e: React.FormEvent) {
    e.preventDefault(); if(!commentText.trim()) return; await addComment(post.id, commentText); setCommentText('');
  }
  async function handleDismiss() { await dismissAnnouncement(post.id); router.refresh(); }

  const displayName = post.author.alias || post.author.firstName
  const firstLetter = displayName[0].toUpperCase()
  const profileImage = post.author.profileImage
  
  // --- NEW: STATUS ICON LOGIC ---
  const statusEmoji = post.author.status ? Array.from(post.author.status)[0] : null

  // Styles
  const isUrgent = post.isUrgent
  const displayUrgent = isEditing ? editIsUrgent : isUrgent
  const cardStyle = displayUrgent ? "bg-red-500/5 border-red-200/50 backdrop-blur-sm shadow-md" : "bg-white border-slate-100 shadow-sm"

  return (
    <div className={`p-6 rounded-xl border mb-6 transition-all hover:border-slate-300 ${cardStyle}`}>
      
      {/* 1. HEADER */}
      <div className="flex justify-between items-start mb-4">
        <div className="flex items-center gap-3">
          
          {/* AVATAR CONTAINER */}
          <div className="relative">
            <div className="w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-sm overflow-hidden bg-brand-pink text-slate-700 font-bold text-lg">
              {profileImage ? (
                 <img src={profileImage} alt={displayName} className="w-full h-full object-cover" />
              ) : (
                 <span>{firstLetter}</span>
              )}
            </div>
            
            {/* ‚úÖ REPLACED MANUAL BADGE WITH COMPONENT */}
            <StatusBadge status={post.author.status} size="normal" />
          </div>
          
          <div className="flex flex-col">
            <div className="flex items-center gap-2">
              <span className="font-bold text-slate-800 leading-tight">{displayName}</span>
              <span className="text-[10px] bg-brand-sky/10 text-brand-sky px-2 py-0.5 rounded-full font-bold uppercase border border-brand-sky/20">{post.author.position}</span>
            </div>
            {isAdmin && (
              <span className="bg-slate-700 text-white text-[10px] font-bold px-1.5 py-0.5 rounded w-fit flex items-center gap-1 mt-1 shadow-sm">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-2.5 h-2.5"><path fillRule="evenodd" d="M10.362 1.093a.75.75 0 0 0-.724 0L2.523 5.018 10 9.143l7.477-4.125-7.115-3.925ZM18 6.443l-7.25 4v8.25l6.862-3.786A.75.75 0 0 0 18 14.25V6.443Zm-8.75 12.25v-8.25l-7.25-4v7.807a.75.75 0 0 0 .388.657l6.862 3.786Z" clipRule="evenodd" /></svg>
                 Admin
              </span>
            )}
            <p className="text-xs text-slate-400 mt-0.5">
              {new Date(post.createdAt).toLocaleString(undefined, { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' })}
              {post.isEdited && <span className="italic ml-1">(Edited)</span>}
            </p>
          </div>
        </div>

        {/* Buttons (Edit/Delete) */}
        {isAuthor && (
           <div className="flex gap-3 text-slate-400">
             {canEdit && !isEditing && (
               <button onClick={() => setIsEditing(true)} className="hover:text-brand-sky p-1 rounded-full hover:bg-slate-50">
                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>
               </button>
             )}
             <button onClick={handleDelete} className="hover:text-red-500 p-1 rounded-full hover:bg-red-50">
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>
             </button>
           </div>
        )}
      </div>

      {/* 2. CONTENT (Keep existing logic) */}
      {isEditing ? (
        <div className="mt-2 flex flex-col gap-3">
          {post.isAnnouncement && (
            <div className="flex flex-col gap-3 animate-in slide-in-from-top-2">
              <div>
                <label className="text-[10px] font-bold text-slate-400 uppercase">Title</label>
                <input value={editTitle} onChange={(e) => setEditTitle(e.target.value)} className="w-full p-2 text-sm border rounded-lg focus:ring-2 focus:ring-brand-sky outline-none font-bold text-slate-700" placeholder="Announcement Title"/>
              </div>
              <div onClick={() => setEditIsUrgent(!editIsUrgent)} className={`flex items-center gap-2 p-2 rounded-lg border cursor-pointer select-none transition-colors ${editIsUrgent ? 'bg-red-50 border-red-200' : 'bg-slate-50 border-slate-100'}`}>
                 <div className={`w-4 h-4 rounded-full border flex items-center justify-center ${editIsUrgent ? 'border-red-500' : 'border-slate-300'}`}>
                    {editIsUrgent && <div className="w-2 h-2 rounded-full bg-red-500" />}
                 </div>
                 <span className={`text-xs font-bold ${editIsUrgent ? 'text-red-500' : 'text-slate-500'}`}>Mark as Urgent</span>
              </div>
            </div>
          )}
          <div className="relative">
            <textarea value={editContent} onChange={(e) => setEditContent(e.target.value)} className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-brand-sky outline-none text-slate-700 pr-10" rows={3}/>
            <div className="absolute bottom-2 right-2"><EmojiButton onEmojiSelect={(emoji) => setEditContent((p:string) => p + emoji)} /></div>
          </div>
          <div className="flex gap-2 justify-end">
            <button onClick={() => setIsEditing(false)} className="text-xs text-slate-400 hover:text-slate-600 font-bold px-2">Cancel</button>
            <button onClick={handleSave} className="text-xs bg-brand-sky text-white px-4 py-1.5 rounded-full hover:bg-sky-500 font-bold shadow-sm">Save Changes</button>
          </div>
        </div>
      ) : (
        <div>
          {post.title && <h3 className="font-bold text-lg text-slate-800 mb-1">{post.title}</h3>}
          <p className="text-slate-700 leading-relaxed text-base whitespace-pre-wrap mb-3">{post.content}</p>
          {post.imageUrl && (
            <div className="mt-3 rounded-lg overflow-hidden border border-slate-100">
              <img src={post.imageUrl} alt="Post attachment" className="w-full max-h-96 object-cover bg-slate-50" loading="lazy"/>
            </div>
          )}
        </div>
      )}

      {/* 3. ACTION BAR */}
      <div className="mt-5 pt-4 border-t border-slate-50/50 flex justify-between items-center">
        <LikeButton initialLikes={post.likes} currentUserId={currentUserId} onToggle={handleToggleLike} />
        <div className="flex items-center gap-4">
          <button onClick={() => setShowComments(!showComments)} className="flex items-center gap-2 text-slate-400 hover:text-brand-sky transition-colors font-medium text-sm group">
            <span>{post.topLevelComments?.length || 0} Replies</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5 group-hover:-translate-y-0.5 transition-transform"><path strokeLinecap="round" strokeLinejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" /></svg>
          </button>
          {post.isUrgent && (
            <button onClick={handleDismiss} className="text-xs font-bold text-red-400 hover:text-red-600 hover:underline transition-colors">Dismiss</button>
          )}
        </div>
      </div>

      {/* 4. COMMENTS */}
      {showComments && (
        <div className="mt-6 animate-in slide-in-from-top-2 border-t border-slate-50 pt-4">
          <form onSubmit={handleMainCommentSubmit} className="flex gap-2 mb-6 items-center">
            <div className="relative flex-1">
              <input type="text" value={commentText} onChange={(e) => setCommentText(e.target.value)} placeholder="Write a comment..." className="w-full bg-slate-50 border border-slate-200 rounded-lg pl-4 pr-10 py-3 text-sm focus:ring-2 focus:ring-brand-sky outline-none transition-all"/>
              <div className="absolute right-2 top-1/2 -translate-y-1/2"><EmojiButton onEmojiSelect={(emoji) => setCommentText((p:string) => p + emoji)} /></div>
            </div>
            <button type="submit" disabled={!commentText.trim()} className="bg-brand-sky text-white font-bold px-4 py-2 rounded-lg hover:bg-sky-500 disabled:opacity-50 transition-colors">Post</button>
          </form>
          <div className="space-y-4">
            {post.topLevelComments?.map((comment: any) => (
              <CommentItem key={comment.id} comment={comment} currentUserId={currentUserId} postId={post.id}/>
            ))}
            {(!post.topLevelComments || post.topLevelComments.length === 0) && <p className="text-center text-slate-400 text-xs italic">No comments yet.</p>}
          </div>
        </div>
      )}
    </div>
  )
}

==================================================
FILE: src/components/CommentItem.tsx
==================================================
'use client'

import { useState } from 'react'
import { addComment, toggleCommentLike, deleteComment, editComment } from '@/app/common-room/actions'
import LikeButton from './LikeButton'
import EmojiButton from './EmojiButton'
import StatusBadge from './StatusBadge'

export default function CommentItem({ comment, currentUserId, postId }: { comment: any, currentUserId: string, postId: string }) {
  const [isReplying, setIsReplying] = useState(false)
  const [replyText, setReplyText] = useState('')
  const [isEditing, setIsEditing] = useState(false)
  const [editContent, setEditContent] = useState(comment.content)

  const isAuthor = currentUserId === comment.authorId
  
  // Status Logic
  const statusEmoji = comment.author?.status ? Array.from(comment.author.status)[0] : null
  
  const displayName = comment.author?.alias || comment.author?.firstName || 'Family Member'
  const firstLetter = displayName[0]?.toUpperCase() || '?'
  const profileImage = comment.author?.profileImage

  async function handleReplySubmit(e: React.FormEvent) {
    e.preventDefault(); if(!replyText.trim()) return; await addComment(postId, replyText, comment.id); setReplyText(''); setIsReplying(false);
  }
  async function handleEditSubmit(e: React.FormEvent) {
    e.preventDefault(); if(!editContent.trim()) return; const res = await editComment(comment.id, editContent); if(res.success) setIsEditing(false);
  }
  async function handleDelete() { if(confirm('Delete comment?')) await deleteComment(comment.id) }

  return (
    <div className="flex gap-3 mt-4 w-full group">
      {/* AVATAR + STATUS BADGE */}
      <div className="relative shrink-0">
        <div className="w-8 h-8 rounded-full flex items-center justify-center overflow-hidden bg-brand-sky/20 text-brand-sky font-bold text-xs">
          {profileImage ? (
             <img src={profileImage} alt={displayName} className="w-full h-full object-cover" />
          ) : (
             <span>{firstLetter}</span>
          )}
        </div>
        
        <StatusBadge status={comment.author?.status} size="small" />
      </div>

      <div className="flex-1">
        {/* Content Bubble */}
        <div className="bg-slate-50 p-3 rounded-2xl rounded-tl-none border border-slate-100 relative">
           <div className="flex justify-between items-start mb-1">
             <span className="text-xs font-bold text-slate-700">{displayName}</span>
             <span className="text-[10px] text-slate-400">{new Date(comment.createdAt).toLocaleDateString()}</span>
           </div>
           
           {isEditing ? (
             <form onSubmit={handleEditSubmit}>
                <input value={editContent} onChange={e => setEditContent(e.target.value)} className="w-full p-2 text-xs border rounded mb-2"/>
                <div className="flex gap-2 text-[10px]">
                  <button type="button" onClick={() => setIsEditing(false)} className="text-slate-400">Cancel</button>
                  <button type="submit" className="text-brand-sky font-bold">Save</button>
                </div>
             </form>
           ) : (
             <p className="text-sm text-slate-600 leading-snug">{comment.content}</p>
           )}
        </div>

        {/* Action Bar */}
        <div className="flex items-center gap-4 mt-1 pl-2">
          {/* Like Button */}
          <div className="scale-75 origin-left">
            <LikeButton 
              initialLikes={comment.likes} 
              currentUserId={currentUserId} 
              // ‚úÖ FIXED: Wrapped in braces { } to ensure return type is void
              onToggle={async () => { await toggleCommentLike(comment.id) }} 
            />
          </div>
          
          <button onClick={() => setIsReplying(!isReplying)} className="text-xs font-bold text-slate-400 hover:text-brand-sky">Reply</button>
          
          {isAuthor && (
            <>
              <button onClick={() => setIsEditing(!isEditing)} className="text-xs text-slate-400 hover:text-slate-600">Edit</button>
              <button onClick={handleDelete} className="text-xs text-slate-400 hover:text-red-500">Delete</button>
            </>
          )}
        </div>

        {/* Reply Input */}
        {isReplying && (
          <form onSubmit={handleReplySubmit} className="mt-2 flex gap-2">
            <div className="relative flex-1">
              <input autoFocus value={replyText} onChange={(e) => setReplyText(e.target.value)} className="w-full text-xs p-2 border rounded-lg pr-8" placeholder="Write a reply..."/>
               <div className="absolute right-1 top-1/2 -translate-y-1/2"><EmojiButton onEmojiSelect={(emoji) => setReplyText(p => p + emoji)} /></div>
            </div>
            <button type="submit" disabled={!replyText.trim()} className="text-xs bg-brand-sky text-white px-3 py-1 rounded-lg">Reply</button>
          </form>
        )}

        {/* Nested Comments */}
        {comment.children && comment.children.length > 0 && (
          <div className="mt-2 border-l-2 border-slate-100 pl-3">
            {comment.children.map((child: any) => (
              <CommentItem key={child.id} comment={child} currentUserId={currentUserId} postId={postId}/>
            ))}
          </div>
        )}
      </div>
    </div>
  )
}

==================================================
FILE: src/components/Navbar.tsx
==================================================
import Link from 'next/link'
import { cookies } from 'next/headers'
import NavMenu from './NavMenu'

export default async function Navbar() {
  const cookieStore = await cookies()
  const isLoggedIn = cookieStore.has('session_id')

  return (
    <nav className="fixed top-0 left-0 right-0 z-50 bg-brand-sky/70 backdrop-blur-md border-b border-white/20 shadow-sm transition-all">
      <div className="max-w-5xl mx-auto px-6 h-16 flex items-center justify-between">
        
        {/* Logo */}
        <Link href="/" className="text-white font-bold text-xl tracking-tight hover:text-brand-cream transition-colors drop-shadow-sm z-50">
          LoveMyFam
        </Link>

        {/* The Responsive Menu Component */}
        <NavMenu isLoggedIn={isLoggedIn} />
        
      </div>
    </nav>
  )
}

==================================================
FILE: src/components/PostInput.tsx
==================================================
'use client'

import { useState, useRef } from 'react'
import { createPost } from '@/app/common-room/actions'
import EmojiButton from './EmojiButton'

export default function PostInput() {
  const [content, setContent] = useState('')
  const [image, setImage] = useState<File | null>(null)
  const [previewUrl, setPreviewUrl] = useState<string | null>(null)
  const [isPosting, setIsPosting] = useState(false)
  
  const fileInputRef = useRef<HTMLInputElement>(null)

  function handleImageChange(e: React.ChangeEvent<HTMLInputElement>) {
    const file = e.target.files?.[0]
    if (file) {
      setImage(file)
      setPreviewUrl(URL.createObjectURL(file))
    }
  }

  async function handlePost() {
    if (!content.trim() && !image) return
    setIsPosting(true)

    const formData = new FormData()
    formData.append('content', content)
    if (image) {
      formData.append('file', image)
    }

    const result = await createPost(formData)
    setIsPosting(false)

    if (result.success) {
      setContent('')
      setImage(null)
      setPreviewUrl(null)
    } else {
      alert(result.message)
    }
  }

  return (
    <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-8">
      
      {/* 1. INPUT AREA WRAPPER */}
      <div className="relative">
        <textarea
          value={content}
          onChange={(e) => setContent(e.target.value)}
          placeholder="Share a memory, update, or thought..."
          // Added pr-12 to prevent text from typing behind the emoji button
          className="w-full text-lg placeholder:text-slate-400 border-none resize-none focus:ring-0 text-slate-700 h-24 pr-12"
        />
        
        {/* EMOJI BUTTON: Absolute Positioned Inside */}
        <div className="absolute bottom-2 right-2">
          <EmojiButton onEmojiSelect={(emoji) => setContent(prev => prev + emoji)} />
        </div>
      </div>
      
      {/* Image Preview */}
      {previewUrl && (
        <div className="relative mt-2 mb-4 w-fit">
          <img src={previewUrl} alt="Preview" className="h-32 w-auto rounded-lg object-cover border border-slate-200" />
          <button 
            onClick={() => { setImage(null); setPreviewUrl(null); }}
            className="absolute -top-2 -right-2 bg-slate-800 text-white rounded-full p-1 hover:bg-red-500 transition-colors"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4">
              <path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z" />
            </svg>
          </button>
        </div>
      )}

      {/* Toolbar */}
      <div className="flex justify-between items-center pt-2 border-t border-slate-100 mt-2">
        <div>
          <button 
             onClick={() => fileInputRef.current?.click()}
             className="text-slate-400 hover:text-brand-sky p-1.5 rounded-full hover:bg-slate-50 transition-colors group flex items-center gap-2"
          >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6 group-hover:scale-110 transition-transform">
              <path strokeLinecap="round" strokeLinejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
            </svg>
            <span className="text-xs font-medium hidden sm:inline">Add Photo</span>
          </button>
        </div>

        <button 
          onClick={handlePost} 
          disabled={isPosting || (!content.trim() && !image)}
          className="bg-brand-sky text-white px-6 py-2 rounded-full font-bold hover:bg-sky-500 disabled:opacity-50 transition-all shadow-sm"
        >
          {isPosting ? 'Posting...' : 'Post'}
        </button>
      </div>

      <input 
        type="file" 
        ref={fileInputRef} 
        className="hidden" 
        accept="image/*"
        onChange={handleImageChange}
      />
    </div>
  )
}

==================================================
FILE: src/components/FeedbackWidget.tsx
==================================================
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { submitGeneralFeedback } from '@/app/actions'

export default function FeedbackWidget() {
  const [isOpen, setIsOpen] = useState(false)
  const [content, setContent] = useState('')
  const [isSubmitting, setIsSubmitting] = useState(false)
  const router = useRouter()

  const handleSubmit = async () => {
    if (!content.trim()) return

    setIsSubmitting(true)
    
    // Server Action checks if we are logged in
    const result = await submitGeneralFeedback(content)
    
    setIsSubmitting(false)

    if (result.success) {
      setIsOpen(false)
      setContent('')
      alert("Feedback received! We appreciate you.")
    } else if (result.error === 'unauthorized') {
      // Logic for Guest Users
      setIsOpen(false)
      if (confirm("Please log in to submit feedback.")) {
        router.push('/login')
      }
    } else {
      alert("Something went wrong. Please try again.")
    }
  }

  return (
    <>
      {/* TRIGGER LINK */}
      <div className="w-full text-center pb-4">
        <button 
          onClick={() => setIsOpen(true)}
          className="text-slate-400 hover:text-brand-sky text-sm font-medium transition-colors underline decoration-slate-700 underline-offset-4 hover:decoration-brand-sky"
        >
          Click here for issues, feature requests, suggestions or general feedback.
        </button>
      </div>

      {/* MODAL */}
      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          
          {/* Backdrop */}
          <div 
            className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"
            onClick={() => setIsOpen(false)}
          />

          {/* Content */}
          <div className="relative bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-in zoom-in-95 duration-200 border border-slate-100">
            
            {/* Header */}
            <div className="flex justify-between items-start mb-4">
              <h3 className="text-xl font-bold text-slate-800">
                Share your feedback
              </h3>
              <button 
                onClick={() => setIsOpen(false)}
                className="text-slate-400 hover:text-slate-600 p-1 rounded-full hover:bg-slate-50 transition-colors"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5">
                  <path strokeLinecap="round" strokeLinejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            {/* Form */}
            <div className="flex flex-col gap-4">
              <p className="text-slate-500 text-sm">
                Found a bug? Have an idea? Let us know how we can make LoveMyFam better for you.
              </p>
              
              <textarea 
                value={content}
                onChange={(e) => setContent(e.target.value)}
                placeholder="Type your message here..."
                rows={5}
                className="w-full p-4 rounded-xl border border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-brand-sky outline-none transition-all resize-none text-slate-700"
                disabled={isSubmitting}
              />
              
              <div className="flex justify-end gap-3 pt-2">
                <button 
                  onClick={() => setIsOpen(false)}
                  className="px-4 py-2 text-slate-500 font-bold text-sm hover:bg-slate-100 rounded-lg transition-colors"
                  disabled={isSubmitting}
                >
                  Cancel
                </button>
                <button 
                  type="button"
                  onClick={handleSubmit}
                  disabled={isSubmitting || !content.trim()}
                  className="bg-brand-sky text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-500 transition-colors shadow-sm text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {isSubmitting ? 'Sending...' : 'Submit'}
                </button>
              </div>
            </div>

          </div>
        </div>
      )}
    </>
  )
}

==================================================
FILE: src/components/NavMenu.tsx
==================================================
'use client'

import { useState } from 'react'
import Link from 'next/link'
import { logout } from '@/app/actions'

export default function NavMenu({ isLoggedIn }: { isLoggedIn: boolean }) {
  const [isOpen, setIsOpen] = useState(false)

  // Close menu when a link is clicked
  const close = () => setIsOpen(false)

  return (
    <>
      {/* --- DESKTOP VIEW (Hidden on Mobile) --- */}
      <div className="hidden md:flex items-center gap-6 text-sm font-medium text-white">
        <Link href="/" className="hover:text-brand-yellow transition-colors">Home</Link>
        
        {isLoggedIn ? (
          <>
            <Link href="/common-room" className="hover:text-brand-yellow transition-colors">Common Room</Link>
            <Link href="/family" className="hover:text-brand-yellow transition-colors">Directory</Link>
            <Link href="/my-room" className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full transition-all border border-white/20">
              My Room
            </Link>
            <form action={logout}>
              <button type="submit" className="text-white/80 hover:text-white hover:underline transition-all ml-2">
                Logout
              </button>
            </form>
          </>
        ) : (
          <Link href="/login" className="hover:text-brand-pink transition-colors">Login</Link>
        )}
      </div>

      {/* --- MOBILE HAMBURGER BUTTON (Visible on Mobile) --- */}
      <button 
        className="md:hidden text-white text-3xl focus:outline-none"
        onClick={() => setIsOpen(!isOpen)}
        aria-label="Toggle menu"
      >
        {isOpen ? '‚úï' : '‚ò∞'}
      </button>

      {/* --- MOBILE DROPDOWN MENU --- */}
      {isOpen && (
        <div className="absolute top-16 left-0 right-0 bg-brand-sky/95 backdrop-blur-xl border-b border-white/20 shadow-xl md:hidden flex flex-col p-6 gap-6 text-center text-white text-lg font-bold z-50 animate-in slide-in-from-top-2">
          
          <Link href="/" onClick={close} className="hover:text-brand-yellow py-2 border-b border-white/10">
            Home
          </Link>

          {isLoggedIn ? (
            <>
              <Link href="/common-room" onClick={close} className="hover:text-brand-yellow py-2 border-b border-white/10">
                Common Room
              </Link>
              <Link href="/family" onClick={close} className="hover:text-brand-yellow py-2 border-b border-white/10">
                Directory
              </Link>
              <Link href="/my-room" onClick={close} className="hover:text-brand-yellow py-2 border-b border-white/10">
                My Room
              </Link>
              <form action={logout} className="py-2">
                <button type="submit" className="text-white/80 hover:text-white">
                  Logout
                </button>
              </form>
            </>
          ) : (
            <Link href="/login" onClick={close} className="text-brand-pink py-2">
              Login
            </Link>
          )}
        </div>
      )}
    </>
  )
}

==================================================
FILE: src/components/FeedbackSection.tsx
==================================================
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { submitTestimonial } from '@/app/testimonials/actions'

export default function FeedbackSection() {
  const router = useRouter()
  const [content, setContent] = useState('')
  const [isSubmitting, setIsSubmitting] = useState(false)

  const handleSubmit = async () => {
    if (!content.trim()) return

    setIsSubmitting(true)
    const result = await submitTestimonial(content)
    setIsSubmitting(false)

    if (result.success) {
      setContent('')
      alert("Thank you! Your message has been posted.")
      router.refresh()
    } else {
      if (result.message === "Must be logged in") {
        if (confirm("Please log in to share your love!")) {
          router.push('/login')
        }
      } else {
        alert(result.message || "Something went wrong.")
      }
    }
  }

  return (
    <section className="bg-slate-50 border-t border-slate-200 py-12 px-4 mt-auto">
      <div className="max-w-2xl mx-auto">
        
        {/* HEADING */}
        <h3 className="text-xl font-bold text-slate-800 mb-2 text-center">
          What do you love about this app?
        </h3>
        
        {/* SUBTEXT (Added Here) */}
        <p className="text-slate-500 text-sm text-center mb-8">
          The encouragement you share here will be visible in the Testimonials section on the homepage ‚ô•Ô∏è
        </p>
        
        {/* FORM */}
        <div className="flex flex-col gap-4">
          <textarea 
            value={content}
            onChange={(e) => setContent(e.target.value)}
            placeholder="Share your thoughts..."
            rows={3}
            className="w-full p-4 rounded-xl border border-slate-200 bg-white focus:ring-2 focus:ring-brand-sky outline-none transition-all resize-y shadow-sm text-slate-700 disabled:opacity-50"
            disabled={isSubmitting}
          />
          
          <div className="flex justify-end">
            <button 
              type="button"
              onClick={handleSubmit}
              disabled={isSubmitting || !content.trim()}
              className="bg-brand-sky text-white font-bold py-2.5 px-6 rounded-lg hover:bg-sky-500 transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isSubmitting ? 'Posting...' : 'Submit'}
            </button>
          </div>
        </div>
      </div>
    </section>
  )
}

==================================================
FILE: src/components/AnnouncementCarousel.tsx
==================================================
'use client'

import { useState, useEffect } from 'react'
import AnnouncementModal from './AnnouncementModal'
import { deletePost } from '@/app/common-room/actions'
import { useRouter } from 'next/navigation'

export default function AnnouncementCarousel({ 
  announcements, 
  currentUserEmail 
}: { 
  announcements: any[], 
  currentUserEmail?: string 
}) {
  const router = useRouter()
  const [index, setIndex] = useState(0)
  const [isPaused, setIsPaused] = useState(false)
  
  // State for modals
  const [showAddModal, setShowAddModal] = useState(false)
  const [editingItem, setEditingItem] = useState<any | null>(null)

  const isAdmin = currentUserEmail === 'idongesit_essien@ymail.com'

  // Auto-scroll logic
  useEffect(() => {
    // Don't scroll if paused OR if we are currently editing something
    if (announcements.length <= 1 || isPaused || editingItem) return

    const timer = setInterval(() => {
      setIndex(prev => (prev + 1) % announcements.length)
    }, 5000)

    return () => clearInterval(timer)
  }, [announcements.length, isPaused, editingItem])

  // Handle Delete
  const handleDelete = async (id: string) => {
    if (confirm("Are you sure you want to delete this announcement?")) {
      await deletePost(id)
      setIndex(0) // Reset index so we don't get stuck on a deleted item
      router.refresh()
    }
  }

  const currentAnnouncement = announcements[index]

  if (announcements.length === 0 && !isAdmin) return null

  return (
    <div className="mb-8">
      
      {/* CAROUSEL CONTAINER */}
      {announcements.length > 0 && currentAnnouncement && (
        <div 
          className="relative overflow-hidden bg-brand-sky rounded-2xl shadow-sm border border-brand-sky/20 text-white p-6 cursor-pointer group"
          onClick={() => setIsPaused(true)} 
          onMouseEnter={() => setIsPaused(true)}
          onMouseLeave={() => setIsPaused(false)}
        >
          {/* CONTENT */}
          <div className="relative h-20 flex items-center">
             {announcements.map((ann, i) => (
               <div 
                 key={ann.id}
                 className={`absolute inset-0 transition-all duration-500 ease-in-out flex flex-col justify-center
                   ${i === index ? 'opacity-100 translate-x-0' : 'opacity-0 translate-x-10 pointer-events-none'}
                 `}
               >
                 <h3 className="font-bold text-lg mb-1 flex items-center gap-2">
                   {ann.isUrgent && <span>üö®</span>}
                   {ann.title}
                 </h3>
                 <p className="text-white/90 text-sm line-clamp-2 leading-relaxed">
                   {ann.content}
                 </p>
               </div>
             ))}
          </div>

          {/* ADMIN CONTROLS (Overlay) */}
          {isAdmin && (
            <div className="absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-10">
              <button 
                onClick={(e) => {
                  e.stopPropagation()
                  setEditingItem(currentAnnouncement)
                }}
                className="bg-white/20 hover:bg-white/40 text-white p-1.5 rounded-full backdrop-blur-md transition-colors"
                title="Edit"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-4 h-4">
                  <path strokeLinecap="round" strokeLinejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                </svg>
              </button>
              <button 
                onClick={(e) => {
                  e.stopPropagation()
                  handleDelete(currentAnnouncement.id)
                }}
                className="bg-white/20 hover:bg-red-500/80 text-white p-1.5 rounded-full backdrop-blur-md transition-colors"
                title="Delete"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-4 h-4">
                  <path strokeLinecap="round" strokeLinejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                </svg>
              </button>
            </div>
          )}

          {/* Dots */}
          <div className="absolute bottom-3 right-4 flex gap-1.5">
            {announcements.map((_, i) => (
              <div 
                key={i} 
                className={`w-1.5 h-1.5 rounded-full transition-all ${i === index ? 'bg-white' : 'bg-white/30'}`} 
              />
            ))}
          </div>
        </div>
      )}

      {/* ADMIN ADD BUTTON */}
      {isAdmin && (
        <div className="text-right mt-2">
          <button 
            onClick={() => setShowAddModal(true)}
            className="text-xs font-bold text-brand-sky hover:text-sky-600 flex items-center justify-end gap-1 ml-auto"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4">
              <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
            </svg>
            Add Announcement
          </button>
        </div>
      )}

      {/* CREATE MODAL */}
      {showAddModal && (
        <AnnouncementModal onClose={() => setShowAddModal(false)} />
      )}

      {/* EDIT MODAL */}
      {editingItem && (
        <AnnouncementModal 
          initialData={{
            id: editingItem.id,
            title: editingItem.title,
            content: editingItem.content,
            isUrgent: editingItem.isUrgent
          }}
          onClose={() => setEditingItem(null)} 
        />
      )}
    </div>
  )
}

==================================================
FILE: src/components/TestimonialSlider.tsx
==================================================
'use client'

import { useState, useEffect } from 'react'
import StatusBadge from './StatusBadge'

export default function TestimonialSlider({ testimonials }: { testimonials: any[] }) {
  const [pageIndex, setPageIndex] = useState(0)
  const ADMIN_EMAIL = 'idongesit_essien@ymail.com'

  const itemsPerPage = 3 
  const totalPages = Math.ceil(testimonials.length / itemsPerPage)

  useEffect(() => {
    if (totalPages <= 1) return

    const interval = setInterval(() => {
      setPageIndex((prev) => (prev + 1) % totalPages)
    }, 5000)

    return () => clearInterval(interval)
  }, [totalPages])

  if (!testimonials.length) return null

  return (
    <div className="relative w-full overflow-hidden">
      
      {/* SLIDER TRACK */}
      <div 
        className="flex transition-transform duration-700 ease-in-out"
        style={{ transform: `translateX(-${pageIndex * 100}%)` }}
      >
        {testimonials.map((t) => {
          const isAdmin = t.authorEmail?.toLowerCase() === ADMIN_EMAIL.toLowerCase()
          
          // STATUS LOGIC
          const statusEmoji = t.authorStatus ? Array.from(t.authorStatus)[0] : null

          return (
            <div 
              key={t.id} 
              className="w-full md:w-1/2 lg:w-1/3 flex-shrink-0 px-3"
            >
              <div className="h-full min-h-[250px] p-6 rounded-2xl border border-white/20 bg-white/10 backdrop-blur-md shadow-xl flex flex-col justify-between">
                
                <p className="text-white/95 text-lg mb-6 leading-relaxed italic font-medium drop-shadow-sm line-clamp-4">
                  "{t.redactedContent}"
                </p>

                <div className="flex items-center gap-3 border-t border-white/20 pt-4 mt-auto">
                  
                  {/* AVATAR + BADGE */}
                  <div className="relative">
                    {t.authorProfileImage ? (
                      <div className="w-10 h-10 rounded-full shrink-0 shadow-lg border-2 border-white/20 overflow-hidden">
                        <img 
                          src={t.authorProfileImage} 
                          alt={t.displayAuthor} 
                          className="w-full h-full object-cover" 
                        />
                      </div>
                    ) : t.displayAvatar ? (
                      <div className="w-10 h-10 bg-brand-pink text-slate-900 font-bold rounded-full flex items-center justify-center shrink-0 shadow-lg border-2 border-white/20">
                        {t.displayAvatar}
                      </div>
                    ) : (
                      <div className="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center shrink-0 text-white/50 border border-white/10">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                          <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                        </svg>
                      </div>
                    )}
                    
                    {/* ‚úÖ REPLACED MANUAL BADGE WITH COMPONENT */}
                    <StatusBadge status={t.authorStatus} size="normal" />
                  </div>
                  
                  <div className="flex flex-col">
                    <div className="flex items-center gap-2">
                      <span className="font-bold text-white tracking-wide text-sm whitespace-nowrap">
                        {t.displayAuthor}
                      </span>
                      {isAdmin && (
                        <span className="bg-slate-700 text-white text-[10px] font-bold px-1.5 py-0.5 rounded border border-slate-500 flex items-center gap-0.5 shadow-sm">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-2.5 h-2.5">
                            <path fillRule="evenodd" d="M10 1a4.5 4.5 0 0 0-4.5 4.5V9H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2h-.5V5.5A4.5 4.5 0 0 0 10 1Zm3 8V5.5a3 3 0 1 0-6 0V9h6Z" clipRule="evenodd" />
                          </svg>
                          Admin
                        </span>
                      )}
                    </div>
                    <span className="text-xs text-blue-100/80 mt-0.5">
                      {new Date(t.createdAt).toLocaleString(undefined, { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' })}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          )
        })}
      </div>

      {/* Dots */}
      <div className="flex justify-center gap-2 mt-8">
        {Array.from({ length: totalPages }).map((_, idx) => (
          <button
            key={idx}
            onClick={() => setPageIndex(idx)}
            className={`w-2 h-2 rounded-full transition-all ${
              idx === pageIndex ? 'bg-white w-4' : 'bg-white/30 hover:bg-white/50'
            }`}
          />
        ))}
      </div>
    </div>
  )
}

==================================================
FILE: src/components/EmojiButton.tsx
==================================================
'use client'

import { useState, useEffect, useRef } from 'react'
import EmojiPicker, { Theme } from 'emoji-picker-react'

interface EmojiButtonProps {
  onEmojiSelect: (emoji: string) => void
  color?: string
}

export default function EmojiButton({ onEmojiSelect, color = "text-slate-400" }: EmojiButtonProps) {
  const [isOpen, setIsOpen] = useState(false)
  const wrapperRef = useRef<HTMLDivElement>(null)

  // Close if clicked outside
  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) {
        setIsOpen(false)
      }
    }
    document.addEventListener("mousedown", handleClickOutside)
    return () => document.removeEventListener("mousedown", handleClickOutside)
  }, [])

  return (
    <div className="relative" ref={wrapperRef}>
      <button
        type="button"
        onClick={() => setIsOpen(!isOpen)}
        className={`${color} hover:text-brand-yellow transition-colors p-1.5 rounded-full hover:bg-slate-100 flex items-center justify-center`}
        title="Add Emoji"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
          <path strokeLinecap="round" strokeLinejoin="round" d="M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z" />
        </svg>
      </button>

      {isOpen && (
        <div className="absolute z-50 bottom-full right-0 mb-2 shadow-xl rounded-xl border border-slate-100 animate-in zoom-in-95 duration-200">
           <EmojiPicker
             onEmojiClick={(data) => {
               onEmojiSelect(data.emoji)
               setIsOpen(false)
             }}
             theme={Theme.LIGHT}
             lazyLoadEmojis={true}
             width={300}
             height={400}
           />
        </div>
      )}
    </div>
  )
}

==================================================
FILE: src/app/globals.css
==================================================
@import "tailwindcss";

@theme {
  /* This automatically creates bg-brand-sky, text-brand-pink, etc. */
  --color-brand-sky: #87CEEB;    /* Sky blue */
  --color-brand-pink: #FFC5D3;   /* Blush Pink */
  --color-brand-yellow: #FFFFC5; /* Pale Yellow */
  --color-brand-cream: #FDFBD4;  /* Cream */
}

/* You can keep your standard CSS below if you want */
:root {
  --background: #ffffff;
  --foreground: #171717;
}

body {
  background: var(--background);
  color: var(--foreground);
}


==================================================
FILE: src/app/layout.tsx
==================================================
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import Navbar from "@/components/Navbar";
import AutoLogout from "@/components/AutoLogout";
import FeedbackSection from "@/components/FeedbackSection";
import FeedbackWidget from "@/components/FeedbackWidget";
import { cookies } from "next/headers";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "LoveMyFam",
  description: "A safe space for family.",
};

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  // Check Login Status (Used ONLY for AutoLogout visibility now)
  const cookieStore = await cookies()
  const isLoggedIn = cookieStore.has('session_id')

  return (
    <html lang="en">
      <body className={`${geistSans.variable} ${geistMono.variable} antialiased min-h-screen flex flex-col`}>
        
        <Navbar />

        {/* Auto Logout Watchdog (Only active if logged in) */}
        {isLoggedIn && <AutoLogout />}
        
        <main className="flex-1 pt-16"> 
          {children}
        </main>

        {/* 1. Global Feedback Section (Sits above footer) */}
        {/* We removed the 'isLoggedIn' prop to fix the layout bug */}
        <FeedbackSection />

        {/* 2. Global Footer */}
        <footer className="bg-slate-800 text-brand-sky py-8 text-center border-t border-slate-700">
          
          {/* Feedback Widget Trigger (Sits inside footer) */}
          <div className="container mx-auto px-4 mb-6 border-b border-slate-700/50 pb-6">
             {/* We removed the 'isLoggedIn' prop here too */}
            <FeedbackWidget />
          </div>

          <p className="font-medium">¬© {new Date().getFullYear()} LoveMyFam.</p>
          <p className="text-sm text-slate-500 mt-2">
            Built with ‚ù§Ô∏è by{' '}
            <a 
              href="https://instagram.com/idongcodes" 
              target="_blank" 
              rel="noopener noreferrer"
              className="underline hover:text-brand-pink transition-colors"
            >
              idongCodes
            </a>
          </p>
        </footer>

      </body>
    </html>
  );
}

==================================================
FILE: src/app/page.tsx
==================================================
import Image from "next/image";
import Link from "next/link";
import TestimonialSection from "@/components/TestimonialSection"; // <--- 1. Import this

export default function Home() {
  return (
    <main className="min-h-screen flex flex-col font-sans text-slate-800">
      
      {/* --- HERO SECTION --- */}
      <section className="relative bg-brand-sky text-white pt-24 pb-32 px-6 text-center overflow-hidden">
        
        {/* BACKGROUND IMAGE LAYER */}
        <div className="absolute inset-0 z-0">
          <Image
            src="/images/mom_charlie_bg.jpg"
            alt="Mom and Charlie background"
            fill
            className="object-cover opacity-30"
            priority
          />
          {/* THE GRADIENT OVERLAY */}
          <div className="absolute inset-0 bg-gradient-to-b from-transparent via-brand-sky/20 to-brand-sky"></div>
        </div>

        {/* CONTENT LAYER */}
        <div className="relative z-10 max-w-4xl mx-auto flex flex-col items-center">
          
          {/* Main Headline */}
          <h1 className="text-5xl md:text-7xl font-bold mb-6 tracking-tight drop-shadow-md">
            LoveMyFam
          </h1>
          
          {/* Tagline */}
          <p className="text-brand-cream text-xl md:text-2xl font-medium max-w-2xl leading-relaxed mb-12 drop-shadow-sm">
            "A safe space for family. No strangers. No public. Just family."
          </p>

          {/* Call to Actions */}
          <div className="flex flex-col sm:flex-row gap-4 w-full justify-center">
            <Link 
              href="/common-room"
              className="bg-brand-yellow text-slate-800 px-8 py-4 rounded-full font-bold shadow-lg hover:bg-white hover:scale-105 transition-all text-lg"
            >
              Enter Common Room
            </Link>
            
            <Link 
              href="/register"
              className="bg-brand-pink text-slate-800 px-8 py-4 rounded-full font-bold shadow-lg hover:brightness-110 hover:scale-105 transition-all text-lg"
            >
              Join Family
            </Link>
          </div>
        </div>
      </section>

      {/* --- THE MISSION (WHY?) --- */}
      <section className="py-20 px-6 bg-white">
        <div className="max-w-3xl mx-auto text-center">
          <h2 className="text-3xl font-bold mb-8 text-brand-sky">The Mission</h2>
          <p className="text-lg text-slate-600 leading-relaxed mb-8">
            In the age of endless notifications and cluttered group chats, staying genuinely connected feels like a chore. 
            <strong className="text-brand-pink"> LoveMyFam</strong> is designed to eliminate friction. 
            No more long, unplanned phone calls or searching through hundreds of text messages for one update.
          </p>
        </div>
      </section>

      {/* --- FEATURES GRID --- */}
      <section className="bg-brand-cream py-20 px-6">
        <div className="max-w-5xl mx-auto">
          <h2 className="text-3xl font-bold mb-12 text-center text-slate-700">How It Works</h2>
          
          <div className="grid md:grid-cols-3 gap-8">
            {/* Feature 1 */}
            <div className="bg-white p-8 rounded-2xl shadow-sm hover:shadow-md transition-shadow">
              <div className="text-4xl mb-4">üè°</div>
              <h3 className="font-bold text-xl mb-3 text-brand-sky">The Common Room</h3>
              <p className="text-slate-600">
                One central hub for updates. Post once, and everyone sees it. No one gets left out.
              </p>
            </div>

            {/* Feature 2 */}
            <div className="bg-white p-8 rounded-2xl shadow-sm hover:shadow-md transition-shadow">
              <div className="text-4xl mb-4">üîá</div>
              <h3 className="font-bold text-xl mb-3 text-brand-sky">Beat Call Fatigue</h3>
              <p className="text-slate-600">
                Skip the hassle of scheduling video calls. Post asynchronous updates when you are free.
              </p>
            </div>

            {/* Feature 3 */}
            <div className="bg-white p-8 rounded-2xl shadow-sm hover:shadow-md transition-shadow">
              <div className="text-4xl mb-4">üîí</div>
              <h3 className="font-bold text-xl mb-3 text-brand-sky">Invite Only</h3>
              <p className="text-slate-600">
                Protected by family trivia. "What is your aunt's middle name?" keeps strangers out.
              </p>
            </div>
          </div>
        </div>
      </section>

      {/* --- TESTIMONIALS SECTION --- */}
      {/* 2. Added here to sit right above the global Feedback Section */}
      <TestimonialSection />

    </main>
  );
}

==================================================
FILE: src/app/actions.ts
==================================================
'use server'

import { cookies } from 'next/headers'
import { redirect } from 'next/navigation'

// ... (keep your existing logout function) ...
export async function logout() {
  const cookieStore = await cookies()
  cookieStore.delete('session_id')
  redirect('/')
}

// NEW: Handle General Feedback
export async function submitGeneralFeedback(content: string) {
  const cookieStore = await cookies()
  const userId = cookieStore.get('session_id')?.value

  if (!userId) {
    return { error: 'unauthorized' }
  }

  // TODO: Save this to a database table (e.g., 'Feedback') later.
  console.log("Feedback received:", content, "From:", userId)

  return { success: true }
}

==================================================
FILE: src/app/my-room/page.tsx
==================================================
import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'
import MyRoomClient from '@/components/MyRoomClient'

const prisma = new PrismaClient()

async function getUser() {
  const cookieStore = await cookies()
  const userId = cookieStore.get('session_id')?.value
  if (!userId) return null

  return await prisma.user.findUnique({
    where: { id: userId }
  })
}

export default async function MyRoom() {
  const user = await getUser()

  if (!user) {
    return (
      <main className="min-h-screen flex items-center justify-center font-sans">
        <p>Please log in to view your room.</p>
      </main>
    )
  }

  return (
    <main className="min-h-screen bg-slate-50 font-sans p-8">
      <MyRoomClient user={user} />
    </main>
  )
}

==================================================
FILE: src/app/my-room/actions.ts
==================================================
'use server'

import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'
import { put } from '@vercel/blob'
import { revalidatePath } from 'next/cache'

const prisma = new PrismaClient()

// --- 1. UPDATE PROFILE PHOTO ---
export async function updateProfilePhoto(formData: FormData) {
  const cookieStore = await cookies()
  const userId = cookieStore.get('session_id')?.value

  if (!userId) return { success: false, message: "Unauthorized" }

  const imageFile = formData.get('file') as File | null

  if (!imageFile || imageFile.size === 0) {
    return { success: false, message: "No image provided" }
  }

  try {
    const blob = await put(imageFile.name, imageFile, { access: 'public' })

    await prisma.user.update({
      where: { id: userId },
      data: { profileImage: blob.url }
    })

    revalidatePath('/my-room')
    revalidatePath('/common-room')
    revalidatePath('/family')
    revalidatePath('/') 

    return { success: true, url: blob.url }
  } catch (error) {
    console.error("Upload failed:", error)
    return { success: false, message: "Failed to upload image" }
  }
}

// --- 2. UPDATE PROFILE DETAILS (Updated with Status) ---
export async function updateProfileDetails(formData: FormData) {
  const cookieStore = await cookies()
  const userId = cookieStore.get('session_id')?.value

  if (!userId) return { success: false, message: "Unauthorized" }

  const bio = formData.get('bio') as string
  const location = formData.get('location') as string
  const alias = formData.get('alias') as string 
  const firstName = formData.get('firstName') as string
  const lastName = formData.get('lastName') as string
  const position = formData.get('position') as string
  const status = formData.get('status') as string // <--- NEW

  if (!firstName || !lastName || !position) {
    return { success: false, message: "Name and Position are required." }
  }

  try {
    await prisma.user.update({
      where: { id: userId },
      data: {
        bio,
        location,
        alias,
        firstName,
        lastName,
        position,
        status // <--- Save Status
      }
    })

    revalidatePath('/my-room')
    revalidatePath('/family') 
    revalidatePath('/common-room')
    
    return { success: true }
  } catch (error) {
    console.error("Update failed:", error)
    return { success: false, message: "Failed to update profile" }
  }
}

==================================================
FILE: src/app/login/page.tsx
==================================================
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { login } from './actions'

export default function LoginPage() {
  const [error, setError] = useState('')
  const router = useRouter()

  async function handleSubmit(formData: FormData) {
    const result = await login(formData)
    
    if (result.success) {
      router.push('/common-room') // Success! Go to the room.
    } else {
      setError(result.message || "An unexpected error occurred.")
    }
  }

  return (
    <main className="min-h-screen flex items-center justify-center bg-brand-sky/10 px-4">
      <div className="bg-white p-8 rounded-2xl shadow-lg max-w-md w-full border border-slate-100">
        
        <h1 className="text-3xl font-bold text-center text-brand-sky mb-2">Family Login</h1>
        <p className="text-center text-slate-400 mb-8">Enter your email and the family secret.</p>

        <form action={handleSubmit} className="space-y-4">
          
          {/* Email Field */}
          <div>
            <label className="block text-sm font-medium text-slate-700 mb-1">Your Email</label>
            <input 
              name="email" 
              type="email" 
              required
              placeholder="you@example.com"
              className="w-full p-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-brand-sky focus:outline-none"
            />
          </div>

          {/* Secret Field */}
          <div>
            <label className="block text-sm font-medium text-slate-700 mb-1">Family Secret</label>
            <input 
              name="password" 
              type="password" 
              required
              placeholder="What is the secret?"
              className="w-full p-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-brand-sky focus:outline-none"
            />
          </div>

          {/* Error Message Display */}
          {error && (
            <p className="text-red-500 text-sm text-center bg-red-50 p-2 rounded">{error}</p>
          )}

          {/* Submit Button */}
          <button 
            type="submit" 
            className="w-full bg-brand-pink text-slate-800 font-bold py-3 rounded-lg hover:brightness-105 transition-all shadow-sm"
          >
            Open the Door
          </button>
        </form>

        {/* Footer Links */}
        <div className="mt-8 text-center space-y-3">
          <Link href="/register" className="block text-sm text-brand-sky font-bold hover:underline">
            New to the family? Register here
          </Link>
          <Link href="/" className="block text-sm text-slate-400 hover:text-brand-sky transition-colors">
            ‚Üê Back Home
          </Link>
        </div>
      </div>
    </main>
  )
}


==================================================
FILE: src/app/login/actions.ts
==================================================
'use server'

import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'

const prisma = new PrismaClient()

export async function login(formData: FormData) {
  const email = formData.get('email') as string
  const password = formData.get('password') as string

  // 1. Check the Shared Family Secret
  if (password !== 'familyfirst') {
    return { success: false, message: 'Wrong family secret!' }
  }

  // 2. Check if the user exists in our Database
  const user = await prisma.user.findUnique({
    where: { email: email }
  })

  if (!user) {
    return { success: false, message: 'Email not found. Please register first!' }
  }

  // 3. Set the Session Cookie
  const cookieStore = await cookies()
  cookieStore.set('session_id', user.id, {
    httpOnly: true,
    secure: process.env.NODE_ENV === 'production',
    maxAge: 60 * 60 * 24 * 7, // 1 week
    path: '/',
  })

  return { success: true }
}


==================================================
FILE: src/app/testimonials/actions.ts
==================================================
'use server'

import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'
import { revalidatePath } from 'next/cache'

const prisma = new PrismaClient()

async function getCurrentUserId() {
  const cookieStore = await cookies()
  return cookieStore.get('session_id')?.value
}

// 1. SUBMIT ACTION
export async function submitTestimonial(content: string) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false, message: "Must be logged in" }
  
  if (!content.trim()) return { success: false, message: "Content empty" }

  await prisma.testimonial.create({
    data: {
      content,
      authorId: userId
    }
  })

  revalidatePath('/') 
  return { success: true }
}

// 2. SECURE FETCH ACTION
export async function getTestimonials() {
  const currentUserId = await getCurrentUserId()
  const isGuest = !currentUserId

  const testimonials = await prisma.testimonial.findMany({
    take: 6,
    orderBy: { createdAt: 'desc' },
    include: {
      author: {
        // ‚úÖ ADDED: 'status' to selection
        select: { firstName: true, alias: true, email: true, profileImage: true, status: true } 
      }
    }
  })

  // HELPER: List of sensitive names to redact
  let sensitiveWords = new Set<string>()
  if (isGuest) {
    const allUsers = await prisma.user.findMany({
      select: { firstName: true, alias: true }
    })
    allUsers.forEach(u => {
      if (u.firstName) sensitiveWords.add(u.firstName.toLowerCase())
      if (u.alias) sensitiveWords.add(u.alias.toLowerCase())
    })
  }

  const redactText = (text: string) => {
    const words = text.split(' ')
    return words.map(word => {
      const cleanWord = word.replace(/[^\w]/g, '').toLowerCase()
      if (sensitiveWords.has(cleanWord)) {
        return "Family Member"
      }
      return word
    }).join(' ')
  }

  return testimonials.map(t => {
    // If Guest, we hide email AND profile image AND status
    if (isGuest) {
      return {
        id: t.id,
        content: t.content,
        createdAt: t.createdAt,
        authorEmail: null, 
        authorProfileImage: null, 
        authorStatus: null, // <--- Hide status
        displayAuthor: "Family Member",
        displayAvatar: null,
        redactedContent: redactText(t.content)
      }
    }

    // If Logged In, we show everything
    return {
      id: t.id,
      content: t.content,
      createdAt: t.createdAt,
      authorEmail: t.author.email,
      authorProfileImage: t.author.profileImage,
      authorStatus: t.author.status, // <--- Pass status
      displayAuthor: t.author.alias || t.author.firstName,
      displayAvatar: (t.author.alias || t.author.firstName)[0].toUpperCase(),
      redactedContent: t.content
    }
  })
}

==================================================
FILE: src/app/register/page.tsx
==================================================
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { registerUser } from './actions'

export default function RegisterPage() {
  const [error, setError] = useState('')
  const [answer, setAnswer] = useState('') // Track what they type
  const router = useRouter()

  // Check if they got it right (Case insensitive)
  const isSecurityCorrect = answer.trim().toLowerCase() === 'mercy'

  async function handleSubmit(formData: FormData) {
    const result = await registerUser(formData)
    
    if (result.success) {
      router.push('/common-room')
    } else {
      setError(result.message || "Something went wrong")
    }
  }

  return (
    <main className="min-h-screen flex items-center justify-center bg-brand-cream/30 px-4 py-10">
      <div className="bg-white p-8 rounded-2xl shadow-lg max-w-lg w-full border border-slate-100">
        
        <h1 className="text-3xl font-bold text-center text-brand-sky mb-2">Join the Family</h1>
        <p className="text-center text-slate-400 mb-8">Create your profile to enter the Common Room.</p>

        <form action={handleSubmit} className="space-y-4">
          
          {/* PERSONAL DETAILS */}
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-xs font-bold text-slate-500 mb-1">FIRST NAME</label>
              <input name="firstName" required className="w-full p-3 rounded-lg bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none" />
            </div>
            <div>
              <label className="block text-xs font-bold text-slate-500 mb-1">LAST NAME</label>
              <input name="lastName" required className="w-full p-3 rounded-lg bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none" />
            </div>
          </div>

          <div>
            <label className="block text-xs font-bold text-slate-500 mb-1">PREFERRED ALIAS (Optional)</label>
            <input name="alias" placeholder="What should we call you?" className="w-full p-3 rounded-lg bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none" />
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-xs font-bold text-slate-500 mb-1">PHONE</label>
              <input name="phone" type="tel" required className="w-full p-3 rounded-lg bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none" />
            </div>
            <div>
              <label className="block text-xs font-bold text-slate-500 mb-1">EMAIL</label>
              <input name="email" type="email" required className="w-full p-3 rounded-lg bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none" />
            </div>
          </div>

          {/* SECURITY QUESTION */}
          <div className={`p-4 rounded-xl border transition-colors duration-500 ${isSecurityCorrect ? 'bg-green-50 border-green-200' : 'bg-brand-yellow/20 border-brand-yellow'}`}>
            <label className="block text-sm font-bold text-slate-700 mb-2">
              üîí Security Question
            </label>
            <p className="text-sm text-slate-600 mb-3 italic">
              "What is Charlie's Grandma's name on her Father's side?"
            </p>
            <input 
              name="securityAnswer" 
              required 
              placeholder="Answer..."
              value={answer}
              onChange={(e) => setAnswer(e.target.value)}
              className="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-brand-pink outline-none" 
            />
          </div>

          {/* HIDDEN "POSITION" FIELD - APPEARS ON SUCCESS */}
          {isSecurityCorrect && (
            <div className="animate-fade-in-down">
              <div className="bg-brand-sky/10 p-4 rounded-xl border border-brand-sky mt-4">
                <label className="block text-sm font-bold text-brand-sky mb-2">
                  ‚úÖ Correct! One last thing...
                </label>
                <p className="text-xs text-slate-500 mb-2">How are you related to the family? (e.g. Cousin, Aunt, Friend)</p>
                <input 
                  name="position" 
                  required 
                  placeholder="I am a..."
                  className="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-brand-sky outline-none" 
                />
              </div>
              
              <button 
                type="submit" 
                className="w-full bg-brand-sky text-white font-bold py-4 rounded-xl shadow-md hover:bg-sky-500 transition-all mt-4"
              >
                Complete Registration
              </button>
            </div>
          )}

          {error && (
            <p className="text-red-500 text-sm text-center bg-red-50 p-2 rounded mt-2">{error}</p>
          )}

        </form>

        <div className="mt-6 text-center">
          <Link href="/login" className="text-sm text-brand-pink font-bold hover:underline">
            Already have an account? Login here
          </Link>
        </div>
      </div>
    </main>
  )
}


==================================================
FILE: src/app/register/actions.ts
==================================================
'use server'

import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'

const prisma = new PrismaClient()

export async function registerUser(formData: FormData) {
  const firstName = formData.get('firstName') as string
  const lastName = formData.get('lastName') as string
  const alias = formData.get('alias') as string || firstName
  const email = formData.get('email') as string
  const phone = formData.get('phone') as string
  const securityAnswer = formData.get('securityAnswer') as string
  
  // 1. GRAB THE POSITION FROM THE FORM
  const position = formData.get('position') as string 

  // 2. THE SECURITY CHECK
  if (securityAnswer.trim().toLowerCase() !== 'mercy') {
    return { success: false, message: "Incorrect security answer." }
  }

  // 3. CHECK IF USER EXISTS
  const existingUser = await prisma.user.findUnique({
    where: { email: email }
  })

  if (existingUser) {
    return { success: false, message: "This email is already registered. Please Login." }
  }

  // 4. CREATE THE USER (INCLUDE POSITION!)
  const newUser = await prisma.user.create({
    data: {
      firstName,
      lastName,
      alias,
      email,
      phone,
      position, // <--- THIS WAS MISSING
    }
  })


  // 5. SET SESSION COOKIE
  const cookieStore = await cookies()
  cookieStore.set('session_id', newUser.id, {
    httpOnly: true,
    secure: process.env.NODE_ENV === 'production',
    maxAge: 60 * 60 * 24 * 7, // 1 week
    path: '/',
  })

  return { success: true }
}


==================================================
FILE: src/app/family/page.tsx
==================================================
import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'
import Link from 'next/link'
import StatusBadge from '@/components/StatusBadge' // <--- Import

const prisma = new PrismaClient()

async function getUsers() {
  return await prisma.user.findMany({
    orderBy: { createdAt: 'asc' },
    // ‚úÖ Make sure to select 'status'
    select: { 
      id: true, 
      firstName: true, 
      lastName: true, 
      alias: true, 
      position: true, 
      profileImage: true, 
      email: true,
      status: true // <--- FETCHING STATUS
    }
  })
}

export default async function FamilyDirectory() {
  const users = await getUsers()
  const cookieStore = await cookies()
  const currentUserEmail = 'idongesit_essien@ymail.com' // Admin check
  
  // Find current user's session to determine if they are admin (optional logic)
  const sessionId = cookieStore.get('session_id')?.value
  const currentUser = users.find(u => u.id === sessionId)
  const isAdmin = currentUser?.email === currentUserEmail

  return (
    <main className="min-h-screen bg-slate-50 font-sans p-8">
      <div className="max-w-6xl mx-auto mt-8">
        
        <div className="flex justify-between items-end mb-8">
          <div>
            <h1 className="text-3xl font-bold text-brand-sky">Family Directory</h1>
            <p className="text-slate-500">Meet the fam.</p>
          </div>
          <Link href="/common-room" className="text-sm font-bold text-slate-400 hover:text-brand-pink transition-colors">
            &larr; Back to Common Room
          </Link>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {users.map((user) => (
            <div key={user.id} className={`bg-white p-6 rounded-2xl shadow-sm border flex items-center gap-4 hover:shadow-md transition-shadow relative group ${isAdmin && user.email === currentUserEmail ? 'border-brand-sky/30 bg-brand-sky/5' : 'border-slate-100'}`}>
              
              {/* AVATAR + STATUS */}
              <div className="relative">
                <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold shrink-0 overflow-hidden ${!user.profileImage ? 'bg-brand-sky/20 text-brand-sky' : ''}`}>
                  {user.profileImage ? (
                    <img src={user.profileImage} alt={user.firstName} className="w-full h-full object-cover" />
                  ) : (
                    (user.alias || user.firstName)[0].toUpperCase()
                  )}
                </div>
                
                {/* ‚úÖ ADD STATUS BADGE */}
                <StatusBadge status={user.status} size="normal" />
              </div>

              {/* INFO */}
              <div className="flex flex-col min-w-0">
                <div className="flex items-center gap-2">
                  <span className="font-bold text-slate-800 text-lg truncate">
                    {user.firstName} {user.lastName}
                  </span>
                  {user.id === sessionId && (
                    <span className="text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-bold">YOU</span>
                  )}
                </div>
                
                {user.alias && (
                  <span className="text-sm text-slate-400 font-medium truncate">@{user.alias}</span>
                )}
                
                <span className="text-xs text-brand-sky font-bold uppercase tracking-wider mt-1 truncate">
                  {user.position}
                </span>
              </div>

            </div>
          ))}
        </div>

      </div>
    </main>
  )
}

==================================================
FILE: src/app/common-room/page.tsx
==================================================
import { PrismaClient } from "@prisma/client";
import { cookies } from "next/headers";
import PostInput from "@/components/PostInput";
import PostCard from "@/components/PostCard";
import AnnouncementCarousel from "@/components/AnnouncementCarousel";
import { getFeedData, getAnnouncements } from "./actions";

const prisma = new PrismaClient();

async function getUser() {
  const cookieStore = await cookies()
  const sessionId = cookieStore.get('session_id')?.value
  if (!sessionId) return null

  return await prisma.user.findUnique({
    where: { id: sessionId }
  })
}

export default async function CommonRoom() {
  const user = await getUser()
  const announcements = await getAnnouncements()
  const { urgentPosts, regularPosts } = await getFeedData()

  const welcomeName = user?.alias || user?.firstName || "Family Member";

  return (
    <main className="min-h-screen bg-slate-50 font-sans">
      <div className="max-w-2xl mx-auto p-4 mt-8 pb-20">
        
        {/* HEADER */}
        <div className="flex flex-col md:flex-row justify-between md:items-end mb-6 gap-2">
          <h1 className="text-3xl font-bold text-brand-sky tracking-tight">
            The Common Room
          </h1>
          <h2 className="text-slate-500 font-medium text-sm md:text-lg pb-1 md:text-right">
            Welcome home, <span className="text-brand-pink font-bold">{welcomeName}</span>.
          </h2>
        </div>

        {/* ANNOUNCEMENTS CAROUSEL */}
        <AnnouncementCarousel 
          announcements={announcements} 
          currentUserEmail={user?.email} 
        />

        {/* INPUT FORM */}
        <PostInput />

        {/* FEED */}
        <div className="space-y-6">
          
          {/* 1. URGENT ANNOUNCEMENTS (Pinned at top) */}
          {urgentPosts.map((post) => (
             <PostCard 
              key={post.id} 
              post={post} 
              currentUserId={user?.id || ''}
            />
          ))}

          {/* 2. REGULAR POSTS */}
          {regularPosts.map((post) => (
            <PostCard 
              key={post.id} 
              post={post} 
              currentUserId={user?.id || ''}
            />
          ))}

        </div>
      </div>
    </main>
  );
}

==================================================
FILE: src/app/common-room/actions.ts
==================================================
'use server'

import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'
import { revalidatePath } from 'next/cache'
import { put } from '@vercel/blob'

const prisma = new PrismaClient()

// --- HELPER: GET CURRENT USER ID ---
async function getCurrentUserId() {
  const cookieStore = await cookies()
  return cookieStore.get('session_id')?.value
}

// =======================================================
// 1. POST ACTIONS
// =======================================================

export async function createPost(formData: FormData) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false, message: 'Unauthorized' }

  const content = formData.get('content') as string || ""
  const imageFile = formData.get('file') as File | null 

  const hasText = content.trim().length > 0
  const hasImage = imageFile && imageFile.size > 0

  if (!hasText && !hasImage) {
    return { success: false, message: "Post cannot be empty" }
  }

  let imageUrl = null

  if (hasImage) {
    const blob = await put(imageFile!.name, imageFile!, {
      access: 'public',
    })
    imageUrl = blob.url
  }

  await prisma.post.create({
    data: {
      content,
      imageUrl,
      authorId: userId
    }
  })

  revalidatePath('/common-room')
  return { success: true }
}

export async function deletePost(postId: string) {
  const userId = await getCurrentUserId()
  
  const post = await prisma.post.findUnique({ where: { id: postId } })
  if (!post || post.authorId !== userId) {
    return { success: false, message: 'Unauthorized' }
  }

  await prisma.post.delete({ where: { id: postId } })
  revalidatePath('/common-room')
  return { success: true }
}

// --- UPDATED: EDIT POST (Supports Title/Urgency for Announcements) ---
export async function editPost(
  postId: string, 
  newContent: string, 
  newTitle?: string, 
  newIsUrgent?: boolean
) {
  const userId = await getCurrentUserId()
  const post = await prisma.post.findUnique({ where: { id: postId } })
  
  if (!post || post.authorId !== userId) return { success: false, message: 'Unauthorized' }
  
  const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1000)
  
  // Rule: Regular posts have a 10-minute edit limit. Announcements (Admin) do not.
  if (!post.isAnnouncement && post.createdAt < tenMinutesAgo) {
      return { success: false, message: 'Edit time limit expired.' }
  }

  // Prepare update data
  const data: any = { content: newContent, isEdited: true }
  
  // Only update title/urgent if provided (for announcements)
  if (newTitle !== undefined) data.title = newTitle
  if (newIsUrgent !== undefined) data.isUrgent = newIsUrgent

  await prisma.post.update({
    where: { id: postId },
    data
  })

  revalidatePath('/common-room')
  return { success: true }
}

export async function toggleLike(postId: string) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false, message: "Unauthorized" }

  const existingLike = await prisma.like.findUnique({
    where: {
      userId_postId: {
        userId,
        postId
      }
    }
  })

  if (existingLike) {
    await prisma.like.delete({ where: { id: existingLike.id } })
  } else {
    await prisma.like.create({ data: { userId, postId } })
  }

  revalidatePath('/common-room')
  return { success: true }
}

// =======================================================
// 2. COMMENT ACTIONS
// =======================================================

export async function addComment(postId: string, content: string, parentId?: string) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false, message: "Unauthorized" }

  if (!content || content.trim().length === 0) return { success: false }

  await prisma.comment.create({
    data: {
      content,
      postId,
      authorId: userId,
      parentId: parentId || null
    }
  })

  revalidatePath('/common-room')
  return { success: true }
}

export async function toggleCommentLike(commentId: string) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false, message: "Unauthorized" }

  const existingLike = await prisma.commentLike.findUnique({
    where: {
      userId_commentId: {
        userId,
        commentId
      }
    }
  })

  if (existingLike) {
    await prisma.commentLike.delete({ where: { id: existingLike.id } })
  } else {
    await prisma.commentLike.create({ data: { userId, commentId } })
  }

  revalidatePath('/common-room')
  return { success: true }
}

export async function deleteComment(commentId: string) {
  const userId = await getCurrentUserId()
  
  const comment = await prisma.comment.findUnique({ where: { id: commentId } })
  if (!comment || comment.authorId !== userId) {
    return { success: false, message: 'Unauthorized' }
  }

  await prisma.comment.delete({ where: { id: commentId } })
  revalidatePath('/common-room')
  return { success: true }
}

export async function editComment(commentId: string, newContent: string) {
  const userId = await getCurrentUserId()
  const comment = await prisma.comment.findUnique({ where: { id: commentId } })
  
  if (!comment || comment.authorId !== userId) return { success: false, message: 'Unauthorized' }
  if (comment.isEdited) return { success: false, message: 'Comment can only be edited once.' }

  const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1000)
  if (comment.createdAt < tenMinutesAgo) return { success: false, message: 'Edit time limit expired.' }

  await prisma.comment.update({
    where: { id: commentId },
    data: { content: newContent, isEdited: true }
  })

  revalidatePath('/common-room')
  return { success: true }
}

// =======================================================
// 3. ANNOUNCEMENT ACTIONS
// =======================================================

export async function createAnnouncement(formData: FormData) {
  const userId = await getCurrentUserId()
  const ADMIN_EMAIL = 'idongesit_essien@ymail.com'

  const user = await prisma.user.findUnique({ where: { id: userId } })
  if (user?.email !== ADMIN_EMAIL) {
    return { success: false, message: "Only Admin can post announcements." }
  }

  const title = formData.get('title') as string
  const message = formData.get('message') as string
  const isUrgent = formData.get('isUrgent') === 'true'

  if (!message || !title) return { success: false, message: "Title and Message are required." }

  await prisma.post.create({
    data: {
      title,
      content: message,
      authorId: userId!,
      isAnnouncement: true,
      isUrgent: isUrgent
    }
  })

  revalidatePath('/common-room')
  return { success: true }
}

export async function dismissAnnouncement(postId: string) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false }

  await prisma.postDismissal.create({
    data: {
      userId,
      postId
    }
  })

  revalidatePath('/common-room')
  return { success: true }
}

export async function getAnnouncements() {
  return await prisma.post.findMany({
    where: { isAnnouncement: true },
    orderBy: { createdAt: 'desc' },
    take: 5
  })
}

// =======================================================
// 4. FEED FETCHING (Split Urgent vs Regular)
// =======================================================

export async function getFeedData() {
  const userId = await getCurrentUserId()
  
  // 1. Get Urgent Announcements (Not dismissed by me)
  const urgentPosts = await prisma.post.findMany({
    where: {
      isAnnouncement: true,
      isUrgent: true,
      dismissals: {
        none: { userId: userId } 
      }
    },
    include: {
      author: true,
      likes: { include: { user: true } },
      comments: { include: { author: true, likes: true, children: true } }
    },
    orderBy: { createdAt: 'desc' }
  })

  // 2. Get Regular Posts (Not announcements)
  const regularPosts = await prisma.post.findMany({
    where: {
      isAnnouncement: false
    },
    include: {
      author: true,
      likes: { include: { user: true } },
      comments: { include: { author: true, likes: true, children: true } }
    },
    orderBy: { createdAt: 'desc' }
  })

  // Helper to map data structure for frontend
  const mapPost = (p: any) => ({
    ...p,
    likeCount: p.likes.length,
    isLikedByMe: userId ? p.likes.some((l: any) => l.userId === userId) : false,
    topLevelComments: p.comments.filter((c: any) => !c.parentId)
  })

  return {
    urgentPosts: urgentPosts.map(mapPost),
    regularPosts: regularPosts.map(mapPost),
    currentUserId: userId
  }
}

==================================================
FILE: src/hooks/useLongPress.ts
==================================================
import { useCallback, useRef, useState } from 'react';

export default function useLongPress(
  onLongPress: () => void,
  onClick: () => void,
  { shouldPreventDefault = true, delay = 500 } = {}
) {
  const [longPressTriggered, setLongPressTriggered] = useState(false);
  const timeout = useRef<NodeJS.Timeout>(undefined);
  const target = useRef<EventTarget>(undefined);

  const start = useCallback(
    (event: React.MouseEvent | React.TouchEvent) => {
      if (shouldPreventDefault && event.target) {
        target.current = event.target;
      }
      timeout.current = setTimeout(() => {
        onLongPress();
        setLongPressTriggered(true);
      }, delay);
    },
    [onLongPress, delay, shouldPreventDefault]
  );

  const clear = useCallback(
    (_event: React.MouseEvent | React.TouchEvent, shouldTriggerClick = true) => {
      timeout.current && clearTimeout(timeout.current);
      
      // If the timer didn't finish (it wasn't a long press), trigger the normal click
      if (shouldTriggerClick && !longPressTriggered) {
        onClick();
      }
      
      setLongPressTriggered(false);
      target.current = undefined;
    },
    [onClick, longPressTriggered] // <--- FIXED: Removed 'shouldTriggerClick' from here
  );

  return {
    onMouseDown: (e: any) => start(e),
    onTouchStart: (e: any) => start(e),
    onMouseUp: (e: any) => clear(e),
    onMouseLeave: (e: any) => clear(e, false),
    onTouchEnd: (e: any) => clear(e)
  };
}

==================================================
FILE: prisma/seed.ts
==================================================
const { PrismaClient } = require('@prisma/client')

const prisma = new PrismaClient()

async function main() {
  const user = await prisma.user.upsert({
    where: { email: 'idongesit_essien@ymail.com' },
    update: {}, // If you already exist, do nothing
    create: {
      email: 'idongesit_essien@ymail.com',
      firstName: 'Idongesit',
      lastName: 'Essien',
      alias: 'Idong',
      position: 'Creator',
      phone: '+17743126471',
      posts: {
        create: {
          content: 'Welcome to the Common Room! This is the first official post.',
        },
      },
    },
  })

  console.log('Seed successful! Created user:', user)
}

main()
  .then(async () => {
    await prisma.$disconnect()
  })
  .catch(async (e) => {
    console.error(e)
    await prisma.$disconnect()
    process.exit(1)
  })

==================================================
FILE: prisma/schema.prisma
==================================================
// 1. CONFIGURATION
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

// 2. USER MODEL
model User {
  id           String   @id @default(cuid())
  firstName    String
  lastName     String
  alias        String?
  position     String
  email        String   @unique
  phone        String?
  profileImage String?

  // --- NEW FIELDS ---
  bio       String?  // About Me
  location  String?  // Current City/State
  status    String?

  createdAt    DateTime @default(now())

  // Relations
  posts         Post[]          @relation("UserPosts")
  comments      Comment[]
  likes         Like[]
  commentLikes  CommentLike[]
  Testimonial   Testimonial[]
  dismissals    PostDismissal[]
}

// 3. POST MODEL
model Post {
  id        String   @id @default(cuid())
  content   String
  imageUrl  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isEdited  Boolean  @default(false)

  // --- NEW FIELDS FOR ANNOUNCEMENTS ---
  title          String? // Optional title
  isAnnouncement Boolean @default(false)
  isUrgent       Boolean @default(false)

  // Relations
  authorId      String
  author        User            @relation("UserPosts", fields: [authorId], references: [id])
  comments      Comment[]
  likes         Like[]
  dismissals PostDismissal[]
}

// 4. POST LIKE MODEL
model Like {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  userId String
  postId String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, postId]) // A user can only like a post once
}

// 5. COMMENT MODEL (Supports Recursion & Editing)
model Comment {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt // Tracks when it was edited
  isEdited  Boolean  @default(false) // Tracks if it was edited

  postId String
  post   Post   @relation(fields: [postId], references: [id], onDelete: Cascade)

  authorId String
  author   User   @relation(fields: [authorId], references: [id])

  // Recursive Relations (Replies)
  parentId String?
  parent   Comment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  children Comment[] @relation("CommentReplies")

  // Likes on Comments
  likes CommentLike[]
}

// 6. COMMENT LIKE MODEL
model CommentLike {
  id String @id @default(cuid())

  userId    String
  commentId String

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  comment Comment @relation(fields: [commentId], references: [id], onDelete: Cascade)

  @@unique([userId, commentId]) // A user can only like a comment once
}

// 7. TESTIMONIAL MODEL
model Testimonial {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())

  authorId String
  author   User   @relation(fields: [authorId], references: [id])
}

// NEW: POST DISMISSAL MODEL
model PostDismissal {
  id     String @id @default(cuid())
  userId String
  postId String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
}
</file>

<file path="src/app/page.tsx">
import Image from "next/image";
import Link from "next/link";
import TestimonialSection from "@/components/TestimonialSection";
import DailyVerse from "@/components/DailyVerse"; // <--- 1. Import

export default function Home() {
  return (
    <main className="min-h-screen flex flex-col font-sans text-slate-800">
      
      {/* --- HERO SECTION --- */}
      <section className="relative bg-brand-sky text-white pt-42 pb-32 px-6 text-center overflow-hidden">
        
        {/* BACKGROUND IMAGE LAYER */}
        <div className="absolute inset-0 z-0">
          <Image
            src="/images/mom_charlie_bg.jpg"
            alt="Mom and Charlie background"
            fill
            className="object-cover opacity-30"
            priority
          />
          {/* THE GRADIENT OVERLAY */}
          <div className="absolute inset-0 bg-gradient-to-b from-transparent via-brand-sky/20 to-brand-sky"></div>
        </div>

        {/* CONTENT LAYER */}
        <div className="relative z-10 max-w-4xl mx-auto flex flex-col items-center">
          
          {/* Main Headline */}
          <h1 className="text-5xl md:text-7xl font-bold mb-6 tracking-tight drop-shadow-md">
            LoveMyFam
          </h1>
          
          {/* Tagline */}
          <p className="text-brand-cream text-xl md:text-2xl font-medium max-w-2xl leading-relaxed mb-12 drop-shadow-sm">
            "A safe space for family. No strangers. No public. Just family."
          </p>

          {/* Call to Actions */}
          <div className="flex flex-col sm:flex-row gap-4 w-full justify-center mb-8">
            <Link 
              href="/common-room"
              className="bg-brand-yellow text-slate-800 px-8 py-4 rounded-full font-bold shadow-lg hover:bg-white hover:scale-105 transition-all text-lg"
            >
              Enter Common Room
            </Link>
            
            <Link 
              href="/register"
              className="bg-brand-pink text-slate-800 px-8 py-4 rounded-full font-bold shadow-lg hover:brightness-110 hover:scale-105 transition-all text-lg"
            >
              Join Family
            </Link>
          </div>

          {/* --- NEW: DAILY VERSE --- */}
          <DailyVerse />

        </div>
      </section>

      <section className="py-20 px-6 bg-white">
        <div className="max-w-3xl mx-auto text-center">
          <h2 className="text-3xl font-bold mb-8 text-brand-sky">The Mission</h2>
          <p className="text-lg text-slate-600 leading-relaxed mb-8">
            In the age of endless notifications and cluttered group chats, staying genuinely connected feels like a chore.
            <strong className="text-brand-pink"> LoveMyFam</strong> is designed to eliminate friction. 
            No more long, unplanned phone calls or searching through hundreds of text messages for one update.
          </p>
        </div>
      </section>

      <section className="bg-brand-cream py-20 px-6">
        <div className="max-w-5xl mx-auto">
          <h2 className="text-3xl font-bold mb-12 text-center text-slate-700">How It Works</h2>
          
          <div className="grid md:grid-cols-3 gap-8">
            <div className="bg-white p-8 rounded-2xl shadow-sm hover:shadow-md transition-shadow">
              <div className="text-4xl mb-4">üè°</div>
              <h3 className="font-bold text-xl mb-3 text-brand-sky">The Common Room</h3>
              <p className="text-slate-600">
                One central hub for updates. Post once, and everyone sees it. No one gets left out.
              </p>
            </div>

            <div className="bg-white p-8 rounded-2xl shadow-sm hover:shadow-md transition-shadow">
              <div className="text-4xl mb-4">üîá</div>
              <h3 className="font-bold text-xl mb-3 text-brand-sky">Beat Call Fatigue</h3>
              <p className="text-slate-600">
                Skip the hassle of scheduling video calls. Post asynchronous updates when you are free.
              </p>
            </div>

            <div className="bg-white p-8 rounded-2xl shadow-sm hover:shadow-md transition-shadow">
              <div className="text-4xl mb-4">üîí</div>
              <h3 className="font-bold text-xl mb-3 text-brand-sky">Invite Only</h3>
              <p className="text-slate-600">
                Protected by family trivia. "What is your aunt's middle name?" keeps strangers out.
              </p>
            </div>
          </div>
        </div>
      </section>

      <TestimonialSection />

    </main>
  );
}
</file>

<file path="src/components/BottomNav.tsx">
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { logout } from '@/app/actions'
import { useState } from 'react'
import ChatModal from './ChatModal'

export default function BottomNav({ isLoggedIn }: { isLoggedIn: boolean }) {
  const pathname = usePathname()
  const [isChatOpen, setIsChatOpen] = useState(false)

  const navItems = [
    {
      name: 'Home',
      href: '/',
      icon: (
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
      ),
    },
    ...(isLoggedIn ? [
      {
        name: 'Common Room',
        href: '/common-room',
        icon: (
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
        ),
      },
      {
        name: 'Family',
        href: '/family',
        icon: (
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
        ),
      },
      {
        name: 'My Room',
        href: '/my-room',
        icon: (
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
        ),
      },
      {
        name: 'Chat',
        href: '/chat',
        icon: (
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
          </svg>
        ),
        isButton: true,
        onClick: () => setIsChatOpen(true),
      },
    ] : []),
  ]

  const isActive = (href: string) => {
    if (href === '/') {
      return pathname === '/'
    }
    return pathname.startsWith(href)
  }

  return (
    <nav className="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50">
      {/* Floating pill container */}
      <div className="relative bg-brand-sky/90 backdrop-blur-xl rounded-full shadow-2xl border border-white/30">
        {/* Animated gradient overlay */}
        <div className="absolute inset-0 bg-gradient-to-r from-brand-yellow/20 via-white/10 to-brand-cream/20 rounded-full animate-pulse" />
        
        {/* Navigation content */}
        <div className="relative flex items-center justify-center px-6 py-2 gap-2">
          {navItems.map((item) => {
            if (item.isButton) {
              return (
                <button
                  key={item.name}
                  onClick={item.onClick}
                  className={`
                    flex flex-col items-center gap-1 px-4 py-2 rounded-full transition-all duration-300
                    ${isActive(item.href) 
                      ? 'text-slate-800 bg-brand-yellow/90 scale-110' 
                      : 'text-white/90 hover:text-white hover:bg-white/20 hover:scale-105'
                    }
                  `}
                >
                  <div className="relative">
                    {item.icon}
                    {/* Active indicator */}
                    {isActive(item.href) && (
                      <div className="absolute -top-1 -right-1 w-2 h-2 bg-slate-800 rounded-full animate-pulse" />
                    )}
                  </div>
                  <span className="text-xs font-medium hidden lg:block">
                    {item.name}
                  </span>
                </button>
              )
            } else {
              return (
                <Link
                  key={item.href}
                  href={item.href}
                  className={`
                    flex flex-col items-center gap-1 px-4 py-2 rounded-full transition-all duration-300
                    ${isActive(item.href) 
                      ? 'text-slate-800 bg-brand-yellow/90 scale-110' 
                      : 'text-white/90 hover:text-white hover:bg-white/20 hover:scale-105'
                    }
                  `}
                >
                  <div className="relative">
                    {item.icon}
                    {/* Active indicator */}
                    {isActive(item.href) && (
                      <div className="absolute -top-1 -right-1 w-2 h-2 bg-slate-800 rounded-full animate-pulse" />
                    )}
                  </div>
                  <span className="text-xs font-medium hidden lg:block">
                    {item.name}
                  </span>
                </Link>
              )
            }
          })}
          
          {/* Logout button (only when logged in) */}
          {isLoggedIn && (
            <form action={logout} className="flex flex-col items-center gap-1 px-4 py-2">
              <button
                type="submit"
                className="text-white/90 hover:text-white hover:bg-white/20 hover:scale-105 transition-all duration-300 rounded-full p-2"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
              </button>
              <span className="text-xs font-medium text-white/90 hidden lg:block">
                Logout
              </span>
            </form>
          )}

          {/* Login button (only when logged out) */}
          {!isLoggedIn && (
            <Link
              href="/login"
              className="flex flex-col items-center gap-1 px-4 py-2 rounded-full transition-all duration-300 text-white/90 hover:text-white hover:bg-white/20 hover:scale-105"
            >
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
              </svg>
              <span className="text-xs font-medium hidden lg:block">
                Login
              </span>
            </Link>
          )}
        </div>
      </div>
      
      {/* Chat Modal */}
      <ChatModal isOpen={isChatOpen} onClose={() => setIsChatOpen(false)} />
    </nav>
  )
}
</file>

<file path="src/components/LikeButton.tsx">
'use client'

import { useState } from 'react'
import useLongPress from '@/hooks/useLongPress'
import StatusBadge from './StatusBadge' // <--- Import

interface UserLike {
  userId: string;
  user: {
    id: string;
    firstName: string;
    alias?: string | null;
    profileImage?: string | null;
    status?: string | null; // <--- Added Status
  }
}

interface LikeButtonProps {
  initialLikes: UserLike[];
  currentUserId: string;
  onToggle: () => Promise<void>;
}

export default function LikeButton({ initialLikes = [], currentUserId, onToggle }: LikeButtonProps) {
  const [likes, setLikes] = useState<UserLike[]>(initialLikes)
  const isLikedByMe = likes.some(l => l.userId === currentUserId)
  const [showList, setShowList] = useState(false)

  const handleToggle = async () => {
    if (isLikedByMe) {
      setLikes(prev => prev.filter(l => l.userId !== currentUserId))
    } else {
      setLikes(prev => [...prev, { userId: currentUserId, user: { id: currentUserId, firstName: 'Me', alias: 'Me', profileImage: null } }])
    }
    await onToggle()
  }

  const handleLongPress = () => { if (likes.length > 0) setShowList(true) }
  const longPressProps = useLongPress(handleLongPress, handleToggle, { delay: 500 })

  return (
    <div className="relative inline-block">
      
      {/* BUTTON (Same as before) */}
      <button 
        {...longPressProps}
        className={`flex items-center gap-1.5 transition-all font-bold text-sm select-none ${isLikedByMe ? 'text-pink-500' : 'text-slate-400 active:scale-95 [@media(hover:hover)]:hover:text-slate-600'}`}
      >
        {isLikedByMe ? (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-5 h-5 animate-in zoom-in duration-200 text-pink-500"><path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z" /></svg>
        ) : (
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" /></svg>
        )}
        <span>{likes.length || 'Like'}</span>
      </button>

      {/* POPUP LIST */}
      {showList && (
        <>
          <div className="fixed inset-0 z-40" onClick={(e) => { e.stopPropagation(); setShowList(false) }} />
          <div className="absolute bottom-full left-0 mb-2 w-48 bg-white rounded-lg shadow-xl border border-slate-100 z-50 p-1 animate-in zoom-in-95 duration-150 origin-bottom-left">
            <div className="text-[10px] font-bold text-slate-400 uppercase tracking-wider px-3 py-2 border-b border-slate-50">Liked By</div>
            <div className="max-h-40 overflow-y-auto py-1">
              {likes.map((like) => {
                 const statusEmoji = like.user.status ? Array.from(like.user.status)[0] : null
                 return (
                  <div key={like.userId} className="flex items-center gap-2 px-3 py-1.5 hover:bg-slate-50 rounded-md">
                     <div className="relative">
                       <div className="w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold overflow-hidden bg-brand-pink/20 text-brand-pink shrink-0">
                          {like.user.profileImage ? (
                            <img src={like.user.profileImage} alt="User" className="w-full h-full object-cover" />
                          ) : (
                            (like.user.alias || like.user.firstName)[0]
                          )}
                       </div>

                       {/* ‚úÖ REPLACED MANUAL BADGE WITH COMPONENT (size="small") */}
                     <StatusBadge status={like.user.status} size="small" />
                     </div>
                     <span className="text-xs text-slate-700 truncate font-medium">{like.user.alias || like.user.firstName}</span>
                  </div>
                 )
              })}
            </div>
            <div className="absolute top-full left-4 -mt-[1px] border-8 border-transparent border-t-white" />
          </div>
        </>
      )}
    </div>
  )
}
</file>

<file path="src/components/StatusBadge.tsx">
'use client'

import { useState } from 'react'

export default function StatusBadge({ 
  status, 
  size = 'normal' 
}: { 
  status?: string | null, 
  size?: 'small' | 'normal' | 'large' 
}) {
  const [isExpanded, setIsExpanded] = useState(false)

  if (!status) return null

  // Get first character (emoji)
  const firstChar = Array.from(status)[0]

  // CONFIGURATION
  // We use 'left' positioning here so that expansion naturally flows to the right.
  const sizeClasses = {
    small:  { 
      // Parent is usually w-8 (32px)
      position: '-top-1 left-6', 
      collapsed: 'w-3 h-3 text-[6px]', 
      expanded: 'h-4 text-[8px] px-2' 
    },
    normal: { 
      // Parent is usually w-10 (40px)
      position: '-top-1 left-7', 
      collapsed: 'w-5 h-5 text-[10px]',     
      expanded: 'h-6 text-[10px] px-2.5' 
    },
    large:  { 
      // Parent is usually w-40 (160px)
      position: 'top-1 left-28',          
      collapsed: 'w-10 h-10 text-xl',          
      expanded: 'h-10 text-sm px-5' 
    }
  }

  const current = sizeClasses[size]

  return (
    <div 
      className={`absolute flex items-center justify-center cursor-pointer transition-all duration-300 ease-out z-40 overflow-hidden origin-left
        ${current.position}
        
        /* SHAPE & SIZE TRANSITION */
        ${isExpanded 
          ? `${current.expanded} w-auto rounded-xl shadow-xl border-brand-sky/20` 
          : `${current.collapsed} rounded-full shadow-md border-white/30`
        }

        /* LIQUID GLASS STYLE */
        bg-white/60 backdrop-blur-md border text-slate-900 ring-1 ring-white/40
      `}
      onMouseEnter={() => setIsExpanded(true)}
      onMouseLeave={() => setIsExpanded(false)}
      onClick={(e) => { 
        e.stopPropagation(); 
        setIsExpanded(!isExpanded); 
      }}
    >
      <span className={`leading-none whitespace-nowrap select-none ${isExpanded ? 'font-bold ml-0.5' : ''}`}>
        {isExpanded ? status : firstChar}
      </span>
    </div>
  )
}
</file>

<file path="src/components/TestimonialSection.tsx">
import { getTestimonials } from '@/app/testimonials/actions'
import TestimonialSlider from './TestimonialSlider'

export default async function TestimonialSection() {
  let testimonials = []
  
  try {
    // Fetch up to 9 items so the carousel has content to scroll through
    // (You can adjust the limit in your actions.ts if needed, e.g. take: 9)
    testimonials = await getTestimonials()
  } catch (error) {
    // If database fails, don't show testimonials section
    console.log('Testimonials section disabled due to database connection issue')
    return null
  }

  if (testimonials.length === 0) return null

  return (
    <section className="bg-brand-sky py-20 px-4 relative overflow-hidden">
      
      {/* Background Decoration */}
      <div className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none opacity-20">
        <div className="absolute -top-24 -left-24 w-96 h-96 bg-white rounded-full blur-3xl"></div>
        <div className="absolute top-1/2 right-0 w-64 h-64 bg-brand-pink rounded-full blur-3xl"></div>
      </div>

      <div className="max-w-6xl mx-auto relative z-10">
        <h2 className="text-4xl font-extrabold text-white text-center mb-12 tracking-tight drop-shadow-sm">
          Testimonials
        </h2>

        {/* Client Side Slider */}
        <TestimonialSlider testimonials={testimonials} />
        
      </div>
    </section>
  )
}
</file>

<file path="src/components/WhatsNewSection.tsx">
'use client'

import { getRecentUpdates } from '@/lib/whatsNew'

export default function WhatsNewSection() {
  const recentUpdates = getRecentUpdates(3)

  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'just-released':
        return {
          text: 'Just Released',
          color: 'text-brand-pink',
          bgColor: 'bg-brand-pink'
        }
      case 'recently-updated':
        return {
          text: 'Recently Updated',
          color: 'text-brand-yellow/80',
          bgColor: 'bg-brand-yellow/80'
        }
      case 'coming-soon':
        return {
          text: 'Coming Soon',
          color: 'text-brand-sky',
          bgColor: 'bg-brand-sky'
        }
      default:
        return {
          text: 'New',
          color: 'text-brand-pink',
          bgColor: 'bg-brand-pink'
        }
    }
  }

  return (
    <section className="py-12 px-6 bg-gradient-to-br from-brand-sky/5 to-brand-pink/5 border-t border-slate-200">
      <div className="max-w-4xl mx-auto">
        <div className="text-center mb-8">
          <h2 className="text-2xl font-bold mb-4 text-slate-800 flex items-center justify-center gap-2">
            <span className="relative">
              What&apos;s New
              <span className="absolute -top-1 -right-2 w-2 h-2 bg-brand-pink rounded-full animate-pulse"></span>
            </span>
          </h2>
          <p className="text-slate-600 max-w-2xl mx-auto text-sm">
            Latest updates and features to keep your family connection stronger than ever.
          </p>
        </div>
        
        {recentUpdates.length > 0 ? (
          <div className="grid md:grid-cols-3 gap-4">
            {recentUpdates.map((update) => {
              const statusBadge = getStatusBadge(update.status)
              return (
                <div key={update.id} className="bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-all hover:scale-105 border border-brand-sky/10">
                  <div className="text-2xl mb-3 text-center">
                    <span>{update.icon}</span>
                  </div>
                  <h3 className="font-bold text-base mb-2 text-brand-sky">{update.title}</h3>
                  <p className="text-slate-600 text-xs leading-relaxed">
                    {update.description}
                  </p>
                  <div className="mt-3 flex items-center gap-2 text-xs font-medium">
                    <span className={`w-1.5 h-1.5 ${statusBadge.bgColor} rounded-full animate-pulse`}></span>
                    <span className={statusBadge.color}>{statusBadge.text}</span>
                    {update.version && (
                      <span className="text-slate-400 ml-auto">{update.version}</span>
                    )}
                  </div>
                </div>
              )
            })}
          </div>
        ) : (
          <div className="text-center py-8">
            <p className="text-slate-500">No recent updates to show.</p>
          </div>
        )}
      </div>
    </section>
  )
}
</file>

<file path="src/app/[slug]/page.tsx">
import { PrismaClient } from '@prisma/client'
import { notFound } from 'next/navigation'
import Link from 'next/link'
import StatusBadge from '@/components/StatusBadge'
import FamilyPositionIcon from '@/components/FamilyPositionIcon'

const prisma = new PrismaClient()

export default async function ProfileRoom({ params }: { params: Promise<{ slug: string }> }) {
  const { slug } = await params

  // 1. Validate Route Pattern
  if (!slug.endsWith('s-room')) {
    notFound()
  }

  // 2. Extract Name (e.g. "Idongs-room" -> "Idong")
  const nameQuery = slug.slice(0, -6)

  // 3. Find User
  const user = await prisma.user.findFirst({
    where: {
      OR: [
        { firstName: { equals: nameQuery, mode: 'insensitive' } },
        { alias: { equals: nameQuery, mode: 'insensitive' } }
      ]
    }
  })

  // 4. Handle Not Found
  if (!user) {
    return (
      <main className="min-h-screen flex flex-col items-center justify-center font-sans bg-slate-50 p-4">
        <div className="text-center space-y-2">
          <p className="text-6xl">üö™</p>
          <h1 className="text-2xl font-bold text-slate-800">Room Not Found</h1>
          <p className="text-slate-500">We couldn't find a room for "{nameQuery}".</p>
          <Link href="/family" className="text-brand-sky font-bold hover:underline mt-4 block">
            Return to Directory
          </Link>
        </div>
      </main>
    )
  }

  // 5. Prepare Display Data
  const displayName = user.alias || user.firstName
  const firstLetter = displayName[0].toUpperCase()
  const ADMIN_EMAIL = 'idongesit_essien@ymail.com'
  const isAdmin = user.email.toLowerCase() === ADMIN_EMAIL.toLowerCase()

  return (
    <main className="min-h-screen bg-slate-50 font-sans py-24 px-4 flex justify-center items-start">
      
      {/* CARD CONTAINER */}
      <div className="bg-white w-full max-w-lg rounded-3xl shadow-xl border border-slate-100 animate-in slide-in-from-bottom-4 duration-500 relative">
        
        {/* Navigation Back Link */}
        <div className="absolute top-6 left-6 z-20">
          <Link 
            href="/family" 
            className="flex items-center gap-1 text-slate-400 hover:text-brand-sky transition-colors text-xs font-bold uppercase tracking-wider"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4">
              <path fillRule="evenodd" d="M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z" clipRule="evenodd" />
            </svg>
            Directory
          </Link>
        </div>

        {/* --- SECTION 1: HEADER & IDENTITY --- */}
        <div className="pt-16 pb-8 px-8 flex flex-col items-center text-center relative">
          
          {/* Avatar + Badge */}
          <div className="relative mb-5 group" style={{ paddingRight: '2rem' }}>
            <div className="w-32 h-32 rounded-full flex items-center justify-center text-5xl font-bold shrink-0 overflow-hidden border-4 border-brand-sky/20 shadow-md bg-white text-brand-sky">
              {user.profileImage ? (
                <img src={user.profileImage} alt={user.firstName} className="w-full h-full object-cover" />
              ) : (
                <span>{firstLetter}</span>
              )}
            </div>
            
            {/* Component: Status Badge */}
            <StatusBadge status={user.status} size="large" />
          </div>

          {/* Names */}
          <h1 className="text-3xl font-bold text-slate-800 tracking-tight">
            {user.firstName} {user.lastName}
          </h1>
          {user.alias && (
            <p className="text-slate-400 font-medium text-lg mt-1">@{user.alias}</p>
          )}

          {/* Position & Admin Tag */}
          <div className="mt-3 flex flex-col items-center gap-2">
            <FamilyPositionIcon position={user.position} size="medium" />
            <div className="flex flex-wrap justify-center gap-2">
              {isAdmin && (
              <span className="bg-slate-800 text-brand-yellow px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest border border-slate-600 flex items-center gap-1 shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-3 h-3"><path fillRule="evenodd" d="M10 1a4.5 4.5 0 0 0-4.5 4.5V9H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2h-.5V5.5A4.5 4.5 0 0 0 10 1Zm3 8V5.5a3 3 0 1 0-6 0V9h6Z" clipRule="evenodd" /></svg>
                Admin
              </span>
            )}
            </div>
          </div>

          {/* Status & Location Text */}
          <div className="mt-6 w-full flex flex-col gap-2 items-center">
            {user.location && (
              <div className="flex items-center gap-2 text-slate-500 text-sm font-medium">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4 text-brand-pink shrink-0">
                  <path fillRule="evenodd" d="m9.69 18.933.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 0 0 .281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 1 0 3 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 0 0 2.273 1.765 11.842 11.842 0 0 0 .976.544l.062.029.018.008.006.003ZM10 11.25a2.25 2.25 0 1 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z" clipRule="evenodd" />
                </svg>
                {user.location}
              </div>
            )}
            
            {user.status && (
              <div className="bg-slate-50 px-4 py-2 rounded-full border border-slate-100 inline-flex items-center gap-2 max-w-full">
                <span className="text-lg">üí≠</span>
                <span className="text-slate-600 text-sm font-medium truncate">{user.status}</span>
              </div>
            )}
          </div>
        </div>

        {/* DIVIDER */}
        <div className="h-px w-full bg-slate-100"></div>

        {/* --- SECTION 2: CONTACT DETAILS --- */}
        <div className="px-8 py-6 space-y-4 bg-slate-50/50">
          
          {/* Email */}
          <div className="flex items-center gap-4 p-3 bg-white border border-slate-100 rounded-xl shadow-sm hover:border-brand-sky/30 transition-colors group">
            <div className="w-10 h-10 rounded-full bg-brand-sky/10 text-brand-sky flex items-center justify-center group-hover:scale-110 transition-transform">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path d="M3 4a2 2 0 0 0-2 2v1.161l8.441 4.221a1.25 1.25 0 0 0 1.118 0L19 7.162V6a2 2 0 0 0-2-2H3Z" /><path d="m19 8.839-7.77 3.885a2.75 2.75 0 0 1-2.46 0L1 8.839V14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.839Z" /></svg>
            </div>
            <div className="flex flex-col min-w-0">
              <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Email</span>
              <span className="text-slate-700 font-medium truncate text-sm">{user.email}</span>
            </div>
          </div>

          {/* Phone */}
          <div className="flex items-center gap-4 p-3 bg-white border border-slate-100 rounded-xl shadow-sm hover:border-brand-sky/30 transition-colors group">
            <div className="w-10 h-10 rounded-full bg-brand-sky/10 text-brand-sky flex items-center justify-center group-hover:scale-110 transition-transform">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path fillRule="evenodd" d="M2 3.5A1.5 1.5 0 0 1 3.5 2h1.148a1.5 1.5 0 0 1 1.465 1.175l.716 3.223a1.5 1.5 0 0 1-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 0 0 6.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 0 1 1.767-1.052l3.223.716A1.5 1.5 0 0 1 18 15.352V16.5a1.5 1.5 0 0 1-1.5 1.5H15c-1.149 0-2.263-.15-3.326-.43A13.022 13.022 0 0 1 2.43 8.326 13.019 13.019 0 0 1 2 5V3.5Z" clipRule="evenodd" /></svg>
            </div>
            <div className="flex flex-col min-w-0">
              <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Phone</span>
              <span className="text-slate-700 font-medium truncate text-sm">{user.phone || 'Not provided'}</span>
            </div>
          </div>

        </div>

        {/* --- SECTION 3: BIO --- */}
        <div className="px-8 pb-10 bg-slate-50/50">
          <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
            <h3 className="text-xs font-bold text-slate-400 uppercase mb-3 flex items-center gap-2">
              <span>üëã</span> About Me
            </h3>
            <p className="text-slate-700 text-sm leading-relaxed whitespace-pre-wrap">
              {user.bio || <span className="italic text-slate-400">This family member hasn't written a bio yet.</span>}
            </p>
          </div>
        </div>

      </div>
    </main>
  )
}
</file>

<file path="src/components/TestimonialSlider.tsx">
'use client'

import { useState, useEffect } from 'react'
import StatusBadge from './StatusBadge'
import { deleteTestimonial } from '@/app/testimonials/actions'

export default function TestimonialSlider({ testimonials }: { testimonials: any[] }) {
  const [pageIndex, setPageIndex] = useState(0)
  const [deletingId, setDeletingId] = useState<string | null>(null)
  const ADMIN_EMAIL = 'idongesit_essien@ymail.com'

  const itemsPerPage = 3 
  const totalPages = Math.ceil(testimonials.length / itemsPerPage)

  const handleDelete = async (testimonialId: string) => {
    setDeletingId(testimonialId)
    try {
      const result = await deleteTestimonial(testimonialId)
      if (result.success) {
        // Refresh the page to show updated testimonials
        window.location.reload()
      } else {
        alert(result.message || 'Failed to delete testimonial')
      }
    } catch {
      alert('Error deleting testimonial')
    } finally {
      setDeletingId(null)
    }
  }

  useEffect(() => {
    if (totalPages <= 1) return

    const interval = setInterval(() => {
      setPageIndex((prev) => (prev + 1) % totalPages)
    }, 5000)

    return () => clearInterval(interval)
  }, [totalPages])

  if (!testimonials.length) return null

  return (
    <div className="relative w-full overflow-hidden">
      
      {/* SLIDER TRACK */}
      <div 
        className="flex transition-transform duration-700 ease-in-out"
        style={{ transform: `translateX(-${pageIndex * 100}%)` }}
      >
        {testimonials.map((t) => {
          const isAdmin = t.authorEmail?.toLowerCase() === ADMIN_EMAIL.toLowerCase()
          
          // STATUS LOGIC
          const statusEmoji = t.authorStatus ? Array.from(t.authorStatus)[0] : null

          return (
            <div 
              key={t.id} 
              className="w-full md:w-1/2 lg:w-1/3 flex-shrink-0 px-3"
            >
              <div className="h-full min-h-[250px] p-6 rounded-2xl border border-white/20 bg-white/10 backdrop-blur-md shadow-xl flex flex-col justify-between relative">
                
                {/* Admin Delete Button */}
                {isAdmin && (
                  <button
                    onClick={() => handleDelete(t.id)}
                    disabled={deletingId === t.id}
                    className="absolute top-2 right-2 bg-red-500/80 hover:bg-red-600/80 text-white p-1.5 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                    title="Delete testimonial"
                  >
                    {deletingId === t.id ? (
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-3 w-3 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={2}>
                        <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth={2} fill="none"/>
                        <path d="M12 6v6l4 2" stroke="currentColor" strokeWidth={2} strokeLinecap="round"/>
                      </svg>
                    ) : (
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                        <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                      </svg>
                    )}
                  </button>
                )}

                <p className="text-white/95 text-lg mb-6 leading-relaxed italic font-medium drop-shadow-sm line-clamp-4">
                  "{t.redactedContent}"
                </p>

                <div className="flex items-center gap-3 border-t border-white/20 pt-4 mt-auto">
                  
                  {/* AVATAR + BADGE */}
                  <div className="relative">
                    {t.authorProfileImage ? (
                      <div className="w-10 h-10 rounded-full shrink-0 shadow-lg border-2 border-white/20 overflow-hidden">
                        <img 
                          src={t.authorProfileImage} 
                          alt={t.displayAuthor} 
                          className="w-full h-full object-cover" 
                        />
                      </div>
                    ) : t.displayAvatar ? (
                      <div className="w-10 h-10 bg-brand-pink text-slate-900 font-bold rounded-full flex items-center justify-center shrink-0 shadow-lg border-2 border-white/20">
                        {t.displayAvatar}
                      </div>
                    ) : (
                      <div className="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center shrink-0 text-white/50 border border-white/10">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                          <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                        </svg>
                      </div>
                    )}
                    
                    {/* ‚úÖ REPLACED MANUAL BADGE WITH COMPONENT */}
                    <StatusBadge status={t.authorStatus} size="normal" />
                  </div>
                  
                  <div className="flex flex-col">
                    <div className="flex items-center gap-2">
                      <span className="font-bold text-white tracking-wide text-sm whitespace-nowrap">
                        {t.displayAuthor}
                      </span>
                      {isAdmin && (
                        <span className="bg-slate-700 text-white text-[10px] font-bold px-1.5 py-0.5 rounded border border-slate-500 flex items-center gap-0.5 shadow-sm">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-2.5 h-2.5">
                            <path fillRule="evenodd" d="M10 1a4.5 4.5 0 0 0-4.5 4.5V9H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2h-.5V5.5A4.5 4.5 0 0 0 10 1Zm3 8V5.5a3 3 0 1 0-6 0V9h6Z" clipRule="evenodd" />
                          </svg>
                          Admin
                        </span>
                      )}
                    </div>
                    <span className="text-xs text-blue-100/80 mt-0.5">
                      {new Date(t.createdAt).toLocaleString(undefined, { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' })}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          )
        })}
      </div>

      {/* Dots */}
      <div className="flex justify-center gap-2 mt-8">
        {Array.from({ length: totalPages }).map((_, idx) => (
          <button
            key={idx}
            onClick={() => setPageIndex(idx)}
            className={`w-2 h-2 rounded-full transition-all ${
              idx === pageIndex ? 'bg-white w-4' : 'bg-white/30 hover:bg-white/50'
            }`}
          />
        ))}
      </div>
    </div>
  )
}
</file>

<file path="package.json">
{
  "name": "love-my-fam",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev",
    "build": "prisma generate && next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@heroicons/react": "^2.2.0",
    "@vercel/blob": "^0.0.2",
    "emoji-picker-react": "^4.16.1",
    "next": "16.1.0",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@prisma/client": "^5.22.0",
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "babel-plugin-react-compiler": "1.0.0",
    "eslint": "^9",
    "eslint-config-next": "16.1.0",
    "prisma": "^5.22.0",
    "tailwindcss": "^4",
    "ts-node": "^1.7.1",
    "typescript": "^5"
  },
  "prisma": {
    "seed": "ts-node --compiler-options {\"module\":\"CommonJS\"} prisma/seed.ts"
  }
}
</file>

<file path="src/app/common-room/page.tsx">
import { PrismaClient } from "@prisma/client";
import { cookies } from "next/headers";
import PostInput from "@/components/PostInput";
import PostCard from "@/components/PostCard";
import AnnouncementCarousel from "@/components/AnnouncementCarousel";
import { getFeedData, getAnnouncements } from "./actions";

const prisma = new PrismaClient();

async function getUser() {
  const cookieStore = await cookies()
  const sessionId = cookieStore.get('session_id')?.value
  if (!sessionId) return null

  return await prisma.user.findUnique({
    where: { id: sessionId }
  })
}

export default async function CommonRoom() {
  const user = await getUser()
  const announcements = await getAnnouncements()
  const { urgentPosts, regularPosts } = await getFeedData()

  const welcomeName = user?.alias || user?.firstName || "Family Member";

  return (
    <main className="min-h-screen bg-slate-50 font-sans">
      <div className="max-w-2xl mx-auto p-4 mt-8 pb-20">
        
        {/* HEADER */}
        <div className="flex flex-col md:flex-row justify-between md:items-end mb-6 gap-2">
          <h1 className="text-3xl font-bold text-brand-sky tracking-tight">
            The Common Room
          </h1>
          <h2 className="text-slate-500 font-medium text-sm md:text-lg pb-1 md:text-right">
            Welcome home, <span className="text-brand-pink font-bold">{welcomeName}</span>.
          </h2>
        </div>

        {/* ANNOUNCEMENTS CAROUSEL */}
        <AnnouncementCarousel 
          announcements={announcements} 
          currentUserEmail={user?.email} 
        />

        {/* INPUT FORM */}
        <PostInput />

        {/* FEED */}
        <div className="space-y-6">
          
          {/* 1. URGENT ANNOUNCEMENTS (Pinned at top) */}
          {urgentPosts.map((post) => (
             <PostCard 
              key={post.id} 
              post={post} 
              currentUserId={user?.id || ''}
            />
          ))}

          {/* 2. REGULAR POSTS */}
          {regularPosts.map((post) => (
            <PostCard 
              key={post.id} 
              post={post} 
              currentUserId={user?.id || ''}
            />
          ))}

        </div>
      </div>
    </main>
  );
}
</file>

<file path="src/app/my-room/actions.ts">
'use server'

import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'
import { put } from '@vercel/blob'
import { revalidatePath } from 'next/cache'

const prisma = new PrismaClient()

// --- 1. UPDATE PROFILE PHOTO ---
export async function updateProfilePhoto(formData: FormData) {
  const cookieStore = await cookies()
  const userId = cookieStore.get('session_id')?.value

  if (!userId) return { success: false, message: "Unauthorized" }

  const imageFile = formData.get('file') as File | null

  if (!imageFile || imageFile.size === 0) {
    return { success: false, message: "No image provided" }
  }

  try {
    console.log('Starting upload process...')
    console.log('Image file:', imageFile)
    console.log('Image file name:', imageFile?.name)
    console.log('Image file size:', imageFile?.size)
    console.log('Image file type:', imageFile?.type)
    
    const blob = await put(imageFile.name, imageFile)
    console.log('Blob upload successful:', blob.url)

    await prisma.user.update({
      where: { id: userId },
      data: { profileImage: blob.url }
    })
    
    console.log('Database update successful')

    revalidatePath('/my-room')
    revalidatePath('/common-room')
    revalidatePath('/family')
    revalidatePath('/') 

    return { success: true, url: blob.url }
  } catch (error) {
    console.error("Upload failed:", error)
    console.error("Error type:", typeof error)
    console.error("Error message:", error instanceof Error ? error.message : 'Unknown error')
    console.error("Error stack:", error instanceof Error ? error.stack : 'No stack trace')
    
    // Return more specific error messages
    if (error instanceof Error) {
      if (error.message.includes('ENOENT')) {
        return { success: false, message: "File not found or path error" }
      }
      if (error.message.includes('EACCES')) {
        return { success: false, message: "Permission denied accessing file" }
      }
      if (error.message.includes('blob') || error.message.includes('upload')) {
        return { success: false, message: "Blob storage upload failed - check Vercel configuration" }
      }
      if (error.message.includes('prisma') || error.message.includes('database')) {
        return { success: false, message: "Database update failed" }
      }
    }
    
    return { success: false, message: `Upload failed: ${error instanceof Error ? error.message : 'Unknown error'}` }
  }
}

// --- 2. UPDATE PROFILE DETAILS (Updated with Status) ---
export async function updateProfileDetails(formData: FormData) {
  const cookieStore = await cookies()
  const userId = cookieStore.get('session_id')?.value

  if (!userId) return { success: false, message: "Unauthorized" }

  const bio = formData.get('bio') as string
  const location = formData.get('location') as string
  const alias = formData.get('alias') as string 
  const firstName = formData.get('firstName') as string
  const lastName = formData.get('lastName') as string
  const position = formData.get('position') as string
  const status = formData.get('status') as string // <--- NEW

  if (!firstName || !lastName || !position) {
    return { success: false, message: "Name and Position are required." }
  }

  try {
    await prisma.user.update({
      where: { id: userId },
      data: {
        bio,
        location,
        alias,
        firstName,
        lastName,
        position,
        status // <--- Save Status
      }
    })

    revalidatePath('/my-room')
    revalidatePath('/family') 
    revalidatePath('/common-room')
    
    return { success: true }
  } catch (error) {
    console.error("Update failed:", error)
    return { success: false, message: "Failed to update profile" }
  }
}

// --- 3. UPDATE FAMILY SECRET (Admin Only) ---
export async function updateFamilySecret(newSecret: string) {
  const cookieStore = await cookies()
  const userId = cookieStore.get('session_id')?.value
  const ADMIN_EMAIL = 'idongesit_essien@ymail.com'

  if (!userId) return { success: false, message: "Unauthorized" }

  const user = await prisma.user.findUnique({ where: { id: userId } })
  
  if (user?.email?.toLowerCase() !== ADMIN_EMAIL.toLowerCase()) {
    return { success: false, message: "Only Admin can change the family secret." }
  }

  if (!newSecret || newSecret.trim().length < 4) {
    return { success: false, message: "Secret must be at least 4 characters." }
  }

  // Update or Create the settings row
  await prisma.systemSettings.upsert({
    where: { id: 'global' },
    update: { familySecret: newSecret },
    create: { id: 'global', familySecret: newSecret }
  })

  revalidatePath('/my-room')
  return { success: true }
}
</file>

<file path="src/app/testimonials/actions.ts">
'use server'

import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'
import { revalidatePath } from 'next/cache'

const prisma = new PrismaClient()

async function getCurrentUserId() {
  const cookieStore = await cookies()
  return cookieStore.get('session_id')?.value
}

async function getCurrentUser() {
  const userId = await getCurrentUserId()
  if (!userId) return null
  
  return await prisma.user.findUnique({
    where: { id: userId },
    select: { id: true, email: true, position: true }
  })
}

async function isAdmin() {
  const user = await getCurrentUser()
  return user?.email === 'idongesit_essien@ymail.com'
}

// 1. SUBMIT ACTION
export async function submitTestimonial(content: string) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false, message: "Must be logged in" }
  
  if (!content.trim()) return { success: false, message: "Content empty" }

  await prisma.testimonial.create({
    data: {
      content,
      authorId: userId
    }
  })

  revalidatePath('/') 
  return { success: true }
}

// 3. DELETE TESTIMONIAL ACTION (ADMIN ONLY)
export async function deleteTestimonial(testimonialId: string) {
  const userIsAdmin = await isAdmin()
  if (!userIsAdmin) {
    return { success: false, message: "Unauthorized - Admin access required" }
  }

  try {
    await prisma.testimonial.delete({
      where: { id: testimonialId }
    })
    
    revalidatePath('/')
    return { success: true, message: "Testimonial deleted successfully" }
  } catch (error) {
    console.error('Failed to delete testimonial:', error)
    return { success: false, message: "Failed to delete testimonial" }
  }
}

// 2. SECURE FETCH ACTION
export async function getTestimonials() {
  try {
    const currentUserId = await getCurrentUserId()
    const isGuest = !currentUserId

    const testimonials = await prisma.testimonial.findMany({
      take: 6,
      orderBy: { createdAt: 'desc' },
      include: {
        author: {
          // ‚úÖ ADDED: 'status' to selection
          select: { firstName: true, alias: true, email: true, profileImage: true, status: true } 
        }
      }
    })

  // HELPER: List of sensitive names to redact
  const sensitiveWords = new Set<string>()
  if (isGuest) {
    const allUsers = await prisma.user.findMany({
      select: { firstName: true, alias: true }
    })
    allUsers.forEach(u => {
      if (u.firstName) sensitiveWords.add(u.firstName.toLowerCase())
      if (u.alias) sensitiveWords.add(u.alias.toLowerCase())
    })
  }

  const redactText = (text: string) => {
    const words = text.split(' ')
    return words.map(word => {
      const cleanWord = word.replace(/[^\w]/g, '').toLowerCase()
      if (sensitiveWords.has(cleanWord)) {
        return "Family Member"
      }
      return word
    }).join(' ')
  }

  return testimonials.map(t => {
    // If Guest, we hide email AND profile image AND status
    if (isGuest) {
      return {
        id: t.id,
        content: t.content,
        createdAt: t.createdAt,
        authorEmail: null, 
        authorProfileImage: null, 
        authorStatus: null, // <--- Hide status
        displayAuthor: "Family Member",
        displayAvatar: null,
        redactedContent: redactText(t.content)
      }
    }

    // If Logged In, we show everything
    return {
      id: t.id,
      content: t.content,
      createdAt: t.createdAt,
      authorEmail: t.author.email,
      authorProfileImage: t.author.profileImage,
      authorStatus: t.author.status, // <--- Pass status
      displayAuthor: t.author.alias || t.author.firstName,
      displayAvatar: (t.author.alias || t.author.firstName)[0].toUpperCase(),
      redactedContent: t.content
    }
  })
  } catch (error) {
    console.log('Failed to fetch testimonials:', error)
    return []
  }
}
</file>

<file path="src/components/ChatModal.tsx">
'use client'

import { XMarkIcon } from '@heroicons/react/24/outline'
import { useRouter } from 'next/navigation'
import { useEffect, useState, useRef } from 'react'
import { getChatMessages, sendChatMessage } from '@/app/chat/actions'

export default function ChatModal({ isOpen, onClose }: { isOpen: boolean; onClose: () => void }) {
  const router = useRouter()
  const [joinMessage, setJoinMessage] = useState<string | null>(null)
  const [messages, setMessages] = useState<Array<{
    id: string
    content: string
    author: {
      id: string
      firstName: string
      lastName: string
      alias: string | null
      profileImage: string | null
    }
    createdAt: Date
  }>>([])
  const [inputMessage, setInputMessage] = useState('')
  const [currentUserId, setCurrentUserId] = useState<string | null>(null)
  const [currentUser, setCurrentUser] = useState<any>(null)
  const messagesEndRef = useRef<HTMLDivElement>(null)

  // Fetch current user data
  const fetchCurrentUser = async () => {
    if (currentUserId) {
      try {
        // API should be in root, not in subfolder
        const response = await fetch(`/api/user/${currentUserId}`)
        if (response.ok) {
          const userData = await response.json()
          setCurrentUser(userData)
        }
      } catch (error) {
        console.error('Error fetching user data:', error)
      }
    }
  }

  // Fetch messages from database
  const fetchMessages = async () => {
    const result = await getChatMessages()
    if (result.success && result.messages) {
      setMessages(result.messages)
    }
  }
  
  // Check for join message on mount and when modal opens
  useEffect(() => {
    if (isOpen) {
      const message = document.cookie
        .split('; ')
        .find(row => row.startsWith('new_user_join_message='))
        ?.split('=')[1]
      
      if (message) {
        setJoinMessage(decodeURIComponent(message))
        // Clear the cookie after reading it
        document.cookie = 'new_user_join_message=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;'
      }
      
      // Hardcoded welcome message for Idong (since he joined before this feature)
      if (!message) {
        setJoinMessage("Idong has joined the app! üéâ")
      }

      // Fetch real chat messages
      fetchMessages()
      
      // Get current user ID from session - improved cookie reading
      const getSessionId = () => {
        const cookies = document.cookie.split('; ')
        console.log('All available cookies:', cookies)
        
        // Try different possible cookie names, prioritizing the new user_session
        const possibleNames = ['user_session', 'session_id', 'sessionId', 'session', 'auth_token']
        
        for (const name of possibleNames) {
          const cookie = cookies.find(row => row.startsWith(`${name}=`))
          if (cookie) {
            const value = cookie.split('=')[1]
            console.log(`Found session cookie: ${name} = ${value}`)
            return value
          }
        }
        
        console.log('No session cookie found')
        return null
      }
      
      const sessionId = getSessionId()
      console.log('Session ID found:', sessionId) // Debug log
      
      // Fallback: If no session, try to use a test user ID for debugging
      const userId = sessionId || 'test-user-id'
      setCurrentUserId(userId)
      
      // Fetch current user data
      fetchCurrentUser()
    }
  }, [isOpen, fetchCurrentUser])

  // Poll for new messages every 5 seconds
  useEffect(() => {
    if (!isOpen) return
    
    const interval = setInterval(fetchMessages, 5000)
    return () => clearInterval(interval)
  }, [isOpen])

  // Scroll to bottom when new messages are added
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })
  }, [messages])

  const handleSendMessage = async () => {
    console.log('Attempting to send message:', { inputMessage: inputMessage.trim(), currentUserId })
    
    if (inputMessage.trim() && currentUserId) {
      try {
        const result = await sendChatMessage(inputMessage.trim(), currentUserId)
        if (result.success) {
          setInputMessage('')
          // Refresh messages to include the new one
          fetchMessages()
        } else {
          console.error('Failed to send message:', result.message)
          alert(`Failed to send message: ${result.message}`)
        }
      } catch (error) {
        console.error('Error sending message:', error)
        alert('Error sending message. Please try again.')
      }
    } else {
      if (!currentUserId) {
        console.error('No current user ID found. Available cookies:', document.cookie)
        alert('Please log in to send messages. Session not found.')
      } else if (!inputMessage.trim()) {
        console.log('Empty message, not sending')
      }
    }
  }

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault()
      handleSendMessage()
    }
  }
  
  if (!isOpen) return null

  const formatDate = (date: Date) => {
    const month = String(date.getMonth() + 1).padStart(2, '0')
    const day = String(date.getDate()).padStart(2, '0')
    const year = date.getFullYear()
    return `${month}-${day}-${year}`
  }

  const formatTime = (date: Date) => {
    return date.toLocaleTimeString('en-US', { 
      hour: 'numeric', 
      minute: '2-digit',
      hour12: true 
    })
  }

  const now = new Date()
  const sampleDate1 = new Date(now.getTime() - 2 * 60 * 60 * 1000) // 2 hours ago
  const sampleDate2 = new Date(now.getTime() - 1.5 * 60 * 60 * 1000) // 1.5 hours ago

  // Sample user data (in real app, this would come from user context/database)
  const users = {
    mom: {
      name: 'Sarah Johnson', 
      firstName: 'Sarah',
      alias: 'SuperMom', // User's alias
      profileImage: null,
      initial: 'S',
      color: 'bg-brand-pink'
    },
    dad: {
      name: 'Michael Johnson', 
      firstName: 'Michael',
      alias: 'DadJokes', // User's alias
      profileImage: null,
      initial: 'M',
      color: 'bg-brand-yellow'
    },
    sister: {
      name: 'Emma Johnson', 
      firstName: 'Emma',
      alias: 'Emmy', // User's alias
      profileImage: null,
      initial: 'E',
      color: 'bg-purple-500'
    },
    you: {
      name: 'You',
      firstName: 'You',
      alias: null, // No alias for "You"
      profileImage: null,
      initial: 'Y',
      color: 'bg-brand-sky'
    }
  }

  const getDisplayName = (author: any) => {
    return author.alias || `${author.firstName} ${author.lastName}`
  }

  const renderAvatar = (author: any, size: 'small' | 'medium' = 'small', onClick: () => void = () => {}) => {
    const sizeClasses = size === 'small' ? 'w-8 h-8 text-sm' : 'w-10 h-10 text-base'
    
    if (author.profileImage) {
      return (
        <img 
          src={author.profileImage} 
          alt={author.firstName} 
          className={`${sizeClasses} rounded-full object-cover cursor-pointer`}
          onClick={onClick}
        />
      )
    }
    
    const initial = (author.alias || author.firstName)[0].toUpperCase()
    return (
      <div className={`${sizeClasses} rounded-full bg-brand-sky text-white flex items-center justify-center font-bold cursor-pointer`} onClick={onClick}>
        {initial}
      </div>
    )
  }

  const handleUserClick = (author: any) => {
    // Close modal first
    onClose()
    // Navigate to user's profile (using simple user format)
    const displayName = author.alias || author.firstName
    const user = displayName.toLowerCase().replace(/\s+/g, '-').trim()
    router.push(`/${user}s-room`)
  }

  const renderSystemMessage = (message: string, time: Date) => {
    return (
      <div className="flex justify-center my-4">
        <div className="bg-slate-100 px-3 py-1 rounded-full">
          <p className="text-xs text-slate-500 font-medium">{message}</p>
          <p className="text-[10px] text-slate-400 text-center mt-1">{formatTime(time)}</p>
        </div>
      </div>
    )
  }

  return (
    <div className="fixed inset-0 z-[100] flex">
      {/* Backdrop */}
      <div 
        className="absolute inset-0 bg-white/30 backdrop-blur-md border border-white/40"
        onClick={onClose}
      />
      
      {/* Modal Container - Anchored to bottom navigation */}
      <div className="fixed bottom-20 left-1/2 transform -translate-x-1/2 w-[90vw] max-w-6xl h-[80vh] bg-white rounded-t-3xl shadow-2xl border border-slate-200 flex flex-col animate-in slide-in-from-bottom-4 duration-300">
        
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-slate-200 bg-gradient-to-r from-brand-sky to-brand-pink text-white rounded-t-3xl">
          <div className="flex items-center gap-3">
            <div className="w-3 h-3 bg-white rounded-full animate-pulse"></div>
            <h2 className="text-lg font-bold">Family Chat</h2>
          </div>
          <button
            onClick={onClose}
            className="p-2 hover:bg-white/20 rounded-full transition-colors"
          >
            <XMarkIcon className="w-5 h-5" />
          </button>
        </div>
        
        {/* Chat Messages Area */}
        <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50">
          {/* Welcome Message */}
          <div className="text-center py-8">
            <div className="text-6xl mb-4">üí¨</div>
            <h3 className="text-xl font-bold text-slate-800 mb-2">Welcome to Family Chat</h3>
            <p className="text-slate-600 max-w-md mx-auto">
              Start conversations with your family members. This is a safe space for family discussions.
            </p>
            <p className="text-xs text-slate-400 mt-2">{formatDate(now)} ‚Ä¢ {formatTime(now)}</p>
          </div>
          
          {/* Date Separator */}
          <div className="flex items-center gap-4 my-4">
            <div className="flex-1 h-px bg-slate-300"></div>
            <span className="text-xs text-slate-500 font-medium">{formatDate(sampleDate1)}</span>
            <div className="flex-1 h-px bg-slate-300"></div>
          </div>
          
          {/* Messages */}
          <div className="space-y-3">
            {/* Join Message - Appears when new user registers */}
            {joinMessage && renderSystemMessage(joinMessage, new Date())}
            
            {/* Real Messages */}
            {messages.map((message) => {
              const isCurrentUser = message.author.id === currentUserId
              return (
                <div key={message.id} className={`flex gap-3 ${isCurrentUser ? 'justify-end' : ''}`}>
                  {!isCurrentUser && renderAvatar(message.author, 'small', () => handleUserClick(message.author))}
                  <div className={`flex-1 ${isCurrentUser ? 'max-w-xs' : ''}`}>
                    <div className={`${isCurrentUser ? 'bg-brand-sky text-white' : 'bg-white text-slate-700'} p-3 rounded-2xl shadow-sm`}>
                      <p className="text-sm">{message.content}</p>
                    </div>
                    <div className={`flex items-center gap-2 mt-1 px-2 ${isCurrentUser ? 'justify-end' : ''}`}>
                      <button 
                        onClick={() => handleUserClick(message.author)}
                        className={`text-xs font-medium hover:text-brand-pink transition-colors cursor-pointer ${isCurrentUser ? 'text-brand-sky/80' : 'text-slate-400'}`}
                      >
                        {getDisplayName(message.author)}
                      </button>
                      <span className={`text-xs ${isCurrentUser ? 'text-brand-sky/60' : 'text-slate-300'}`}>‚Ä¢</span>
                      <p className={`text-xs ${isCurrentUser ? 'text-brand-sky/80' : 'text-slate-400'}`}>{formatTime(message.createdAt)}</p>
                    </div>
                  </div>
                  {isCurrentUser && renderAvatar(message.author, 'small', () => handleUserClick(message.author))}
                </div>
              )
            })}
            <div ref={messagesEndRef} />
          </div>
        </div>
        
        {/* Message Input */}
        <div className="p-4 border-t border-slate-200 bg-white">
          <div className="flex gap-2 items-start">
            <div className="transform -translate-y-0">
              {currentUser ? renderAvatar(currentUser, 'medium', () => handleUserClick(currentUser)) : renderAvatar(users.you, 'medium')}
            </div>
            <div className="flex-1">
              <div className="relative">
                <input
                  type="text"
                  placeholder="Type a message..."
                  value={inputMessage}
                  onChange={(e) => setInputMessage(e.target.value)}
                  onKeyUp={handleKeyPress}
                  className="w-full px-4 py-3 pr-12 bg-slate-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-brand-sky"
                />
                <button 
                  onClick={handleSendMessage}
                  className="absolute right-1 top-1/2 transform -translate-y-1/2 w-8 h-8 flex items-center justify-center hover:bg-slate-100 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled={!inputMessage.trim() || !currentUserId}
                >
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-6 h-6 text-brand-sky">
                    <path strokeLinecap="round" strokeLinejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.771 59.771 0 013.27 20.876L5.999 12zm0 0h7.5" />
                  </svg>
                </button>
              </div>
              <p className="text-xs text-slate-400 mt-2 text-center">{formatDate(now)} ‚Ä¢ {formatTime(now)}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/app/family/page.tsx">
import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'
import Link from 'next/link'
import StatusBadge from '@/components/StatusBadge' // <--- Import
import FamilyPositionIcon from '@/components/FamilyPositionIcon' // <--- Import FamilyPositionIcon

const prisma = new PrismaClient()

async function getUsers(positionFilter?: string) {
  const whereClause = positionFilter ? { position: positionFilter } : {}
  
  return await prisma.user.findMany({
    where: whereClause,
    orderBy: { createdAt: 'asc' },
    // ‚úÖ Make sure to select 'status'
    select: { 
      id: true, 
      firstName: true, 
      lastName: true, 
      alias: true, 
      position: true, 
      profileImage: true, 
      email: true,
      status: true // <--- FETCHING STATUS
    }
  })
}

export default async function FamilyDirectory({ searchParams }: { searchParams: { position?: string } }) {
  const positionFilter = searchParams.position
  const users = await getUsers(positionFilter)
  const cookieStore = await cookies()
  const currentUserEmail = 'idongesit_essien@ymail.com' // Admin check
  
  // Find current user's session to determine if they are admin (optional logic)
  const sessionId = cookieStore.get('session_id')?.value
  const currentUser = users.find(u => u.id === sessionId)
  const isAdmin = currentUser?.email === currentUserEmail

  return (
    <main className="min-h-screen bg-slate-50 font-sans p-8">
      <div className="max-w-6xl mx-auto mt-8">
        
        <div className="flex justify-between items-end mb-8">
          <div>
            <h1 className="text-3xl font-bold text-brand-sky">
              Family Directory
              {positionFilter && (
                <span className="text-lg font-normal text-slate-500 ml-2">
                  - {positionFilter}
                </span>
              )}
            </h1>
            <p className="text-slate-500">
              {positionFilter 
                ? `Showing ${users.length} family member${users.length !== 1 ? 's' : ''} with position "${positionFilter}"`
                : 'Meet the fam.'
              }
            </p>
            {positionFilter && (
              <Link 
                href="/family" 
                className="inline-flex items-center gap-1 text-sm text-brand-pink hover:text-brand-sky transition-colors mt-2"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
                Clear filter
              </Link>
            )}
          </div>
          <Link href="/common-room" className="text-sm font-bold text-slate-400 hover:text-brand-pink transition-colors">
            &larr; Back to Common Room
          </Link>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {users.map((user) => (
            <div key={user.id} className={`bg-white p-6 rounded-2xl shadow-sm border flex items-center gap-4 hover:shadow-md transition-shadow relative group ${isAdmin && user.email === currentUserEmail ? 'border-brand-sky/30 bg-brand-sky/5' : 'border-slate-100'}`}>
              
              {/* AVATAR + STATUS */}
              <div className="relative">
                <Link href={`/${user.firstName.toLowerCase()}s-room`} className="block">
                  <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold shrink-0 overflow-hidden hover:opacity-80 transition-opacity ${!user.profileImage ? 'bg-brand-sky/20 text-brand-sky' : ''}`}>
                    {user.profileImage ? (
                      <img src={user.profileImage} alt={user.firstName} className="w-full h-full object-cover" />
                    ) : (
                      (user.alias || user.firstName)[0].toUpperCase()
                    )}
                  </div>
                </Link>
                
                {/* STATUS BADGE - Top Left-Right */}
                <div className="absolute top-0 left-3">
                  <StatusBadge status={user.status} size="normal" />
                </div>
              </div>

              {/* INFO */}
              <div className="flex flex-col min-w-0">
                <div className="flex items-center gap-2">
                  <Link href={`/${user.firstName.toLowerCase()}s-room`} className="font-bold text-slate-800 text-lg truncate hover:text-brand-pink transition-colors">
                    {user.firstName} {user.lastName}
                  </Link>
                  {user.id === sessionId && (
                    <span className="text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-bold">YOU</span>
                  )}
                </div>
                
                {user.alias && (
                  <Link href={`/${user.firstName.toLowerCase()}s-room`} className="text-sm text-slate-400 font-medium truncate hover:text-brand-pink transition-colors">
                    @{user.alias}
                  </Link>
                )}
                
                <div className="mt-1">
                  <FamilyPositionIcon position={user.position} size="small" />
                </div>
              </div>

            </div>
          ))}
        </div>

      </div>
    </main>
  )
}
</file>

<file path="src/app/layout.tsx">
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import Navbar from "@/components/Navbar";
import AutoLogout from "@/components/AutoLogout";
import FeedbackSection from "@/components/FeedbackSection";
import FeedbackWidget from "@/components/FeedbackWidget";
import WhatsNewSection from "@/components/WhatsNewSection";
import { cookies } from "next/headers";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "LoveMyFam",
  description: "A safe space for family.",
  colorScheme: "light",
  themeColor: [
    { media: "(prefers-color-scheme: light)", color: "#ffffff" },
    { media: "(prefers-color-scheme: dark)", color: "#ffffff" }
  ],
};

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  // Check Login Status (Used ONLY for AutoLogout visibility now)
  const cookieStore = await cookies()
  const isLoggedIn = cookieStore.has('session_id')

  return (
    <html lang="en">
      <body className={`${geistSans.variable} ${geistMono.variable} antialiased min-h-screen flex flex-col pb-25`}>
        
        <Navbar />

        {/* Auto Logout Watchdog (Only active if logged in) */}
        {isLoggedIn && <AutoLogout />}
        
        <main className="flex-1 pt-12"> 
          {children}
        </main>

        {/* 1. Global Feedback Section (Sits above footer) */}
        {/* We removed 'isLoggedIn' prop to fix the layout bug */}
        <FeedbackSection />

        {/* 2. What's New Section (Sits above footer) */}
        <WhatsNewSection />

        {/* 3. Global Footer */}
        <footer className="bg-slate-800 text-brand-sky py-8 text-center border-t border-slate-700">
          
          {/* Feedback Widget Trigger (Sits inside footer) */}
          <div className="container mx-auto px-4 mb-6 border-b border-slate-700/50 pb-6">
             {/* We removed the 'isLoggedIn' prop here too */}
            <FeedbackWidget />
          </div>

          <p className="font-medium">¬© {new Date().getFullYear()} LoveMyFam.</p>
          <p className="text-sm text-slate-500 mt-2">
            Built with ‚ù§Ô∏è by{' '}
            <a 
              href="https://instagram.com/idongcodes" 
              target="_blank" 
              rel="noopener noreferrer"
              className="underline hover:text-brand-pink transition-colors"
            >
              idongCodes
            </a>
          </p>
        </footer>

      </body>
    </html>
  );
}
</file>

<file path="src/app/common-room/actions.ts">
'use server'

import { PrismaClient } from '@prisma/client'
import { cookies } from 'next/headers'
import { revalidatePath } from 'next/cache'
import { put } from '@vercel/blob'

const prisma = new PrismaClient()

// --- HELPER: GET CURRENT USER ID ---
async function getCurrentUserId() {
  const cookieStore = await cookies()
  return cookieStore.get('session_id')?.value
}

// =======================================================
// 1. POST ACTIONS
// =======================================================

export async function createPost(formData: FormData) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false, message: 'Unauthorized' }

  const content = formData.get('content') as string || ""
  const imageFile = formData.get('file') as File | null 

  const hasText = content.trim().length > 0
  const hasImage = imageFile && imageFile.size > 0

  if (!hasText && !hasImage) {
    return { success: false, message: "Post cannot be empty" }
  }

  let imageUrl = null

  if (hasImage) {
    const blob = await put(imageFile!.name, imageFile!)
    imageUrl = blob.url
  }

  await prisma.post.create({
    data: {
      content,
      imageUrl,
      authorId: userId
    }
  })

  revalidatePath('/common-room')
  return { success: true }
}

export async function deletePost(postId: string) {
  const userId = await getCurrentUserId()
  
  const post = await prisma.post.findUnique({ where: { id: postId } })
  if (!post || post.authorId !== userId) {
    return { success: false, message: 'Unauthorized' }
  }

  await prisma.post.delete({ where: { id: postId } })
  revalidatePath('/common-room')
  return { success: true }
}

// --- UPDATED: EDIT POST (Supports Title/Urgency for Announcements) ---
export async function editPost(
  postId: string, 
  newContent: string, 
  newTitle?: string, 
  newIsUrgent?: boolean
) {
  const userId = await getCurrentUserId()
  const post = await prisma.post.findUnique({ where: { id: postId } })
  
  if (!post || post.authorId !== userId) return { success: false, message: 'Unauthorized' }
  
  const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1000)
  
  // Rule: Regular posts have a 10-minute edit limit. Announcements (Admin) do not.
  if (!post.isAnnouncement && post.createdAt < tenMinutesAgo) {
      return { success: false, message: 'Edit time limit expired.' }
  }

  // Prepare update data
  const data: any = { content: newContent, isEdited: true }
  
  // Only update title/urgent if provided (for announcements)
  if (newTitle !== undefined) data.title = newTitle
  if (newIsUrgent !== undefined) data.isUrgent = newIsUrgent

  await prisma.post.update({
    where: { id: postId },
    data
  })

  revalidatePath('/common-room')
  return { success: true }
}

export async function toggleLike(postId: string) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false, message: "Unauthorized" }

  const existingLike = await prisma.like.findUnique({
    where: {
      userId_postId: {
        userId,
        postId
      }
    }
  })

  if (existingLike) {
    await prisma.like.delete({ where: { id: existingLike.id } })
  } else {
    await prisma.like.create({ data: { userId, postId } })
  }

  revalidatePath('/common-room')
  return { success: true }
}

// =======================================================
// 2. COMMENT ACTIONS
// =======================================================

export async function addComment(postId: string, content: string, parentId?: string) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false, message: "Unauthorized" }

  if (!content || content.trim().length === 0) return { success: false }

  await prisma.comment.create({
    data: {
      content,
      postId,
      authorId: userId,
      parentId: parentId || null
    }
  })

  revalidatePath('/common-room')
  return { success: true }
}

export async function toggleCommentLike(commentId: string) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false, message: "Unauthorized" }

  const existingLike = await prisma.commentLike.findUnique({
    where: {
      userId_commentId: {
        userId,
        commentId
      }
    }
  })

  if (existingLike) {
    await prisma.commentLike.delete({ where: { id: existingLike.id } })
  } else {
    await prisma.commentLike.create({ data: { userId, commentId } })
  }

  revalidatePath('/common-room')
  return { success: true }
}

export async function deleteComment(commentId: string) {
  const userId = await getCurrentUserId()
  
  const comment = await prisma.comment.findUnique({ where: { id: commentId } })
  if (!comment || comment.authorId !== userId) {
    return { success: false, message: 'Unauthorized' }
  }

  await prisma.comment.delete({ where: { id: commentId } })
  revalidatePath('/common-room')
  return { success: true }
}

export async function editComment(commentId: string, newContent: string) {
  const userId = await getCurrentUserId()
  const comment = await prisma.comment.findUnique({ where: { id: commentId } })
  
  if (!comment || comment.authorId !== userId) return { success: false, message: 'Unauthorized' }
  if (comment.isEdited) return { success: false, message: 'Comment can only be edited once.' }

  const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1000)
  if (comment.createdAt < tenMinutesAgo) return { success: false, message: 'Edit time limit expired.' }

  await prisma.comment.update({
    where: { id: commentId },
    data: { content: newContent, isEdited: true }
  })

  revalidatePath('/common-room')
  return { success: true }
}

// =======================================================
// 3. ANNOUNCEMENT ACTIONS
// =======================================================

export async function createAnnouncement(formData: FormData) {
  const userId = await getCurrentUserId()
  const ADMIN_EMAIL = 'idongesit_essien@ymail.com'

  const user = await prisma.user.findUnique({ where: { id: userId } })
  if (user?.email !== ADMIN_EMAIL) {
    return { success: false, message: "Only Admin can post announcements." }
  }

  const title = formData.get('title') as string
  const message = formData.get('message') as string
  const isUrgent = formData.get('isUrgent') === 'true'

  if (!message || !title) return { success: false, message: "Title and Message are required." }

  await prisma.post.create({
    data: {
      title,
      content: message,
      authorId: userId!,
      isAnnouncement: true,
      isUrgent: isUrgent
    }
  })

  revalidatePath('/common-room')
  return { success: true }
}

export async function dismissAnnouncement(postId: string) {
  const userId = await getCurrentUserId()
  if (!userId) return { success: false }

  await prisma.postDismissal.create({
    data: {
      userId,
      postId
    }
  })

  revalidatePath('/common-room')
  return { success: true }
}

export async function getAnnouncements() {
  return await prisma.post.findMany({
    where: { isAnnouncement: true },
    orderBy: { createdAt: 'desc' },
    take: 5
  })
}

// =======================================================
// 4. FEED FETCHING (Split Urgent vs Regular)
// =======================================================

export async function getFeedData() {
  const userId = await getCurrentUserId()
  
  // 1. Get Urgent Announcements (Not dismissed by me)
  const urgentPosts = await prisma.post.findMany({
    where: {
      isAnnouncement: true,
      isUrgent: true,
      dismissals: {
        none: { userId: userId } 
      }
    },
    include: {
      author: true,
      likes: { include: { user: true } },
      comments: { include: { author: true, likes: true, children: true } }
    },
    orderBy: { createdAt: 'desc' }
  })

  // 2. Get Regular Posts (Not announcements)
  const regularPosts = await prisma.post.findMany({
    where: {
      isAnnouncement: false
    },
    include: {
      author: true,
      likes: { include: { user: true } },
      comments: { include: { author: true, likes: true, children: true } }
    },
    orderBy: { createdAt: 'desc' }
  })

  // Helper to map data structure for frontend
  const mapPost = (p: any) => ({
    ...p,
    likeCount: p.likes.length,
    isLikedByMe: userId ? p.likes.some((l: any) => l.userId === userId) : false,
    topLevelComments: p.comments.filter((c: any) => !c.parentId)
  })

  return {
    urgentPosts: urgentPosts.map(mapPost),
    regularPosts: regularPosts.map(mapPost),
    currentUserId: userId
  }
}
</file>

<file path="prisma/schema.prisma">
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model User {
  id           String          @id @default(cuid())
  firstName    String
  lastName     String
  alias        String?
  position     String
  email        String          @unique
  phone        String?
  profileImage String?
  bio          String?
  location     String?
  status       String?
  createdAt    DateTime        @default(now())
  chatMessages ChatMessage[]   @relation("UserChatMessages")
  comments     Comment[]
  commentLikes CommentLike[]
  likes        Like[]
  posts        Post[]          @relation("UserPosts")
  dismissals   PostDismissal[]
  Testimonial  Testimonial[]
}

model Post {
  id             String          @id @default(cuid())
  content        String
  imageUrl       String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  isEdited       Boolean         @default(false)
  title          String?
  isAnnouncement Boolean         @default(false)
  isUrgent       Boolean         @default(false)
  authorId       String
  comments       Comment[]
  likes          Like[]
  author         User            @relation("UserPosts", fields: [authorId], references: [id])
  dismissals     PostDismissal[]
}

model Like {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  userId    String
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
}

model Comment {
  id        String        @id @default(cuid())
  content   String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @default(now()) @updatedAt
  isEdited  Boolean       @default(false)
  postId    String
  authorId  String
  parentId  String?
  author    User          @relation(fields: [authorId], references: [id])
  parent    Comment?      @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  children  Comment[]     @relation("CommentReplies")
  post      Post          @relation(fields: [postId], references: [id], onDelete: Cascade)
  likes     CommentLike[]
}

model CommentLike {
  id        String  @id @default(cuid())
  userId    String
  commentId String
  comment   Comment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, commentId])
}

model Testimonial {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
}

model PostDismissal {
  id     String @id @default(cuid())
  userId String
  postId String
  post   Post   @relation(fields: [postId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
}

model ChatMessage {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  authorId  String
  author    User     @relation("UserChatMessages", fields: [authorId], references: [id])
}

model SystemSettings {
  id           String @id @default("global")
  familySecret String @default("familyfirst")
}
</file>

<file path="src/lib/whatsNew.ts">
export interface UpdateItem {
  id: string
  title: string
  description: string
  icon: string
  category: 'feature' | 'fix' | 'update'
  status: 'just-released' | 'recently-updated' | 'coming-soon'
  date: Date
  version?: string
}

export const whatsNewData: UpdateItem[] = [
                {
    id: 'removed-extra-braces',
    title: 'Removed Extra Braces',
    description: 'Removed Extra Braces',
    icon: '‚ú®',
    category: 'feature',
    status: 'just-released',
    date: new Date('2026-01-21T16:22:25.128Z'),
    version: '0.1.0'
  },
  {
    id: 'auto-updating-whatsnew-section-based-on-commits',
    title: 'Auto-updating WhatsNew section based on  commits',
    description: 'Add auto-updating WhatsNew section based on  commits',
    icon: 'üöÄ',
    category: 'feature',
    status: 'just-released',
    date: new Date('2026-01-21T13:34:49.032Z'),
    version: '0.1.0'
  },
  {
    id: 'login-button-to-navigation-for-logged-out-users',
    title: 'Login button to navigation for logged out users',
    description: 'Improvements to the login experience for better security and convenience.',
    icon: 'üöÄ',
    category: 'feature',
    status: 'just-released',
    date: new Date('2026-01-21T13:33:42.856Z'),
    version: '0.1.0'
  },
  {
    id: 'whats-new-dynamic',
    title: 'Dynamic What\'s New',
    description: 'The What\'s New section now automatically updates whenever new features, fixes, or improvements are added to the app.',
    icon: 'üîÑ',
    category: 'feature',
    status: 'just-released',
    date: new Date('2025-01-18'),
    version: 'v4.6'
  },
  {
    id: 'modern-navigation',
    title: 'Modern Navigation',
    description: 'Our new floating pill navigation makes getting around easier than ever. Clean, intuitive, and always at your fingertips.',
    icon: 'üß≠',
    category: 'feature',
    status: 'just-released',
    date: new Date('2025-01-18'),
    version: 'v4.5'
  },
  {
    id: 'my-mirror',
    title: 'My Mirror',
    description: 'See yourself through family\'s eyes. The new My Mirror tab shows exactly how others see your profile.',
    icon: 'ü™û',
    category: 'feature',
    status: 'just-released',
    date: new Date('2025-01-18'),
    version: 'v4.5'
  },
  {
    id: 'enhanced-profiles',
    title: 'Enhanced Profiles',
    description: 'Better position display with interactive tooltips. Cleaner, more intuitive family member information.',
    icon: 'üë§',
    category: 'update',
    status: 'recently-updated',
    date: new Date('2025-01-18'),
    version: 'v4.5'
  }
]

// Helper functions for managing updates
export function addUpdate(update: Omit<UpdateItem, 'id'>): UpdateItem {
  const newUpdate: UpdateItem = {
    ...update,
    id: update.title.toLowerCase().replace(/\s+/g, '-')
  }
  whatsNewData.unshift(newUpdate)
  return newUpdate
}

export function getRecentUpdates(limit: number = 3): UpdateItem[] {
  return whatsNewData
    .sort((a, b) => b.date.getTime() - a.date.getTime())
    .slice(0, limit)
}

export function getUpdatesByCategory(category: UpdateItem['category']): UpdateItem[] {
  return whatsNewData
    .filter(update => update.category === category)
    .sort((a, b) => b.date.getTime() - a.date.getTime())
}

export function getUpdatesByStatus(status: UpdateItem['status']): UpdateItem[] {
  return whatsNewData
    .filter(update => update.status === status)
    .sort((a, b) => b.date.getTime() - a.date.getTime())
}
</file>

<file path="src/components/CommentItem.tsx">
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { addComment, toggleCommentLike, deleteComment, editComment } from '@/app/common-room/actions'
import LikeButton from './LikeButton'
import EmojiButton from './EmojiButton'
import StatusBadge from './StatusBadge'

export default function CommentItem({ comment, currentUserId, postId }: { comment: any, currentUserId: string, postId: string }) {
  const router = useRouter()
  const [isReplying, setIsReplying] = useState(false)
  const [replyText, setReplyText] = useState('')
  const [isEditing, setIsEditing] = useState(false)
  const [editContent, setEditContent] = useState(comment.content)

  const isAuthor = currentUserId === comment.authorId
  
  // Status Logic
  const statusEmoji = comment.author?.status ? Array.from(comment.author.status)[0] : null
  
  const displayName = comment.author?.alias || comment.author?.firstName || 'Family Member'
  const firstLetter = displayName[0]?.toUpperCase() || '?'
  const profileImage = comment.author?.profileImage

  const handleAuthorClick = () => {
    if (comment.author?.firstName) {
      router.push(`/${comment.author.firstName.toLowerCase()}s-room`)
    }
  }

  async function handleReplySubmit(e: React.FormEvent) {
    e.preventDefault(); if(!replyText.trim()) return; await addComment(postId, replyText, comment.id); setReplyText(''); setIsReplying(false);
  }
  async function handleEditSubmit(e: React.FormEvent) {
    e.preventDefault(); if(!editContent.trim()) return; const res = await editComment(comment.id, editContent); if(res.success) setIsEditing(false);
  }
  async function handleDelete() { if(confirm('Delete comment?')) await deleteComment(comment.id) }

  return (
    <div className="flex gap-3 mt-4 w-full group">
      {/* AVATAR + STATUS BADGE */}
      <div className="relative shrink-0">
        <button 
          onClick={handleAuthorClick}
          className="w-8 h-8 rounded-full flex items-center justify-center overflow-hidden bg-brand-sky/20 text-brand-sky font-bold text-xs hover:opacity-80 transition-opacity"
        >
          {profileImage ? (
             <img src={profileImage} alt={displayName} className="w-full h-full object-cover" />
          ) : (
             <span>{firstLetter}</span>
          )}
        </button>
        
        <StatusBadge status={comment.author?.status} size="small" />
      </div>

      <div className="flex-1">
        {/* Content Bubble */}
        <div className="bg-slate-50 p-3 rounded-2xl rounded-tl-none border border-slate-100 relative">
           <div className="flex justify-between items-start mb-1">
             <button 
               onClick={handleAuthorClick}
               className="text-xs font-bold text-slate-700 hover:text-brand-pink transition-colors"
             >
               {displayName}
             </button>
             <span className="text-[10px] text-slate-400">{new Date(comment.createdAt).toLocaleDateString()}</span>
           </div>
           
           {isEditing ? (
             <form onSubmit={handleEditSubmit}>
                <input value={editContent} onChange={e => setEditContent(e.target.value)} className="w-full p-2 text-xs border rounded mb-2"/>
                <div className="flex gap-2 text-[10px]">
                  <button type="button" onClick={() => setIsEditing(false)} className="text-slate-400">Cancel</button>
                  <button type="submit" className="text-brand-sky font-bold">Save</button>
                </div>
             </form>
           ) : (
             <p className="text-sm text-slate-600 leading-snug">{comment.content}</p>
           )}
        </div>

        {/* Action Bar */}
        <div className="flex items-center gap-4 mt-1 pl-2">
          {/* Like Button */}
          <div className="scale-75 origin-left">
            <LikeButton 
              initialLikes={comment.likes} 
              currentUserId={currentUserId} 
              // ‚úÖ FIXED: Wrapped in braces { } to ensure return type is void
              onToggle={async () => { await toggleCommentLike(comment.id) }} 
            />
          </div>
          
          <button onClick={() => setIsReplying(!isReplying)} className="text-xs font-bold text-slate-400 hover:text-brand-sky">Reply</button>
          
          {isAuthor && (
            <>
              <button onClick={() => setIsEditing(!isEditing)} className="text-xs text-slate-400 hover:text-slate-600">Edit</button>
              <button onClick={handleDelete} className="text-xs text-slate-400 hover:text-red-500">Delete</button>
            </>
          )}
        </div>

        {/* Reply Input */}
        {isReplying && (
          <form onSubmit={handleReplySubmit} className="mt-2 flex gap-2">
            <div className="relative flex-1">
              <input autoFocus value={replyText} onChange={(e) => setReplyText(e.target.value)} className="w-full text-xs p-2 border rounded-lg pr-8" placeholder="Write a reply..."/>
               <div className="absolute right-1 top-1/2 -translate-y-1/2"><EmojiButton onEmojiSelect={(emoji) => setReplyText(p => p + emoji)} /></div>
            </div>
            <button type="submit" disabled={!replyText.trim()} className="text-xs bg-brand-sky text-white px-3 py-1 rounded-lg">Reply</button>
          </form>
        )}

        {/* Nested Comments */}
        {comment.children && comment.children.length > 0 && (
          <div className="mt-2 border-l-2 border-slate-100 pl-3">
            {comment.children.map((child: any) => (
              <CommentItem key={child.id} comment={child} currentUserId={currentUserId} postId={postId}/>
            ))}
          </div>
        )}
      </div>
    </div>
  )
}
</file>

<file path="src/components/MyRoomClient.tsx">
'use client'

import { useState, useRef, useEffect } from 'react'
import { updateProfilePhoto, updateProfileDetails, updateFamilySecret } from '@/app/my-room/actions'
import { useRouter } from 'next/navigation'
import Link from 'next/link' // <--- 1. Import Link
import EmojiButton from './EmojiButton'
import StatusBadge from './StatusBadge'
import FamilyPositionIcon from './FamilyPositionIcon'

export default function MyRoomClient({ user, familySecret }: { user: any, familySecret: string }) {
  const router = useRouter()
  const [activeTab, setActiveTab] = useState('dashboard')
  
  // --- PHOTO STATE ---
  const [profileImage, setProfileImage] = useState<File | null>(null)
  const [previewUrl, setPreviewUrl] = useState<string | null>(user?.profileImage || null)
  const [isSavingPhoto, setIsSavingPhoto] = useState(false)
  const selfieInputRef = useRef<HTMLInputElement>(null)
  const galleryInputRef = useRef<HTMLInputElement>(null)

  // --- PROFILE DETAILS STATE ---
  const [isEditingDetails, setIsEditingDetails] = useState(false)
  const [isSavingDetails, setIsSavingDetails] = useState(false)
  
  // Form Fields
  const [firstName, setFirstName] = useState<string>(user.firstName || '')
  const [lastName, setLastName] = useState<string>(user.lastName || '')
  const [position, setPosition] = useState<string>(user.position || '')
  const [bio, setBio] = useState<string>(user.bio || '')
  const [location, setLocation] = useState<string>(user.location || '')
  const [alias, setAlias] = useState<string>(user.alias || '')
  const [status, setStatus] = useState<string>(user.status || '') 

  // --- SECRET EDIT STATE ---
  const [isEditingSecret, setIsEditingSecret] = useState(false)
  const [secretInput, setSecretInput] = useState(familySecret)
  const [isSavingSecret, setIsSavingSecret] = useState(false)

  // Sync state if user prop updates
  useEffect(() => {
    setFirstName(user.firstName || '')
    setLastName(user.lastName || '')
    setPosition(user.position || '')
    setBio(user.bio || '')
    setLocation(user.location || '')
    setAlias(user.alias || '')
    setStatus(user.status || '')
    setSecretInput(familySecret)
  }, [user, familySecret])

  const ADMIN_EMAIL = 'idongesit_essien@ymail.com'
  const isAdmin = user?.email?.toLowerCase() === ADMIN_EMAIL.toLowerCase()

  // --- HANDLERS ---
  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (file) {
      setProfileImage(file)
      setPreviewUrl(URL.createObjectURL(file))
    }
  }

  const handleSavePhoto = async () => {
    if (!profileImage) return
    setIsSavingPhoto(true)
    const formData = new FormData()
    formData.append('file', profileImage)
    const result = await updateProfilePhoto(formData)
    setIsSavingPhoto(false)
    if (result.success) {
      alert("Profile photo updated.")
      setProfileImage(null)
      router.refresh()
    } else {
      alert(result.message)
    }
  }

  const handleCancelPhoto = () => {
    setProfileImage(null)
    setPreviewUrl(user?.profileImage || null)
  }

  const handleSaveDetails = async () => {
    setIsSavingDetails(true)
    const formData = new FormData()
    formData.append('firstName', firstName)
    formData.append('lastName', lastName)
    formData.append('position', position)
    formData.append('bio', bio)
    formData.append('location', location)
    formData.append('alias', alias)
    formData.append('status', status) 

    const result = await updateProfileDetails(formData)
    setIsSavingDetails(false)

    if (result.success) {
      setIsEditingDetails(false)
      router.refresh()
    } else {
      alert(result.message)
    }
  }

  const handleEmojiSelect = (emoji: string) => {
    setStatus((prev: string) => prev + emoji)
  }

  const handleSaveSecret = async () => {
    if (!secretInput.trim()) return
    setIsSavingSecret(true)
    const result = await updateFamilySecret(secretInput)
    setIsSavingSecret(false)

    if (result.success) {
      setIsEditingSecret(false)
      alert("Family Secret Updated! Everyone must use this new code to login.")
      router.refresh()
    } else {
      alert(result.message)
    }
  }

  // Calculate the profile slug based on SAVED user data (to ensure link works)
  const profileSlug = (user.alias || user.firstName).trim()

  return (
    <div className="max-w-4xl mx-auto mt-8">
      <h1 className="text-3xl font-bold text-brand-sky mb-8 text-center md:text-left">
        My Room
      </h1>

      {/* 1. PROFILE PHOTO CARD */}
      <section className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 mb-6 flex flex-col md:flex-row items-center gap-10 animate-in slide-in-from-top-4 relative">
        
        {/* --- NEW: PUBLIC PROFILE LINK (Top Right) --- */}
        <div className="absolute top-6 right-6 z-10">
          <Link 
            href={`/${profileSlug}s-room`} 
            className="text-xs font-bold text-brand-sky hover:text-sky-600 flex items-center gap-1 transition-colors"
          >
            Public Profile 
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-3 h-3">
              <path fillRule="evenodd" d="M3 10a.75.75 0 0 1 .75-.75h10.638L10.23 5.29a.75.75 0 1 1 1.04-1.08l5.5 5.25a.75.75 0 0 1 0 1.08l-5.5 5.25a.75.75 0 1 1-1.04-1.08l4.158-3.96H3.75A.75.75 0 0 1 3 10Z" clipRule="evenodd" />
            </svg>
          </Link>
        </div>

        {/* AVATAR + BUTTONS */}
        <div className="relative group shrink-0">
          <div className="w-40 h-40 rounded-full overflow-hidden border-4 border-brand-sky/20 shadow-md bg-slate-50 flex items-center justify-center relative">
            {previewUrl ? (
              <img src={previewUrl} alt="Profile" className="w-full h-full object-cover" />
            ) : (
              <span className="text-5xl text-brand-sky font-bold">
                {(alias || firstName)?.[0]?.toUpperCase()}
              </span>
            )}
          </div>
          
          <StatusBadge status={status} size="large" />

          <div className="absolute -bottom-2 -right-2 flex gap-2 z-20">
            <button onClick={() => galleryInputRef.current?.click()} className="bg-white text-slate-600 p-2.5 rounded-full shadow-lg hover:scale-110 transition-transform border border-slate-200" title="Upload from Gallery">
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" /></svg>
            </button>
            <button onClick={() => selfieInputRef.current?.click()} className="bg-brand-pink text-slate-900 p-2.5 rounded-full shadow-lg hover:scale-110 transition-transform border-2 border-white" title="Take a Selfie">
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" /><path strokeLinecap="round" strokeLinejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" /></svg>
            </button>
          </div>
        </div>

        {/* DETAILS DISPLAY */}
        <div className="flex-1 text-center md:text-left flex flex-col gap-1">
          {isAdmin && (
            <div className="mb-2">
              <span className="bg-slate-800 text-brand-yellow text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded border border-slate-600 shadow-sm inline-flex items-center gap-1">
                Admin / Developer
              </span>
            </div>
          )}
          
          <h2 className="text-3xl font-bold text-slate-800 tracking-tight">
            {firstName} {lastName}
          </h2>
          
          {alias && <p className="text-brand-sky font-medium">@{alias}</p>}
          <div className="mt-2">
            <FamilyPositionIcon position={position} size="medium" />
          </div>

          {location && (
            <div className="mt-3 flex items-center justify-center md:justify-start gap-1.5 text-slate-500 text-sm font-medium animate-in fade-in">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4 text-brand-pink shrink-0">
                <path fillRule="evenodd" d="M9.69 18.933.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 0 0 .281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 1 0 3 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 0 0 2.273 1.765 11.842 11.842 0 0 0 .976.544l.062.029.018.008.006.003ZM10 11.25a2.25 2.25 0 1 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z" clipRule="evenodd" />
                <path fillRule="evenodd" d="m9.69 18.933.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 0 0 .281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 1 0 3 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 0 0 2.273 1.765 11.842 11.842 0 0 0 .976.544l.062.029.018.008.006.003ZM10 11.25a2.25 2.25 0 1 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z" clipRule="evenodd" />
              </svg>
              {location}
            </div>
          )}

          {status && (
            <div className="mt-2 flex items-center justify-center md:justify-start gap-1.5 text-slate-600 text-sm animate-in fade-in bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100 inline-flex w-fit mx-auto md:mx-0">
               <span className="text-base">üí≠</span>
               <span className="font-medium">{status}</span>
            </div>
          )}

          {profileImage && (
            <div className="mt-6 flex gap-3 justify-center md:justify-start animate-in fade-in slide-in-from-top-2">
              <button onClick={handleSavePhoto} disabled={isSavingPhoto} className="bg-brand-sky text-white px-6 py-2 rounded-full font-bold text-sm hover:bg-sky-500 transition-colors shadow-sm disabled:opacity-50">
                {isSavingPhoto ? 'Saving...' : 'Save New Photo'}
              </button>
              <button onClick={handleCancelPhoto} disabled={isSavingPhoto} className="text-slate-400 hover:text-red-500 text-sm font-medium px-4 py-2">Cancel</button>
            </div>
          )}
        </div>
        
        <input type="file" ref={selfieInputRef} accept="image/*" capture="user" className="hidden" onChange={handleImageChange} />
        <input type="file" ref={galleryInputRef} accept="image/*" className="hidden" onChange={handleImageChange} />
      </section>

      {/* --- 2. ABOUT ME / EDIT DETAILS --- */}
      <section className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 mb-10 animate-in slide-in-from-top-6">
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
            <span>üëã</span> About Me
          </h2>
          {!isEditingDetails && (
            <button 
              onClick={() => setIsEditingDetails(true)}
              className="text-brand-sky text-sm font-bold hover:underline"
            >
              Edit Details
            </button>
          )}
        </div>

        {isEditingDetails ? (
          <div className="flex flex-col gap-5">
            <div className="flex gap-4">
               <div className="flex-1">
                 <label className="block text-xs font-bold text-slate-500 mb-1">FIRST NAME</label>
                 <input value={firstName} onChange={(e) => setFirstName(e.target.value)} className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"/>
               </div>
               <div className="flex-1">
                 <label className="block text-xs font-bold text-slate-500 mb-1">LAST NAME</label>
                 <input value={lastName} onChange={(e) => setLastName(e.target.value)} className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"/>
               </div>
            </div>

            <div className="flex flex-col md:flex-row gap-4">
              <div className="flex-1">
                <label className="block text-xs font-bold text-slate-500 mb-1">FAMILY POSITION</label>
                <input value={position} onChange={(e) => setPosition(e.target.value)} placeholder="e.g. Aunt, Cousin" className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"/>
              </div>
              <div className="flex-1">
                <label className="block text-xs font-bold text-slate-500 mb-1">ALIAS (NICKNAME)</label>
                <input value={alias} onChange={(e) => setAlias(e.target.value)} className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"/>
              </div>
            </div>

            <div className="flex flex-col md:flex-row gap-4">
               <div className="flex-1">
                  <label className="block text-xs font-bold text-slate-500 mb-1">CURRENT CITY</label>
                  <input value={location} onChange={(e) => setLocation(e.target.value)} className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"/>
               </div>
               <div className="flex-1">
                  <label className="block text-xs font-bold text-slate-500 mb-1">CURRENT STATUS</label>
                  <div className="relative flex items-center">
                    <div className="absolute left-2 z-10">
                      <EmojiButton onEmojiSelect={handleEmojiSelect} />
                    </div>
                    <input 
                      value={status}
                      onChange={(e) => setStatus(e.target.value)}
                      placeholder="Feeling happy..."
                      className="w-full p-3 pl-12 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50"
                    />
                  </div>
               </div>
            </div>

            <div>
              <label className="block text-xs font-bold text-slate-500 mb-1">BIO</label>
              <textarea value={bio} onChange={(e) => setBio(e.target.value)} rows={4} className="w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-brand-sky outline-none bg-slate-50 resize-none"/>
            </div>

            <div className="flex justify-end gap-2 mt-2">
              <button 
                onClick={() => {
                  setIsEditingDetails(false)
                  setFirstName(user.firstName || '')
                  setLastName(user.lastName || '')
                  setPosition(user.position || '')
                  setBio(user.bio || '')
                  setLocation(user.location || '')
                  setAlias(user.alias || '')
                  setStatus(user.status || '')
                }}
                className="px-4 py-2 text-slate-400 font-bold text-sm hover:text-slate-600"
              >
                Cancel
              </button>
              <button 
                onClick={handleSaveDetails}
                disabled={isSavingDetails}
                className="bg-brand-sky text-white px-6 py-2 rounded-full font-bold text-sm hover:bg-sky-500 transition-colors shadow-sm disabled:opacity-50"
              >
                {isSavingDetails ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        ) : (
          <div className="flex flex-col gap-4 text-slate-600">
            <div className="bg-slate-50 p-6 rounded-xl border border-slate-100 text-lg leading-relaxed text-slate-700">
              {bio ? bio : <span className="italic text-slate-400">Tell the family a bit about yourself...</span>}
            </div>
          </div>
        )}
      </section>

      {/* --- TAB NAVIGATION --- */}
      <div className="flex border-b border-slate-200 mb-8">
        <button onClick={() => setActiveTab('dashboard')} className={`pb-4 px-6 font-bold text-sm transition-all ${activeTab === 'dashboard' ? 'border-b-4 border-brand-sky text-brand-sky' : 'text-slate-400 hover:text-slate-600'}`}>Dashboard</button>
        <button onClick={() => setActiveTab('mirror')} className={`pb-4 px-6 font-bold text-sm transition-all ${activeTab === 'mirror' ? 'border-b-4 border-brand-pink text-brand-pink' : 'text-slate-400 hover:text-slate-600'}`}>My Mirror</button>
      </div>

      {activeTab === 'dashboard' && (
        <div className="grid md:grid-cols-2 gap-6 animate-fade-in">
          
          {/* PRIVATE DETAILS CARD */}
          <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-100">
            <h3 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
              <span>üîê</span> Private Details
            </h3>
            
            <div className="space-y-6">
              {/* Email */}
              <div>
                <label className="block text-xs font-bold text-slate-400 mb-1 uppercase tracking-wider">Email</label>
                <div className="flex items-center gap-3 text-slate-700 bg-slate-50 p-3 rounded-lg border border-slate-100">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5 text-brand-sky"><path d="M3 4a2 2 0 0 0-2 2v1.161l8.441 4.221a1.25 1.25 0 0 0 1.118 0L19 7.162V6a2 2 0 0 0-2-2H3Z" /><path d="m19 8.839-7.77 3.885a2.75 2.75 0 0 1-2.46 0L1 8.839V14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.839Z" /></svg>
                  <span className="font-medium">{user.email}</span>
                </div>
              </div>

              {/* Phone */}
              <div>
                <label className="block text-xs font-bold text-slate-400 mb-1 uppercase tracking-wider">Phone</label>
                <div className="flex items-center gap-3 text-slate-700 bg-slate-50 p-3 rounded-lg border border-slate-100">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5 text-brand-sky"><path fillRule="evenodd" d="M2 3.5A1.5 1.5 0 0 1 3.5 2h1.148a1.5 1.5 0 0 1 1.465 1.175l.716 3.223a1.5 1.5 0 0 1-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 0 0 6.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 0 1 1.767-1.052l3.223.716A1.5 1.5 0 0 1 18 15.352V16.5a1.5 1.5 0 0 1-1.5 1.5H15c-1.149 0-2.263-.15-3.326-.43A13.022 13.022 0 0 1 2.43 8.326 13.019 13.019 0 0 1 2 5V3.5Z" clipRule="evenodd" /></svg>
                  <span className="font-medium">{user.phone || 'Not provided'}</span>
                </div>
              </div>
            </div>
          </div>

          {/* FAMILY SECRET CARD */}
          <div className="bg-brand-sky/10 p-8 rounded-2xl shadow-sm border border-brand-sky/20">
            <div className="flex justify-between items-start mb-4">
              <h3 className="text-xl font-bold text-brand-sky flex items-center gap-2"><span>ü§´</span> Family Secret</h3>
              {isAdmin && !isEditingSecret && (
                <button onClick={() => setIsEditingSecret(true)} className="text-xs bg-white/50 hover:bg-white text-brand-sky font-bold px-3 py-1 rounded-full transition-colors border border-brand-sky/20">
                  Edit
                </button>
              )}
            </div>

            <p className="text-slate-600 text-sm mb-6 leading-relaxed">
              This is the password used to register new family members.
            </p>
            
            {isEditingSecret ? (
              <div className="flex flex-col gap-3">
                <input 
                  value={secretInput} 
                  onChange={(e) => setSecretInput(e.target.value)} 
                  className="w-full p-3 rounded-xl border border-brand-sky/30 focus:ring-2 focus:ring-brand-sky outline-none font-mono text-center font-bold text-xl"
                />
                <div className="flex gap-2 justify-center">
                  <button onClick={() => { setIsEditingSecret(false); setSecretInput(familySecret); }} className="px-4 py-2 text-slate-500 font-bold text-xs hover:text-slate-700">Cancel</button>
                  <button onClick={handleSaveSecret} disabled={isSavingSecret} className="bg-brand-sky text-white px-6 py-2 rounded-full font-bold text-xs hover:bg-sky-500 disabled:opacity-50">
                    {isSavingSecret ? 'Updating...' : 'Update Secret'}
                  </button>
                </div>
              </div>
            ) : (
              <div className="bg-white p-4 rounded-xl border border-brand-sky/20 text-center">
                <span className="font-mono text-2xl font-bold text-slate-800 tracking-wider">
                  {familySecret}
                </span>
              </div>
            )}
            
            {!isEditingSecret && (
              <p className="text-center text-xs text-brand-sky/60 mt-3 font-medium uppercase tracking-wide">
                Shared with {isAdmin ? 'all users' : 'family'}
              </p>
            )}
          </div>

        </div>
      )}

      {activeTab === 'mirror' && (
        <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-100 animate-fade-in">
          {/* Mirror Frame Header */}
          <div className="text-center mb-8">
            <div className="inline-flex items-center gap-3 mb-4">
              <div className="w-12 h-12 bg-gradient-to-br from-brand-pink/20 to-brand-sky/20 rounded-full flex items-center justify-center">
                <span className="text-2xl">ü™û</span>
              </div>
              <h2 className="text-2xl font-bold text-slate-800">My Mirror</h2>
            </div>
            <p className="text-slate-500 text-sm">How others see you in the family</p>
          </div>

          {/* Mirror Content - Visitor's Perspective */}
          <div className="max-w-2xl mx-auto">
            {/* Profile Card as seen by others */}
            <div className="bg-gradient-to-br from-brand-sky/5 to-brand-pink/5 p-8 rounded-2xl border border-brand-sky/10 mb-6">
              <div className="flex items-center gap-6 mb-6">
                {/* Avatar */}
                <div className="relative">
                  <div className="w-20 h-20 rounded-full overflow-hidden border-4 border-white shadow-lg bg-slate-100 flex items-center justify-center">
                    {previewUrl ? (
                      <img src={previewUrl} alt="Profile" className="w-full h-full object-cover" />
                    ) : (
                      <span className="text-3xl text-brand-sky font-bold">
                        {(alias || firstName)?.[0]?.toUpperCase()}
                      </span>
                    )}
                  </div>
                  <StatusBadge status={status} size="normal" />
                </div>

                {/* Basic Info */}
                <div className="flex-1">
                  <h3 className="text-2xl font-bold text-slate-800">
                    {firstName} {lastName}
                  </h3>
                  {alias && (
                    <p className="text-brand-sky font-medium">@{alias}</p>
                  )}
                  <div className="mt-2">
                    <FamilyPositionIcon position={position} size="medium" />
                  </div>
                </div>
              </div>

              {/* Location */}
              {location && (
                <div className="flex items-center gap-2 text-slate-600 mb-4">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4 text-brand-pink">
                    <path fillRule="evenodd" d="m9.69 18.933.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 0 0 .281-.14c.186-.096.446-.24.757-.433.62-.384 1.445-.966 2.274-1.765C15.302 14.988 17 12.493 17 9A7 7 0 1 0 3 9c0 3.492 1.698 5.988 3.355 7.584a13.731 13.731 0 0 0 2.273 1.765 11.842 11.842 0 0 0 .976.544l.062.029.018.008.006.003ZM10 11.25a2.25 2.25 0 1 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z" clipRule="evenodd" />
                  </svg>
                  <span className="text-sm font-medium">{location}</span>
                </div>
              )}

              {/* Status */}
              {status && (
                <div className="bg-slate-50 p-4 rounded-xl border border-slate-100 mb-4">
                  <div className="flex items-center gap-2 text-slate-600">
                    <span className="text-lg">üí≠</span>
                    <span className="font-medium italic">"{status}"</span>
                  </div>
                </div>
              )}

              {/* Bio */}
              {bio && (
                <div className="bg-white p-6 rounded-xl border border-slate-100 mb-4">
                  <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">About Me</h4>
                  <p className="text-slate-700 leading-relaxed">{bio}</p>
                </div>
              )}

              {/* Contact Information */}
              <div className="bg-white p-6 rounded-xl border border-slate-100">
                <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Contact Information</h4>
                <div className="space-y-3">
                  {/* Email */}
                  <div className="flex items-center gap-3">
                    <div className="w-8 h-8 bg-brand-sky/10 rounded-full flex items-center justify-center">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4 text-brand-sky">
                        <path d="M3 4a2 2 0 0 0-2 2v1.161l8.441 4.221a1.25 1.25 0 0 0 1.118 0L19 7.162V6a2 2 0 0 0-2-2H3Z" />
                        <path d="m19 8.839-7.77 3.885a2.75 2.75 0 0 1-2.46 0L1 8.839V14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.839Z" />
                      </svg>
                    </div>
                    <div>
                      <div className="text-xs text-slate-400 uppercase tracking-wider">Email</div>
                      <div className="text-slate-700 font-medium">{user.email}</div>
                    </div>
                  </div>

                  {/* Phone */}
                  {user.phone && (
                    <div className="flex items-center gap-3">
                      <div className="w-8 h-8 bg-brand-pink/10 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4 text-brand-pink">
                          <path fillRule="evenodd" d="M2 3.5A1.5 1.5 0 0 1 3.5 2h1.148a1.5 1.5 0 0 1 1.465 1.175l.716 3.223a1.5 1.5 0 0 1-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 0 0 6.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 0 1 1.767-1.052l3.223.716A1.5 1.5 0 0 1 18 15.352V16.5a1.5 1.5 0 0 1-1.5 1.5H15c-1.149 0-2.263-.15-3.326-.43A13.022 13.022 0 0 1 2.43 8.326 13.019 13.019 0 0 1 2 5V3.5Z" clipRule="evenodd" />
                        </svg>
                      </div>
                      <div>
                        <div className="text-xs text-slate-400 uppercase tracking-wider">Phone</div>
                        <div className="text-slate-700 font-medium">{user.phone}</div>
                      </div>
                    </div>
                  )}

                  {!user.phone && (
                    <div className="flex items-center gap-3">
                      <div className="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4 text-slate-400">
                          <path fillRule="evenodd" d="M2 3.5A1.5 1.5 0 0 1 3.5 2h1.148a1.5 1.5 0 0 1 1.465 1.175l.716 3.223a1.5 1.5 0 0 1-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 0 0 6.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 0 1 1.767-1.052l3.223.716A1.5 1.5 0 0 1 18 15.352V16.5a1.5 1.5 0 0 1-1.5 1.5H15c-1.149 0-2.263-.15-3.326-.43A13.022 13.022 0 0 1 2.43 8.326 13.019 13.019 0 0 1 2 5V3.5Z" clipRule="evenodd" />
                        </svg>
                      </div>
                      <div>
                        <div className="text-xs text-slate-400 uppercase tracking-wider">Phone</div>
                        <div className="text-slate-400 italic">Not provided</div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* Family Connection Stats */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              <div className="bg-brand-sky/10 p-4 rounded-xl text-center border border-brand-sky/20">
                <div className="text-2xl font-bold text-brand-sky">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                <div className="text-xs text-slate-600 mt-1">Family Member</div>
              </div>
              <div className="bg-brand-pink/10 p-4 rounded-xl text-center border border-brand-pink/20">
                <div className="text-2xl font-bold text-brand-pink">üìÖ</div>
                <div className="text-xs text-slate-600 mt-1">
                  Joined {new Date(user.createdAt).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
                </div>
              </div>
              <div className="bg-brand-yellow/20 p-4 rounded-xl text-center border border-brand-yellow/30">
                <div className="text-2xl font-bold text-brand-yellow/80">‚ú®</div>
                <div className="text-xs text-slate-600 mt-1">Active</div>
              </div>
              <div className="bg-brand-cream/30 p-4 rounded-xl text-center border border-brand-cream/50">
                <div className="text-2xl font-bold text-brand-cream/70">üè†</div>
                <div className="text-xs text-slate-600 mt-1">Common Room</div>
              </div>
            </div>

            {/* Visitor's Perspective Message */}
            <div className="bg-gradient-to-r from-brand-sky/10 to-brand-pink/10 p-6 rounded-2xl border border-brand-sky/20 text-center">
              <div className="text-3xl mb-3">üëÅÔ∏è</div>
              <h4 className="text-lg font-bold text-slate-800 mb-2">Through Family Eyes</h4>
              <p className="text-slate-600 text-sm leading-relaxed max-w-md mx-auto">
                This is how your family sees you when they visit your profile. Your presence, your story, your connection to the family - all reflected back through the mirror of our shared space.
              </p>
              <div className="mt-4 flex justify-center gap-3">
                <Link 
                  href={`/${profileSlug}s-room`}
                  className="bg-brand-sky text-white px-4 py-2 rounded-full text-sm font-bold hover:bg-sky-500 transition-colors shadow-sm"
                >
                  View Public Profile
                </Link>
                <Link 
                  href="/family"
                  className="bg-white text-brand-sky px-4 py-2 rounded-full text-sm font-bold hover:bg-brand-sky/10 transition-colors border border-brand-sky/20"
                >
                  Meet Family
                </Link>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  )
}
</file>

<file path="src/components/PostCard.tsx">
'use client'

import { useState } from 'react'
import { deletePost, editPost, toggleLike, addComment, dismissAnnouncement } from '@/app/common-room/actions'
import CommentItem from './CommentItem'
import LikeButton from './LikeButton'
import EmojiButton from './EmojiButton'
import { useRouter } from 'next/navigation'
import StatusBadge from './StatusBadge'
import FamilyPositionIcon from './FamilyPositionIcon'

export default function PostCard({ post, currentUserId }: { post: any, currentUserId: string }) {
  const router = useRouter()
  
  // ... (Keep existing state: isEditing, editContent, etc.)
  const [isEditing, setIsEditing] = useState(false)
  const [editContent, setEditContent] = useState(post.content)
  const [editTitle, setEditTitle] = useState(post.title || '')
  const [editIsUrgent, setEditIsUrgent] = useState(post.isUrgent || false)
  const [showComments, setShowComments] = useState(false)
  const [commentText, setCommentText] = useState('')

  // ... (Keep permissions logic)
  const ADMIN_EMAIL = 'idongesit_essien@ymail.com'
  const isAdmin = post.author.email?.toLowerCase() === ADMIN_EMAIL.toLowerCase()
  const isAuthor = currentUserId === post.authorId
  const createdAt = new Date(post.createdAt).getTime()
  const timeDiff = Date.now() - createdAt
  const canEdit = isAuthor && (post.isAnnouncement || (!post.isEdited && timeDiff < 10 * 60 * 1000))

  // ... (Keep handlers: handleDelete, handleSave, etc.)
  async function handleDelete() { if (confirm('Delete?')) await deletePost(post.id) }
  async function handleSave() {
    const result = await editPost(post.id, editContent, post.isAnnouncement ? editTitle : undefined, post.isAnnouncement ? editIsUrgent : undefined)
    if (result.success) { setIsEditing(false); router.refresh(); } else { alert(result.message); }
  }
  async function handleToggleLike() { await toggleLike(post.id) }
  async function handleMainCommentSubmit(e: React.FormEvent) {
    e.preventDefault(); if(!commentText.trim()) return; await addComment(post.id, commentText); setCommentText('');
  }
  async function handleDismiss() { await dismissAnnouncement(post.id); router.refresh(); }

  const displayName = post.author.alias || post.author.firstName
  const firstLetter = displayName[0].toUpperCase()
  const profileImage = post.author.profileImage
  
  // --- NEW: STATUS ICON LOGIC ---
  const handleAuthorClick = () => {
    router.push(`/${post.author.firstName.toLowerCase()}s-room`)
  }
  const statusEmoji = post.author.status ? Array.from(post.author.status)[0] : null

  // Styles
  const isUrgent = post.isUrgent
  const displayUrgent = isEditing ? editIsUrgent : isUrgent
  const cardStyle = displayUrgent ? "bg-red-500/5 border-red-200/50 backdrop-blur-sm shadow-md" : "bg-white border-slate-100 shadow-sm"

  return (
    <div className={`p-6 rounded-xl border mb-6 transition-all hover:border-slate-300 ${cardStyle}`}>
      
      {/* 1. HEADER */}
      <div className="flex justify-between items-start mb-4">
        <div className="flex items-center gap-3">
          
          {/* AVATAR CONTAINER */}
          <div className="relative">
            <button 
              onClick={handleAuthorClick}
              className="w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-sm overflow-hidden bg-brand-pink text-slate-700 font-bold text-lg hover:opacity-80 transition-opacity"
            >
              {profileImage ? (
                 <img src={profileImage} alt={displayName} className="w-full h-full object-cover" />
              ) : (
                 <span>{firstLetter}</span>
              )}
            </button>
            
            {/* ‚úÖ REPLACED MANUAL BADGE WITH COMPONENT */}
            <StatusBadge status={post.author.status} size="normal" />
          </div>
          
          <div className="flex flex-col">
            <div className="flex items-center gap-2">
              <button 
                onClick={handleAuthorClick}
                className="font-bold text-slate-800 leading-tight hover:text-brand-pink transition-colors"
              >
                {displayName}
              </button>
            </div>
            <div className="mt-1">
              <FamilyPositionIcon position={post.author.position} size="small" />
            </div>
            {isAdmin && (
              <span className="bg-slate-700 text-white text-[10px] font-bold px-1.5 py-0.5 rounded w-fit flex items-center gap-1 mt-1 shadow-sm">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-2.5 h-2.5"><path fillRule="evenodd" d="M10.362 1.093a.75.75 0 0 0-.724 0L2.523 5.018 10 9.143l7.477-4.125-7.115-3.925ZM18 6.443l-7.25 4v8.25l6.862-3.786A.75.75 0 0 0 18 14.25V6.443Zm-8.75 12.25v-8.25l-7.25-4v7.807a.75.75 0 0 0 .388.657l6.862 3.786Z" clipRule="evenodd" /></svg>
                 Admin
              </span>
            )}
            <p className="text-xs text-slate-400 mt-0.5">
              {new Date(post.createdAt).toLocaleString(undefined, { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' })}
              {post.isEdited && <span className="italic ml-1">(Edited)</span>}
            </p>
          </div>
        </div>

        {/* Buttons (Edit/Delete) */}
        {isAuthor && (
           <div className="flex gap-3 text-slate-400">
             {canEdit && !isEditing && (
               <button onClick={() => setIsEditing(true)} className="hover:text-brand-sky p-1 rounded-full hover:bg-slate-50">
                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>
               </button>
             )}
             <button onClick={handleDelete} className="hover:text-red-500 p-1 rounded-full hover:bg-red-50">
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>
             </button>
           </div>
        )}
      </div>

      {/* 2. CONTENT (Keep existing logic) */}
      {isEditing ? (
        <div className="mt-2 flex flex-col gap-3">
          {post.isAnnouncement && (
            <div className="flex flex-col gap-3 animate-in slide-in-from-top-2">
              <div>
                <label className="text-[10px] font-bold text-slate-400 uppercase">Title</label>
                <input value={editTitle} onChange={(e) => setEditTitle(e.target.value)} className="w-full p-2 text-sm border rounded-lg focus:ring-2 focus:ring-brand-sky outline-none font-bold text-slate-700" placeholder="Announcement Title"/>
              </div>
              <div onClick={() => setEditIsUrgent(!editIsUrgent)} className={`flex items-center gap-2 p-2 rounded-lg border cursor-pointer select-none transition-colors ${editIsUrgent ? 'bg-red-50 border-red-200' : 'bg-slate-50 border-slate-100'}`}>
                 <div className={`w-4 h-4 rounded-full border flex items-center justify-center ${editIsUrgent ? 'border-red-500' : 'border-slate-300'}`}>
                    {editIsUrgent && <div className="w-2 h-2 rounded-full bg-red-500" />}
                 </div>
                 <span className={`text-xs font-bold ${editIsUrgent ? 'text-red-500' : 'text-slate-500'}`}>Mark as Urgent</span>
              </div>
            </div>
          )}
          <div className="relative">
            <textarea value={editContent} onChange={(e) => setEditContent(e.target.value)} className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-brand-sky outline-none text-slate-700 pr-10" rows={3}/>
            <div className="absolute bottom-2 right-2"><EmojiButton onEmojiSelect={(emoji) => setEditContent((p:string) => p + emoji)} /></div>
          </div>
          <div className="flex gap-2 justify-end">
            <button onClick={() => setIsEditing(false)} className="text-xs text-slate-400 hover:text-slate-600 font-bold px-2">Cancel</button>
            <button onClick={handleSave} className="text-xs bg-brand-sky text-white px-4 py-1.5 rounded-full hover:bg-sky-500 font-bold shadow-sm">Save Changes</button>
          </div>
        </div>
      ) : (
        <div>
          {post.title && <h3 className="font-bold text-lg text-slate-800 mb-1">{post.title}</h3>}
          <p className="text-slate-700 leading-relaxed text-base whitespace-pre-wrap mb-3">{post.content}</p>
          {post.imageUrl && (
            <div className="mt-3 rounded-lg overflow-hidden border border-slate-100">
              <img src={post.imageUrl} alt="Post attachment" className="w-full max-h-96 object-cover bg-slate-50" loading="lazy"/>
            </div>
          )}
        </div>
      )}

      {/* 3. ACTION BAR */}
      <div className="mt-5 pt-4 border-t border-slate-50/50 flex justify-between items-center">
        <LikeButton initialLikes={post.likes} currentUserId={currentUserId} onToggle={handleToggleLike} />
        <div className="flex items-center gap-4">
          <button onClick={() => setShowComments(!showComments)} className="flex items-center gap-2 text-slate-400 hover:text-brand-sky transition-colors font-medium text-sm group">
            <span>{post.topLevelComments?.length || 0} Replies</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5 group-hover:-translate-y-0.5 transition-transform"><path strokeLinecap="round" strokeLinejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" /></svg>
          </button>
          {post.isUrgent && (
            <button onClick={handleDismiss} className="text-xs font-bold text-red-400 hover:text-red-600 hover:underline transition-colors">Dismiss</button>
          )}
        </div>
      </div>

      {/* 4. COMMENTS */}
      {showComments && (
        <div className="mt-6 animate-in slide-in-from-top-2 border-t border-slate-50 pt-4">
          <form onSubmit={handleMainCommentSubmit} className="flex gap-2 mb-6 items-center">
            <div className="relative flex-1">
              <input type="text" value={commentText} onChange={(e) => setCommentText(e.target.value)} placeholder="Write a comment..." className="w-full bg-slate-50 border border-slate-200 rounded-lg pl-4 pr-10 py-3 text-sm focus:ring-2 focus:ring-brand-sky outline-none transition-all"/>
              <div className="absolute right-2 top-1/2 -translate-y-1/2"><EmojiButton onEmojiSelect={(emoji) => setCommentText((p:string) => p + emoji)} /></div>
            </div>
            <button type="submit" disabled={!commentText.trim()} className="bg-brand-sky text-white font-bold px-4 py-2 rounded-lg hover:bg-sky-500 disabled:opacity-50 transition-colors">Post</button>
          </form>
          <div className="space-y-4">
            {post.topLevelComments?.map((comment: any) => (
              <CommentItem key={comment.id} comment={comment} currentUserId={currentUserId} postId={post.id}/>
            ))}
            {(!post.topLevelComments || post.topLevelComments.length === 0) && <p className="text-center text-slate-400 text-xs italic">No comments yet.</p>}
          </div>
        </div>
      )}
    </div>
  )
}
</file>

</files>
